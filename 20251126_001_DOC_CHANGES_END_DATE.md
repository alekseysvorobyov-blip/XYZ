# üìù –ù–ï–û–ë–•–û–î–ò–ú–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–ò KSK-Schema
## –í–µ—Ä—Å–∏—è: 3.8.2 (26.11.2025)
## –ò–∑–º–µ–Ω–µ–Ω–∏–µ: END_DATE ‚Äî –∏—Å–∫–ª—é—á–∞—é—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª

---

## 1Ô∏è‚É£ 09-KSK-Schema-FUNCTIONS.md

### –†–∞–∑–¥–µ–ª: ksk_run_report() (—Ñ—É–Ω–∫—Ü–∏—è #5)

**–ë–´–õ–û:**
```
- `p_end_date` DATE ‚Äî –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ (NULL = p_start_date)
```

**–°–¢–ê–õ–û:**
```
- `p_end_date` DATE ‚Äî –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ (–ò–°–ö–õ–Æ–ß–ê–Ø). 
  - NULL ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ start_date + 1 day
  - = start_date ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ start_date + 1 day
  - < start_date ‚Üí EXCEPTION
```

**–î–û–ë–ê–í–ò–¢–¨ –ø–æ—Å–ª–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
```
**–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–µ:**
- –ò–Ω—Ç–µ—Ä–≤–∞–ª `[p_start_date ... p_end_date)` ‚Äî –∏—Å–∫–ª—é—á–∞—é—â–∏–π –∫–æ–Ω–µ—Ü
- –ü—Ä–∏–º–µ—Ä: `('2025-10-22', '2025-10-23')` = –¥–∞–Ω–Ω—ã–µ –∑–∞ 22 –æ–∫—Ç—è–±—Ä—è
- –ü—Ä–∏–º–µ—Ä: `('2025-10-22', NULL)` = –¥–∞–Ω–Ω—ã–µ –∑–∞ 22 –æ–∫—Ç—è–±—Ä—è (–∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è)
- –ü—Ä–∏–º–µ—Ä: `('2025-10-22', '2025-10-22')` = –¥–∞–Ω–Ω—ã–µ –∑–∞ 22 –æ–∫—Ç—è–±—Ä—è (–∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è)

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- –ï—Å–ª–∏ `end_date < start_date` ‚Üí RAISE EXCEPTION
```

---

### –†–∞–∑–¥–µ–ª: ksk_report_register_header() (—Ñ—É–Ω–∫—Ü–∏—è #7)

**–ë–´–õ–û:**
```
- `p_end_date` DATE DEFAULT CURRENT_DATE ‚Äî –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞
```

**–°–¢–ê–õ–û:**
```
- `p_end_date` DATE DEFAULT CURRENT_DATE ‚Äî –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ (–ò–°–ö–õ–Æ–ß–ê–Ø)
  - NULL –∏–ª–∏ = start_date ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ start_date + 1 day
  - < start_date ‚Üí EXCEPTION
```

---

### –†–∞–∑–¥–µ–ª: ksk_report_create_report() (—Ñ—É–Ω–∫—Ü–∏—è #8)

**–î–û–ë–ê–í–ò–¢–¨ –≤ –æ–ø–∏—Å–∞–Ω–∏–µ:**
```
**–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç:**
- –ï—Å–ª–∏ `end_date < start_date` ‚Üí —Å—Ç–∞—Ç—É—Å 'error', –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, RETURN -1*log_id
- –ï—Å–ª–∏ `end_date IS NULL` –∏–ª–∏ `end_date = start_date` ‚Üí –∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –Ω–∞ start_date + 1 day
```

---

### –†–∞–∑–¥–µ–ª: –§—É–Ω–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–æ–≤ (#10-#14)

**–î–û–ë–ê–í–ò–¢–¨ –æ–±—â–µ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ —Å–ø–∏—Å–∫–æ–º:**
```
**‚ö†Ô∏è –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ü–û –î–ê–¢–ï (–¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏):**
- –ò–Ω—Ç–µ—Ä–≤–∞–ª: `[p_start_date ... p_end_date)` ‚Äî –ò–°–ö–õ–Æ–ß–ê–Æ–©–ò–ô –∫–æ–Ω–µ—Ü
- –¢–∏–ø –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è: `::TIMESTAMP(3)` –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø–æ–ª—è–º —Ç–∞–±–ª–∏—Ü
- WHERE: `timestamp >= p_start_date::TIMESTAMP(3) AND timestamp < p_end_date::TIMESTAMP(3)`
```

---

## 2Ô∏è‚É£ 07-KSK-Schema-REPORTS-TYPES.md

### –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª –≤ –Ω–∞—á–∞–ª–æ:

```markdown
## ‚ö†Ô∏è –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ü–û –ü–ï–†–ò–û–î–£

–í—Å–µ –æ—Ç—á—ë—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–∏—Å–∫–ª—é—á–∞—é—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª**:
- –§–æ—Ä–º–∞—Ç: `[start_date ... end_date)`
- start_date ‚Äî **–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ** (>=)
- end_date ‚Äî **–∏—Å–∫–ª—é—á–∞—è** (<)

**–ü—Ä–∏–º–µ—Ä—ã:**
| start_date | end_date | –ü–µ—Ä–∏–æ–¥ –¥–∞–Ω–Ω—ã—Ö |
|------------|----------|---------------|
| 2025-10-22 | 2025-10-23 | 22 –æ–∫—Ç—è–±—Ä—è (1 –¥–µ–Ω—å) |
| 2025-10-22 | 2025-10-25 | 22, 23, 24 –æ–∫—Ç—è–±—Ä—è (3 –¥–Ω—è) |
| 2025-10-22 | NULL | 22 –æ–∫—Ç—è–±—Ä—è (–∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –Ω–∞ 23) |
| 2025-10-22 | 2025-10-22 | 22 –æ–∫—Ç—è–±—Ä—è (–∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –Ω–∞ 23) |

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- `end_date < start_date` ‚Üí –æ—à–∏–±–∫–∞ (EXCEPTION –∏–ª–∏ status='error')
```

---

## 3Ô∏è‚É£ 13-KSK-Schema-CHANGELOG.md

### –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å:

```markdown
## v3.8.2 (26.11.2025)

### üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å END_DATE

**–ü—Ä–æ–±–ª–µ–º–∞:** 
–í –æ—Ç—á—ë—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `+ INTERVAL '1 day'` –¥–ª—è end_date, 
—á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–∏ —è–≤–Ω–æ –∑–∞–¥–∞–Ω–Ω–æ–π –¥–∞—Ç–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ:**
1. **–û—Ç—á—ë—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (5 —à—Ç):**
   - –£–±—Ä–∞–Ω `+ INTERVAL '1 day'` –∏–∑ WHERE
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: `timestamp < p_end_date::TIMESTAMP(3)`
   - –Ø–≤–Ω–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ `TIMESTAMP(3)`

2. **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä—ã (3 —à—Ç):**
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: `end_date < start_date` ‚Üí –æ—à–∏–±–∫–∞
   - –ê–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è: `NULL` –∏–ª–∏ `= start_date` ‚Üí `start_date + 1 day`

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
| –§—É–Ω–∫—Ü–∏—è | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|---------|-----------|
| ksk_report_totals | `< p_end_date::TIMESTAMP(3)` |
| ksk_report_list_totals | `< p_end_date::TIMESTAMP(3)` |
| ksk_report_totals_by_payment_type | `< p_end_date::TIMESTAMP(3)` |
| ksk_report_list_totals_by_payment_type | `< p_end_date::TIMESTAMP(3)` |
| ksk_report_figurants | `< p_end_date::TIMESTAMP(3)` |
| ksk_run_report | –í–∞–ª–∏–¥–∞—Ü–∏—è + –∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è |
| ksk_report_register_header | –í–∞–ª–∏–¥–∞—Ü–∏—è + –∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è |
| ksk_report_create_report | –í–∞–ª–∏–¥–∞—Ü–∏—è + –∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è |

**–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
- ‚úÖ –û–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ (NULL –∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–∞—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ)
- ‚ö†Ô∏è –Ø–≤–Ω–æ –∑–∞–¥–∞–Ω–Ω—ã–π `end_date < start_date` —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É
```

---

## 4Ô∏è‚É£ 02-KSK-Schema-GLOSSARY.md

### –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ä–º–∏–Ω:

```markdown
### –ò—Å–∫–ª—é—á–∞—é—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (Half-open interval)
–°–ø–æ—Å–æ–± –∑–∞–¥–∞–Ω–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç `[start ... end)`, –≥–¥–µ:
- start ‚Äî –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ (>=)
- end ‚Äî –∏—Å–∫–ª—é—á–∞—è (<)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö –æ—Ç—á—ë—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö –ö–°–ö –¥–ª—è –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞.
–ü—Ä–∏–º–µ—Ä: `[2025-10-22 ... 2025-10-23)` = –¥–∞–Ω–Ω—ã–µ –∑–∞ 22 –æ–∫—Ç—è–±—Ä—è.
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ò–ó–ú–ï–ù–ï–ù–ò–ô

| –§–∞–π–ª | –†–∞–∑–¥–µ–ª | –°—Ç–∞—Ç—É—Å |
|------|--------|--------|
| 09-KSK-Schema-FUNCTIONS.md | ksk_run_report() | ‚¨ú |
| 09-KSK-Schema-FUNCTIONS.md | ksk_report_register_header() | ‚¨ú |
| 09-KSK-Schema-FUNCTIONS.md | ksk_report_create_report() | ‚¨ú |
| 09-KSK-Schema-FUNCTIONS.md | –§—É–Ω–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (#10-#14) | ‚¨ú |
| 07-KSK-Schema-REPORTS-TYPES.md | –†–∞–∑–¥–µ–ª —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ | ‚¨ú |
| 13-KSK-Schema-CHANGELOG.md | v3.8.2 | ‚¨ú |
| 02-KSK-Schema-GLOSSARY.md | –¢–µ—Ä–º–∏–Ω | ‚¨ú |
| 01-KSK-Schema-INDEX.md | –í–µ—Ä—Å–∏—è | ‚¨ú |
