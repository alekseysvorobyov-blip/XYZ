# üìò KSK Database Schema Reference

**–í–µ—Ä—Å–∏—è:** 3.7 FINAL  
**–î–∞—Ç–∞:** 31.10.2025 01:42 MSK  
**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL 16  
**–°—Ö–µ–º–∞:** `upoa_ksk_reports`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –≠–¢–ê–õ–û–ù ‚Äî –ï–î–ò–ù–´–ô –ò–°–¢–û–ß–ù–ò–ö –ò–°–¢–ò–ù–´ –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û

**–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è –ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ú –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã (Single Source of Truth) –¥–ª—è:**
- –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (Backend, Frontend, DevOps)
- –ë–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤ –∏ Product Owners
- DBA –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤
- –¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–æ–≤ –∏ QA
- –î–æ–∫—É–º–µ–Ω—Ç–∞–ª–∏—Å—Ç–æ–≤

**–ü—Ä–∏ –ª—é–±—ã—Ö –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è—Ö:** –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∏–º–µ–µ—Ç **–í–´–°–®–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢** –Ω–∞–¥ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏, –∫–æ–¥–æ–º, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π!

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. [–ì–ª–æ—Å—Å–∞—Ä–∏–π —Ç–µ—Ä–º–∏–Ω–æ–≤](#–≥–ª–æ—Å—Å–∞—Ä–∏–π-—Ç–µ—Ä–º–∏–Ω–æ–≤)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
3. [–î–æ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (3 —à—Ç, 59 –ø–æ–ª–µ–π)](#–¥–æ–º–µ–Ω–Ω—ã–µ-—Ç–∞–±–ª–∏—Ü—ã)
4. [–°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (2 —à—Ç, 23 –ø–æ–ª—è)](#—Å–∏—Å—Ç–µ–º–Ω—ã–µ-—Ç–∞–±–ª–∏—Ü—ã)
5. [–¢–∏–ø—ã –æ—Ç—á—ë—Ç–æ–≤ (5 —à—Ç)](#—Ç–∏–ø—ã-–æ—Ç—á—ë—Ç–æ–≤)
6. [–û—Ç—á—ë—Ç –ø–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º (review)](#–æ—Ç—á—ë—Ç-–ø–æ-—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º)
7. [–û—Ç—á—ë—Ç–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (7 —à—Ç, 137 –ø–æ–ª–µ–π)](#–æ—Ç—á—ë—Ç–Ω—ã–µ-—Ç–∞–±–ª–∏—Ü—ã)
8. [–§—É–Ω–∫—Ü–∏–∏ (23 —à—Ç)](#—Ñ—É–Ω–∫—Ü–∏–∏)
9. [–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∑–∞–¥–∞—á–∏ (CRON)](#—Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ-–∑–∞–¥–∞—á–∏-cron)

---

## üìö –ì–õ–û–°–°–ê–†–ò–ô –¢–ï–†–ú–ò–ù–û–í

### –ö–ª—é—á–µ–≤—ã–µ –ø–æ–Ω—è—Ç–∏—è –ö–°–ö

| –¢–µ—Ä–º–∏–Ω | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|--------|-------------|------------|
| **–ö–°–ö** | –ö–æ–º–ø–ª–∞–µ–Ω—Å-—Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è | –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã–º —Å–ø–∏—Å–∫–∞–º |
| **–§–∏–≥—É—Ä–∞–Ω—Ç** | –°—É–±—ä–µ–∫—Ç —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ | –§–∏–∑–∏—á–µ—Å–∫–æ–µ –∏–ª–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ, –Ω–∞—Ö–æ–¥—è—â–µ–µ—Å—è –≤ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–º —Å–ø–∏—Å–∫–µ |
| **Match (—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)** | –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, –Ω–∞–π–¥–µ–Ω–Ω–æ–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º | –û–¥–∏–Ω —Ñ–∏–≥—É—Ä–∞–Ω—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –ù–ï–°–ö–û–õ–¨–ö–û matches, –µ—Å–ª–∏ —Å—Ä–∞–±–æ—Ç–∞–ª–∏ —Ä–∞–∑–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–∏—Å–∫–∞ |
| **Resolution** | –ò—Ç–æ–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ | –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ —Ä–µ—à–µ–Ω–∏–π –ø–æ –≤—Å–µ–º —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ |

---

### Resolution (–†–µ–∑–æ–ª—é—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)

**–¢–∏–ø:** `VARCHAR(20)`  
**–ó–Ω–∞—á–µ–Ω–∏—è:**

| –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ |
|----------|--------------|----------|---------------|
| `allow` | –†–∞–∑—Ä–µ—à–∏—Ç—å | –ü–ª–∞—Ç—ë–∂ —Ä–∞–∑—Ä–µ—à—ë–Ω –∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é | –í—Å–µ —Ñ–∏–≥—É—Ä–∞–Ω—Ç—ã –∏–º–µ—é—Ç —Å—Ç–∞—Ç—É—Å `allow` |
| `review` | –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ | –ü–ª–∞—Ç—ë–∂ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–º–ø–ª–∞–µ–Ω—Å-–æ—Ñ–∏—Ü–µ—Ä–æ–º | –•–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ñ–∏–≥—É—Ä–∞–Ω—Ç `review`, –Ω–µ—Ç `deny` |
| `deny` | –û—Ç–∫–ª–æ–Ω–∏—Ç—å | –ü–ª–∞—Ç—ë–∂ –æ—Ç–∫–ª–æ–Ω—ë–Ω | –•–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ñ–∏–≥—É—Ä–∞–Ω—Ç `deny` |
| `empty` | –ù–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π | –°–æ–≤–ø–∞–¥–µ–Ω–∏–π —Å —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã–º–∏ —Å–ø–∏—Å–∫–∞–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ | –ú–∞—Å—Å–∏–≤ `searchCheckResultKCKH` –ø—É—Å—Ç |

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∞–≥—Ä–µ–≥–∞—Ü–∏–∏:** `deny` > `review` > `allow` > `empty`

---

### Bypass (–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è)

#### has_bypass (ksk_result) ‚Äî –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û:** –¢–∏–ø ‚Äî `VARCHAR(10)`, –ù–ï BOOLEAN!

**–ó–Ω–∞—á–µ–Ω–∏—è:**

| –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `'yes'` | –ò—Å–∫–ª—é—á—ë–Ω | –ü–ª–∞—Ç—ë–∂ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–∫–ª—é—á—ë–Ω –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è –ö–°–ö |
| `'no'` | –ù–µ –∏—Å–∫–ª—é—á—ë–Ω | –ü–ª–∞—Ç—ë–∂ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É |
| `'empty'` | –ù–µ—Ç —Ñ–∏–≥—É—Ä–∞–Ω—Ç–æ–≤ | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø—Ä–æ—à–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫—É, –Ω–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç—ã –Ω–µ –≤—ã—è–≤–ª–µ–Ω—ã (resolution='empty') |

**‚ö†Ô∏è –í–ê–ñ–ù–û:** `'empty'` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –í–´–ü–û–õ–ù–ï–ù–ê, –Ω–æ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –Ω–µ –Ω–∞—à–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π.

---

#### is_bypass (ksk_figurant) ‚Äî –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û:** –¢–∏–ø ‚Äî `VARCHAR(10)`, –ù–ï BOOLEAN!

**–ó–Ω–∞—á–µ–Ω–∏—è (–¢–û–õ–¨–ö–û –î–í–ê!):**

| –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `'yes'` | –ò—Å–∫–ª—é—á—ë–Ω | –§–∏–≥—É—Ä–∞–Ω—Ç –∏—Å–∫–ª—é—á—ë–Ω –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏) |
| `'no'` | –ù–µ –∏—Å–∫–ª—é—á—ë–Ω | –§–∏–≥—É—Ä–∞–Ω—Ç —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ resolution |

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –ù–∞ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–µ –≤–æ–∑–º–æ–∂–Ω—ã –¢–û–õ–¨–ö–û –∑–Ω–∞—á–µ–Ω–∏—è `'yes'` –∏–ª–∏ `'no'`. –ù–ï–¢ –∑–Ω–∞—á–µ–Ω–∏—è `'empty'`!

---

### Payment Type (–¢–∏–ø –ø–ª–∞—Ç–µ–∂–∞)

**–¢–∏–ø:** `VARCHAR(20)`  
**–ó–Ω–∞—á–µ–Ω–∏—è:**

| –ö–æ–¥ | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|--------------|----------|
| `I` | –í—Ö–æ–¥—è—â–∏–π | –ü–ª–∞—Ç—ë–∂ –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –±–∞–Ω–∫–∞ –≤ –Ω–∞—à –±–∞–Ω–∫ |
| `O` | –ò—Å—Ö–æ–¥—è—â–∏–π | –ü–ª–∞—Ç—ë–∂ –∏–∑ –Ω–∞—à–µ–≥–æ –±–∞–Ω–∫–∞ –≤–æ –≤–Ω–µ—à–Ω–∏–π –±–∞–Ω–∫ |
| `T` | –¢—Ä–∞–Ω–∑–∏—Ç–Ω—ã–π | –ü–ª–∞—Ç—ë–∂ —á–µ—Ä–µ–∑ –Ω–∞—à –±–∞–Ω–∫ (–æ–±–∞ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ –≤–Ω–µ—à–Ω–∏–µ) |
| `M` | –ú–µ–∂—Ñ–∏–ª–∏–∞–ª—å–Ω—ã–π | –ü–ª–∞—Ç—ë–∂ –º–µ–∂–¥—É —Ñ–∏–ª–∏–∞–ª–∞–º–∏ –Ω–∞—à–µ–≥–æ –±–∞–Ω–∫–∞ |
| `V` | –í–Ω—É—Ç—Ä–∏—Ñ–∏–ª–∏–∞–ª—å–Ω—ã–π | –ü–ª–∞—Ç—ë–∂ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞ |

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ë–ê–ó–´ –î–ê–ù–ù–´–•

### –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü

```
upoa_ksk_reports (—Å—Ö–µ–º–∞) ‚Äî 12 —Ç–∞–±–ª–∏—Ü, 219 –ø–æ–ª–µ–π
‚îÇ
‚îú‚îÄ‚îÄ üìÅ –î–û–ú–ï–ù–ù–´–ï –¢–ê–ë–õ–ò–¶–´ (3 —à—Ç, 59 –ø–æ–ª–µ–π)
‚îÇ   ‚îú‚îÄ‚îÄ ksk_result ‚Äî 34 –ø–æ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ ksk_figurant ‚Äî 15 –ø–æ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ ksk_figurant_match ‚Äî 10 –ø–æ–ª–µ–π
‚îÇ
‚îú‚îÄ‚îÄ üìÅ –°–ò–°–¢–ï–ú–ù–´–ï –¢–ê–ë–õ–ò–¶–´ (2 —à—Ç, 23 –ø–æ–ª—è)
‚îÇ   ‚îú‚îÄ‚îÄ ksk_result_error ‚Äî 14 –ø–æ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ ksk_system_operations_log ‚Äî 9 –ø–æ–ª–µ–π
‚îÇ
‚îî‚îÄ‚îÄ üìÅ –û–¢–ß–Å–¢–ù–´–ï –¢–ê–ë–õ–ò–¶–´ (7 —à—Ç, 137 –ø–æ–ª–µ–π)
    ‚îú‚îÄ‚îÄ –û–†–ö–ï–°–¢–†–ê–¢–û–† (9 –ø–æ–ª–µ–π)
    ‚îÇ   ‚îî‚îÄ‚îÄ ksk_report_orchestrator ‚Äî —Å–º. –¢–∏–ø—ã –æ—Ç—á—ë—Ç–æ–≤
    ‚îÇ
    ‚îú‚îÄ‚îÄ –ó–ê–ì–û–õ–û–í–û–ö (13 –ø–æ–ª–µ–π)
    ‚îÇ   ‚îî‚îÄ‚îÄ ksk_report_header
    ‚îÇ
    ‚îî‚îÄ‚îÄ –î–ê–ù–ù–´–ï –û–¢–ß–Å–¢–û–í (115 –ø–æ–ª–µ–π)
        ‚îú‚îÄ‚îÄ ksk_report_totals_data ‚Äî 10 –ø–æ–ª–µ–π
        ‚îú‚îÄ‚îÄ ksk_report_list_totals_data ‚Äî 10 –ø–æ–ª–µ–π
        ‚îú‚îÄ‚îÄ ksk_report_totals_by_payment_type_data ‚Äî 44 –ø–æ–ª—è
        ‚îú‚îÄ‚îÄ ksk_report_list_totals_by_payment_type_data ‚Äî 39 –ø–æ–ª–µ–π
        ‚îî‚îÄ‚îÄ ksk_report_figurants_data ‚Äî 12 –ø–æ–ª–µ–π
```

---

### –°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –¢–∞–±–ª–∏—Ü | –ü–æ–ª–µ–π | –ò–Ω–¥–µ–∫—Å–æ–≤ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|--------|-------|----------|------------|
| **–î–æ–º–µ–Ω–Ω—ã–µ** | 3 | 59 | 13 | –û—Å–Ω–æ–≤–Ω—ã–µ –±–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏ (–ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ) |
| **–°–∏—Å—Ç–µ–º–Ω—ã–µ** | 2 | 23 | 8 | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ |
| **–û—Ç—á—ë—Ç–Ω—ã–µ** | 7 | 137 | 12 | –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤ |
| **–ò–¢–û–ì–û** | **12** | **219** | **33** | **–ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Å–∏—Å—Ç–µ–º—ã –ö–°–ö** |

---

## üìä –î–û–ú–ï–ù–ù–´–ï –¢–ê–ë–õ–ò–¶–´ (3 —à—Ç)

**‚öôÔ∏è –û–±—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**

### üîë –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:** `PARTITION BY RANGE` –ø–æ **TIMESTAMP** (output_timestamp/timestamp)  
**–ü–µ—Ä–∏–æ–¥ –ø–∞—Ä—Ç–∏—Ü–∏–∏:** **1 –î–ï–ù–¨ (24 —á–∞—Å–∞)**  
**–ì—Ä–∞–Ω–∏—Ü—ã –ø–∞—Ä—Ç–∏—Ü–∏–∏:** `FROM 'YYYY-MM-DD 00:00:00' TO 'YYYY-MM-DD 00:00:00' + 1 day`

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: TO ‚Äî –≠–ö–°–ö–õ–Æ–ó–ò–í–ù–ê–Ø –≥—Ä–∞–Ω–∏—Ü–∞!**
- –ü–∞—Ä—Ç–∏—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω: **[FROM, TO)**
- **FROM:** 2025-10-22 00:00:00.000 (**–≤–∫–ª—é—á–∞—è**)
- **TO:** 2025-10-23 00:00:00.000 (**–ù–ï –≤–∫–ª—é—á–∞—è**)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í–°–ï timestamp —Å `2025-10-22 00:00:00.000` –¥–æ `2025-10-22 23:59:59.999`

**–§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞—Ä—Ç–∏—Ü–∏–π:** `ksk_create_partitions()`
```sql
-- SQL –∫–æ–º–∞–Ω–¥–∞
CREATE TABLE %I PARTITION OF %I 
FOR VALUES FROM (%L) TO (%L);

-- –ü—Ä–∏–º–µ—Ä: –ø–∞—Ä—Ç–∏—Ü–∏—è –∑–∞ 22 –æ–∫—Ç—è–±—Ä—è 2025
CREATE TABLE ksk_result_2025_10_22 PARTITION OF ksk_result
FOR VALUES FROM ('2025-10-22 00:00:00') TO ('2025-10-23 00:00:00');
-- ‚úÖ –í–∫–ª—é—á–∞–µ—Ç: 2025-10-22 00:00:00.000 ... 2025-10-22 23:59:59.999
-- ‚ùå –ù–ï –≤–∫–ª—é—á–∞–µ—Ç: 2025-10-23 00:00:00.000 –∏ –ø–æ–∑–∂–µ
```

**–¢–∞–±–ª–∏—Ü—ã —Å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º:**
| –¢–∞–±–ª–∏—Ü–∞ | –ö–ª—é—á –ø–∞—Ä—Ç–∏—Ü–∏–∏ | –ü–µ—Ä–∏–æ–¥ | PRIMARY KEY |
|---------|---------------|--------|-------------|
| ksk_result | **output_timestamp** | 1 –¥–µ–Ω—å | (id, output_timestamp) |
| ksk_figurant | **timestamp** | 1 –¥–µ–Ω—å | (id, timestamp) |
| ksk_figurant_match | **timestamp** | 1 –¥–µ–Ω—å | (id, timestamp) |

**‚ö†Ô∏è –í–ê–ñ–ù–û:**
- **–ü–æ–ª–µ `date`** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏, **–ù–ï –¥–ª—è –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**
- **PRIMARY KEY** –≤–∫–ª—é—á–∞–µ—Ç TIMESTAMP –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ –ø–∞—Ä—Ç–∏—Ü–∏–∏
- **–ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:** ksk_result ‚Üí ksk_figurant ‚Üí ksk_figurant_match

### üéØ –ü–æ—á–µ–º—É TIMESTAMP, –∞ –Ω–µ DATE?

1. **PRIMARY KEY** —Ç—Ä–µ–±—É–µ—Ç TIMESTAMP –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ –ø–∞—Ä—Ç–∏—Ü–∏–∏ (–∫–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π timestamp —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥)
2. **–ì—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∏—è:** –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ TIMESTAMP –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** BRIN –∏–Ω–¥–µ–∫—Å—ã –ø–æ TIMESTAMP —Ä–∞–±–æ—Ç–∞—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
4. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:** –ü–æ–ª–µ `date` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ –ø—Ä–∏ JOIN-–∞—Ö, –Ω–æ –ù–ï –¥–ª—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### üì¶ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

- **JSONB –ø–æ–ª—è:** `STORAGE EXTERNAL` (—ç–∫–æ–Ω–æ–º–∏—è shared_buffers, TOAST-—Ç–∞–±–ª–∏—Ü—ã –≤–Ω–µ –∫—ç—à–∞)
- **–ò–Ω–¥–µ–∫—Å—ã:** –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã (BRIN –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏, B-tree –¥–ª—è FK, GIN –¥–ª—è –º–∞—Å—Å–∏–≤–æ–≤)
- **–û–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö:** ~3M –∑–∞–ø–∏—Å–µ–π/–¥–µ–Ω—å –≤ ksk_result, ~100-500 –∑–∞–ø–∏—Å–µ–π/–¥–µ–Ω—å –≤ ksk_figurant

---

### 1. ksk_result (34 –ø–æ–ª—è, 5 –∏–Ω–¥–µ–∫—Å–æ–≤)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π –ö–°–ö  
**–û–±—ä—ë–º:** ~3M –∑–∞–ø–∏—Å–µ–π/–¥–µ–Ω—å (~3TB/–≥–æ–¥ –Ω–∞ HDD)  
**–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:** `PARTITION BY RANGE (output_timestamp)` ‚Äî **–ø–µ—Ä–∏–æ–¥ 1 –î–ï–ù–¨**  
**PRIMARY KEY:** `(id, output_timestamp)`

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π (34 –ø–æ–ª—è)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY | AUTO | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ (PRIMARY KEY) |
| 2 | date | DATE NOT NULL | ‚Äî | –î–∞—Ç–∞ | –î–∞—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏, –ù–ï –∫–ª—é—á –ø–∞—Ä—Ç–∏—Ü–∏–∏) |
| 3 | corr_id | VARCHAR(100) NOT NULL | ‚Äî | –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π ID | Correlation ID –ø–ª–∞—Ç–µ–∂–∞ –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ (–∏–Ω–¥–µ–∫—Å B-tree) |
| 4 | input_timestamp | TIMESTAMP(3) | NULL | –í—Ä–µ–º—è –≤—Ö–æ–¥—è—â–µ–≥–æ | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Kafka |
| 5 | output_timestamp | TIMESTAMP(3) NOT NULL | ‚Äî | –í—Ä–µ–º—è –∏—Å—Ö–æ–¥—è—â–µ–≥–æ | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (PRIMARY KEY, **–ö–õ–Æ–ß –ü–ê–†–¢–ò–¶–ò–ò**, –∏–Ω–¥–µ–∫—Å BRIN) |
| 6 | input_json | JSONB | NULL | –í—Ö–æ–¥—è—â–∏–π JSON | –ü–æ–ª–Ω—ã–π JSON –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (EXTERNAL STORAGE) |
| 7 | output_json | JSONB | NULL | –ò—Å—Ö–æ–¥—è—â–∏–π JSON | –ü–æ–ª–Ω—ã–π JSON —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ (EXTERNAL STORAGE) |
| 8 | payment_type | VARCHAR(20) NOT NULL | ‚Äî | –¢–∏–ø –ø–ª–∞—Ç–µ–∂–∞ | –¢–∏–ø –ø–ª–∞—Ç–µ–∂–∞: I/O/T/M/V |
| 9 | resolution | VARCHAR(20) NOT NULL | ‚Äî | –†–µ–∑–æ–ª—é—Ü–∏—è | –ò—Ç–æ–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ: allow/review/deny/empty |
| 10 | list_codes | TEXT[] | NULL | –ö–æ–¥—ã —Å–ø–∏—Å–∫–æ–≤ | –ú–∞—Å—Å–∏–≤ –∫–æ–¥–æ–≤ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤ (GIN –∏–Ω–¥–µ–∫—Å) |
| 11 | has_bypass | VARCHAR(10) | 'empty' | –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ | –ü—Ä–∏–∑–Ω–∞–∫ –æ–±—Ö–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: yes/no/empty |

#### –î–∞–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∞ (–ø–æ–ª—è 12-30, 19 –ø–æ–ª–µ–π)

**–ì—Ä—É–ø–ø–∞: paymentInfo (3 –ø–æ–ª—è)**
| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|
| 12 | payment_id | TEXT | NULL | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–ª–∞—Ç–µ–∂–∞ |
| 13 | payment_purpose | TEXT | NULL | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ |
| 14 | amount | TEXT | NULL | –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞ |

**–ì—Ä—É–ø–ø–∞: –°—á–µ—Ç–∞ (2 –ø–æ–ª—è)**
| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|
| 15 | account_debet | TEXT | NULL | –°—á—ë—Ç –¥–µ–±–µ—Ç–∞ |
| 16 | account_credit | TEXT | NULL | –°—á—ë—Ç –∫—Ä–µ–¥–∏—Ç–∞ |

**–ì—Ä—É–ø–ø–∞: payerInfo (5 –ø–æ–ª–µ–π)**
| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|
| 17 | payer_inn | TEXT | NULL | –ò–ù–ù –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 18 | payer_name | TEXT | NULL | –ò–º—è –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 19 | payer_account_number | TEXT | NULL | –ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 20 | payer_document_type | TEXT | NULL | –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 21 | payer_bank_name | TEXT | NULL | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |

**–ì—Ä—É–ø–ø–∞: receiverInfo (6 –ø–æ–ª–µ–π)**
| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|
| 22 | receiver_name | TEXT | NULL | –ò–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 23 | receiver_inn | TEXT | NULL | –ò–ù–ù –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 24 | receiver_account_number | TEXT | NULL | –ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 25 | receiver_document_type | TEXT | NULL | –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 26 | receiver_bank_name | TEXT | NULL | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 27 | payer_bank_account_number | TEXT | NULL | –ö/—Å –±–∞–Ω–∫–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |

**–ì—Ä—É–ø–ø–∞: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã (3 –ø–æ–ª—è)**
| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|
| 28 | receiver_bank_account_number | TEXT | NULL | –ö/—Å –±–∞–Ω–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 29 | currency | TEXT | NULL | –í–∞–ª—é—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞ |
| 30 | currency_control | TEXT | NULL | –ü—Ä–∏–∑–Ω–∞–∫ –≤–∞–ª—é—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è |

#### Kafka –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–ø–æ–ª—è 31-34, 4 –ø–æ–ª—è)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 31 | input_kafka_headers | JSONB | NULL | Kafka headers –≤—Ö–æ–¥—è—â–µ–≥–æ | –ó–∞–≥–æ–ª–æ–≤–∫–∏ Kafka (upoa_enriched_transactions) EXTERNAL STORAGE |
| 32 | output_kafka_headers | JSONB | NULL | Kafka headers –∏—Å—Ö–æ–¥—è—â–µ–≥–æ | –ó–∞–≥–æ–ª–æ–≤–∫–∏ Kafka (upoa_ksk_results) EXTERNAL STORAGE |
| 33 | input_kafka_partition | INTEGER | NULL | Kafka partition | –ù–æ–º–µ—Ä –ø–∞—Ä—Ç–∏—Ü–∏–∏ Kafka –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (—Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞) |
| 34 | input_kafka_offset | BIGINT | NULL | Kafka offset | Offset –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (—É–Ω–∏–∫–∞–ª–µ–Ω —Å partition) |

---

#### –ò–Ω–¥–µ–∫—Å—ã (5 —à—Ç)

| ‚Ññ | –ò–º—è | –¢–∏–ø | –ö–æ–ª–æ–Ω–∫–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|-----|-----|---------|------------|
| 1 | idx_ksk_result_corr_id | B-tree | (corr_id) | –ü–æ–∏—Å–∫ –ø–æ correlation ID |
| 2 | idx_ksk_result_output_ts_brin | BRIN | (output_timestamp) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º (~1000x –º–µ–Ω—å—à–µ B-tree) |
| 3 | idx_ksk_result_list_codes_gin | GIN | (list_codes) | –ü–æ–∏—Å–∫ –ø–æ –º–∞—Å—Å–∏–≤—É –∫–æ–¥–æ–≤ —Å–ø–∏—Å–∫–æ–≤ |
| 4 | idx_ksk_result_aggregation | B-tree Covering | (output_timestamp, resolution, has_bypass) INCLUDE (payment_type) | Index-only scan –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤ |
| 5 | idx_ksk_result_payment_type | B-tree | (payment_type) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π |

**–°–≤—è–∑–∏:** ‚Üí ksk_figurant (1:N)

---

### 2. ksk_figurant (15 –ø–æ–ª–µ–π, 5 –∏–Ω–¥–µ–∫—Å–æ–≤)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–æ–≤ –ø–æ –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏  
**–û–±—ä—ë–º:** ~100-500 —Ñ–∏–≥—É—Ä–∞–Ω—Ç–æ–≤ –Ω–∞ 1M —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π  
**–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:** `PARTITION BY RANGE (timestamp)` ‚Äî **–ø–µ—Ä–∏–æ–¥ 1 –î–ï–ù–¨**  
**PRIMARY KEY:** `(id, timestamp)`

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π (15 –ø–æ–ª–µ–π)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY | AUTO | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ (PRIMARY KEY) |
| 2 | source_id | INTEGER NOT NULL | ‚Äî | ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | –°—Å—ã–ª–∫–∞ –Ω–∞ ksk_result.id (N:1 —Å–≤—è–∑—å, FK —Å CASCADE DELETE) |
| 3 | date | DATE NOT NULL | ‚Äî | –î–∞—Ç–∞ | –î–∞—Ç–∞ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å ksk_result.date, –ù–ï –∫–ª—é—á –ø–∞—Ä—Ç–∏—Ü–∏–∏) |
| 4 | timestamp | TIMESTAMP(3) NOT NULL | ‚Äî | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ (PRIMARY KEY, **–ö–õ–Æ–ß –ü–ê–†–¢–ò–¶–ò–ò**, = output_timestamp) |
| 5 | figurant | JSONB NOT NULL | ‚Äî | –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è | –ü–æ–ª–Ω—ã–π JSON —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ –∏–∑ output_json.searchCheckResultKCKH (EXTERNAL STORAGE) |
| 6 | figurant_index | INTEGER NOT NULL | ‚Äî | –ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä | –ò–Ω–¥–µ–∫—Å —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ –≤ –º–∞—Å—Å–∏–≤–µ searchCheckResultKCKH (0, 1, 2...) |
| 7 | resolution | VARCHAR(20) NOT NULL | ‚Äî | –†–µ–∑–æ–ª—é—Ü–∏—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ | –†–µ—à–µ–Ω–∏–µ –ø–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç—É: allow/review/deny (–≤—ã—á–∏—Å–ª–µ–Ω–æ check_figurant_status) |
| 8 | is_bypass | VARCHAR(10) | 'no' | –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ | –ü—Ä–∏–∑–Ω–∞–∫ –æ–±—Ö–æ–¥–∞: yes/no (–¢–û–õ–¨–ö–û –î–í–ê –ó–ù–ê–ß–ï–ù–ò–Ø!) |
| 9 | list_code | TEXT | NULL | –ö–æ–¥ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ | –ö–æ–¥ —Å–ø–∏—Å–∫–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É —Å—Ä–∞–±–æ—Ç–∞–ª–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (SDN, OFAC, –∏ —Ç.–¥.) |
| 10 | name_figurant | TEXT | NULL | –ò–º—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ | –ü–æ–ª–Ω–æ–µ –∏–º—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ –∏–∑ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ |
| 11 | president_group | TEXT | NULL | –ü—Ä–µ–∑–∏–¥–µ–Ω—Ç—Å–∫–∞—è –≥—Ä—É–ø–ø–∞ | –¢–∏–ø –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç—Å–∫–æ–π –≥—Ä—É–ø–ø—ã: part/full/none (–¥–ª—è –º–∞—Ç—Ä–∏—Ü—ã check_figurant_status) |
| 12 | auto_login | BOOLEAN | NULL | –ê–≤—Ç–æ–≤—Ö–æ–¥ | –ü—Ä–∏–∑–Ω–∞–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É (–≤–ª–∏—è–µ—Ç –Ω–∞ resolution) |
| 13 | has_exclusion | BOOLEAN | NULL | –ù–∞–ª–∏—á–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è | –ü—Ä–∏–∑–Ω–∞–∫ –Ω–∞–ª–∏—á–∏—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ –≤ —Å–ø–∏—Å–∫–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π (–≤–ª–∏—è–µ—Ç –Ω–∞ resolution) |
| 14 | exclusion_phrase | TEXT | NULL | –§—Ä–∞–∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è | –§—Ä–∞–∑–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π, –ø–æ –∫–æ—Ç–æ—Ä–æ–π —Ñ–∏–≥—É—Ä–∞–Ω—Ç –±—ã–ª –∏—Å–∫–ª—é—á—ë–Ω |
| 15 | exclusion_name_list | TEXT | NULL | –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π | –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç |

---

#### –ò–Ω–¥–µ–∫—Å—ã (5 —à—Ç)

| ‚Ññ | –ò–º—è | –¢–∏–ø | –ö–æ–ª–æ–Ω–∫–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|-----|-----|---------|------------|
| 1 | idx_ksk_figurant_ts_brin | BRIN | (timestamp) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º (~1000x –º–µ–Ω—å—à–µ B-tree) |
| 2 | idx_ksk_figurant_list_code | B-tree Partial | (list_code) WHERE list_code IS NOT NULL | –ü–æ–∏—Å–∫ –ø–æ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–º—É —Å–ø–∏—Å–∫—É |
| 3 | idx_ksk_figurant_source_id | B-tree | (source_id) | JOIN —Å ksk_result (FK –∏–Ω–¥–µ–∫—Å) |
| 4 | idx_ksk_figurant_resolution | B-tree | (resolution) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–µ–∑–æ–ª—é—Ü–∏–∏ (–¥–ª—è –æ—Ç—á—ë—Ç–æ–≤) |
| 5 | idx_ksk_figurant_is_bypass_yes | B-tree Partial | (is_bypass) WHERE is_bypass = 'yes' | –ü–æ–∏—Å–∫ –æ–±—Ö–æ–¥–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–≤—ã—Å–æ–∫–∞—è —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å) |

**–°–≤—è–∑–∏:**
- ‚Üê ksk_result (N:1)
- ‚Üí ksk_figurant_match (1:N)

---

### 3. ksk_figurant_match (10 –ø–æ–ª–µ–π, 3 –∏–Ω–¥–µ–∫—Å–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π (match) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞  
**–û–±—ä—ë–º:** ~1-10 —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–∞ 1 —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞  
**–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:** `PARTITION BY RANGE (timestamp)` ‚Äî **–ø–µ—Ä–∏–æ–¥ 1 –î–ï–ù–¨**  
**PRIMARY KEY:** `(id, timestamp)`

**‚ö†Ô∏è –í–ê–ñ–ù–û:** Match (—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ) ‚Äî —ç—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, –Ω–∞–π–¥–µ–Ω–Ω–æ–µ –û–î–ù–ò–ú –ê–õ–ì–û–†–ò–¢–ú–û–ú. –û–¥–∏–Ω —Ñ–∏–≥—É—Ä–∞–Ω—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –ù–ï–°–ö–û–õ–¨–ö–û matches, –µ—Å–ª–∏ —Å—Ä–∞–±–æ—Ç–∞–ª–∏ —Ä–∞–∑–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–∏—Å–∫–∞.

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π (10 –ø–æ–ª–µ–π)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY | AUTO | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (PRIMARY KEY) |
| 2 | figurant_id | INTEGER NOT NULL | ‚Äî | ID —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ | –°—Å—ã–ª–∫–∞ –Ω–∞ ksk_figurant.id (N:1 —Å–≤—è–∑—å, FK —Å CASCADE DELETE) |
| 3 | date | DATE NOT NULL | ‚Äî | –î–∞—Ç–∞ | –î–∞—Ç–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å ksk_figurant.date, –ù–ï –∫–ª—é—á –ø–∞—Ä—Ç–∏—Ü–∏–∏) |
| 4 | timestamp | TIMESTAMP(3) NOT NULL | ‚Äî | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (PRIMARY KEY, **–ö–õ–Æ–ß –ü–ê–†–¢–ò–¶–ò–ò**, = ksk_figurant.timestamp) |
| 5 | match | JSONB NOT NULL | ‚Äî | –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è | –ü–æ–ª–Ω—ã–π JSON —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –∏–∑ figurant.matches (EXTERNAL STORAGE) |
| 6 | match_index | INTEGER NOT NULL | ‚Äî | –ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä | –ò–Ω–¥–µ–∫—Å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –≤ –º–∞—Å—Å–∏–≤–µ figurant.matches (0, 1, 2...) |
| 7 | algorithm | VARCHAR(100) NOT NULL | ‚Äî | –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ | –ù–∞–∑–≤–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—à—ë–ª —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ |
| 8 | match_value | TEXT | NULL | –ó–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–≤–ø–∞–ª–æ |
| 9 | match_payment_field | TEXT | NULL | –ü–æ–ª–µ –ø–ª–∞—Ç–µ–∂–∞ | –ò–º—è –ø–æ–ª—è –ø–ª–∞—Ç–µ–∂–∞, –≥–¥–µ –Ω–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ |
| 10 | match_payment_value | TEXT | NULL | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –ø–ª–∞—Ç–µ–∂–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –ø–ª–∞—Ç–µ–∂–∞, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–≤–ø–∞–ª–æ |

---

#### –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã matches –∏–∑ output JSON

**–ü—Ä–∏–º–µ—Ä 1: CROSSBORDER_TRANSFERS**
```json
{
  "algorithm": "CROSSBORDER_TRANSFERS",
  "paymentField": "payerAccountNumber",
  "paymentValue": "40817810570000100001",
  "value": "40817"
}
```
- **algorithm**: CROSSBORDER_TRANSFERS ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω—Å–≥—Ä–∞–Ω–∏—á–Ω—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤
- **paymentField**: payerAccountNumber ‚Äî –ø–æ–ª–µ "–Ω–æ–º–µ—Ä —Å—á—ë—Ç–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞"
- **paymentValue**: –ø–æ–ª–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –ø–ª–∞—Ç–µ–∂–∞
- **value**: "40817" ‚Äî —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –º–∞—Å–∫–æ–π —Å—á—ë—Ç–∞ –∏–∑ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞

---

**–ü—Ä–∏–º–µ—Ä 2: SEARCH_WORDS_DOPB**
```json
{
  "algorithm": "SEARCH_WORDS_DOPB",
  "paymentField": "paymentPurpose",
  "paymentValue": "–≤–µ—Ä—Ç–æ–ª–µ—Ç",
  "value": "–≤–µ—Ä—Ç–æ–ª–µ—Ç"
}
```
- **algorithm**: SEARCH_WORDS_DOPB ‚Äî –ø–æ–∏—Å–∫ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö —Å–ª–æ–≤
- **paymentField**: paymentPurpose ‚Äî –ø–æ–ª–µ "–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞"
- **paymentValue**: "–≤–µ—Ä—Ç–æ–ª–µ—Ç" ‚Äî —Å–ª–æ–≤–æ –∏–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞
- **value**: "–≤–µ—Ä—Ç–æ–ª–µ—Ç" ‚Äî –∑–∞–ø—Ä–µ—â—ë–Ω–Ω–æ–µ —Å–ª–æ–≤–æ –∏–∑ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞

---

**–ü—Ä–∏–º–µ—Ä 3: COMMISSION_DECISION**
```json
{
  "algorithm": "COMMISSION_DECISION",
  "paymentField": "paymentPurpose",
  "paymentValue": "–û–ø–ª–∞—Ç–∞ –ø–æ –°—á–µ—Ç—É ‚Ññ 5685 –æ—Ç 24.07.20 –∑–∞ –∫–∞–Ω—Ü–µ–ª—è—Ä—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã. –°—É–º–º–∞ 2000-00. –í —Ç. —á. –ù–î–° (20%) 333-33 –ö—É–±–∞",
  "value": "–∫—É–±–∞"
}
```
- **algorithm**: COMMISSION_DECISION ‚Äî —Ä–µ—à–µ–Ω–∏—è –∫–æ–º–∏—Å—Å–∏–∏ (—Å—Ç—Ä–∞–Ω—ã, —é—Ä–∏—Å–¥–∏–∫—Ü–∏–∏)
- **paymentField**: paymentPurpose ‚Äî –ø–æ–ª–µ "–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞"
- **paymentValue**: –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞
- **value**: "–∫—É–±–∞" ‚Äî —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Å—Ç—Ä–∞–Ω—ã –∏–∑ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞

---

#### –ò–Ω–¥–µ–∫—Å—ã (3 —à—Ç)

| ‚Ññ | –ò–º—è | –¢–∏–ø | –ö–æ–ª–æ–Ω–∫–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|-----|-----|---------|------------|
| 1 | idx_ksk_match_ts_brin | BRIN | (timestamp) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º (~1000x –º–µ–Ω—å—à–µ B-tree) |
| 2 | idx_ksk_match_figurant_id | B-tree | (figurant_id) | JOIN —Å ksk_figurant (FK –∏–Ω–¥–µ–∫—Å) |
| 3 | idx_ksk_match_algorithm | B-tree | (algorithm) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞) |

**–°–≤—è–∑–∏:** ‚Üê ksk_figurant (N:1)

---

## üîß –°–ò–°–¢–ï–ú–ù–´–ï –¢–ê–ë–õ–ò–¶–´ (2 —à—Ç)

### 4. ksk_result_error (14 –ø–æ–ª–µ–π, 5 –∏–Ω–¥–µ–∫—Å–æ–≤)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ put_ksk_result()  
**–û–±—ä—ë–º:** ~0.01-0.1% –æ—Ç –æ–±—ä—ë–º–∞ ksk_result (—Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏)

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π (14 –ø–æ–ª–µ–π)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY | AUTO | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ—à–∏–±–∫–∏ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ –æ–± –æ—à–∏–±–∫–µ |
| 2 | error_timestamp | TIMESTAMP(3) NOT NULL | NOW() | –í—Ä–µ–º—è –æ—à–∏–±–∫–∏ | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –æ—à–∏–±–∫–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ INSERT) |
| 3 | error_code | VARCHAR(50) NOT NULL | ‚Äî | –ö–æ–¥ –æ—à–∏–±–∫–∏ | MISSING_REQUIRED_FIELD, INVALID_JSON_STRUCTURE, TYPE_MISMATCH, CONSTRAINT_VIOLATION, UNKNOWN_ERROR |
| 4 | error_message | TEXT NOT NULL | ‚Äî | –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ | –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –∏–ª–∏ —Ç–µ–∫—Å—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è PostgreSQL |
| 5 | input_timestamp | TIMESTAMP(3) | NULL | –í—Ä–µ–º—è –≤—Ö–æ–¥—è—â–µ–≥–æ | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (p_input_timestamp –∏–∑ put_ksk_result) |
| 6 | output_timestamp | TIMESTAMP(3) | NULL | –í—Ä–µ–º—è –∏—Å—Ö–æ–¥—è—â–µ–≥–æ | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (p_output_timestamp –∏–∑ put_ksk_result) |
| 7 | kafka_partition | INTEGER NOT NULL | ‚Äî | Kafka partition | –ù–æ–º–µ—Ä –ø–∞—Ä—Ç–∏—Ü–∏–∏ Kafka –≤—Ö–æ–¥—è—â–µ–≥–æ —Ç–æ–ø–∏–∫–∞ (–¥–ª—è replay –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π) |
| 8 | kafka_offset | BIGINT NOT NULL | ‚Äî | Kafka offset | Offset —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Kafka –ø–∞—Ä—Ç–∏—Ü–∏–∏ (—É–Ω–∏–∫–∞–ª–µ–Ω –≤–º–µ—Å—Ç–µ —Å partition, –¥–ª—è replay) |
| 9 | input_kafka_headers | JSONB | NULL | Kafka headers –≤—Ö–æ–¥—è—â–µ–≥–æ | –ü–æ–ª–Ω—ã–µ Kafka headers upoa_enriched_transactions (EXTERNAL STORAGE) |
| 10 | output_kafka_headers | JSONB | NULL | Kafka headers –∏—Å—Ö–æ–¥—è—â–µ–≥–æ | –ü–æ–ª–Ω—ã–µ Kafka headers upoa_ksk_results (EXTERNAL STORAGE) |
| 11 | corr_id | VARCHAR(100) | NULL | Correlation ID | Correlation ID –∏–∑ input_json.corrId (–º–æ–∂–µ—Ç –±—ã—Ç—å NULL –ø—Ä–∏ –±–∏—Ç–æ–º JSON) |
| 12 | input_json | JSONB NOT NULL | ‚Äî | –í—Ö–æ–¥—è—â–∏–π JSON | –ü–æ–ª–Ω—ã–π –¥–∞–º–ø –≤—Ö–æ–¥—è—â–µ–≥–æ JSON –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –±–∏—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö (EXTERNAL STORAGE) |
| 13 | output_json | JSONB | NULL | –ò—Å—Ö–æ–¥—è—â–∏–π JSON | –ü–æ–ª–Ω—ã–π –¥–∞–º–ø –∏—Å—Ö–æ–¥—è—â–µ–≥–æ JSON (EXTERNAL STORAGE, –º–æ–∂–µ—Ç –±—ã—Ç—å NULL) |
| 14 | function_context | TEXT | NULL | –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ | –°—Ç–µ–∫-—Ç—Ä–µ–π—Å, SQLSTATE –∫–æ–¥, –∏–ª–∏ –¥—Ä—É–≥–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è |

---

#### –ò–Ω–¥–µ–∫—Å—ã (5 —à—Ç)

| ‚Ññ | –ò–º—è | –¢–∏–ø | –ö–æ–ª–æ–Ω–∫–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|-----|-----|---------|------------|
| 1 | idx_ksk_result_error_timestamp | BRIN | (error_timestamp) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –æ—à–∏–±–∫–∏ (~1000x –º–µ–Ω—å—à–µ B-tree) |
| 2 | idx_ksk_result_error_error_code | B-tree | (error_code) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É –æ—à–∏–±–∫–∏ (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥) |
| 3 | idx_ksk_result_error_kafka_meta | B-tree Composite | (kafka_partition, kafka_offset) | –ü–æ–∏—Å–∫ –ø–æ Kafka –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º –¥–ª—è replay |
| 4 | idx_ksk_result_error_corr_id | B-tree Partial | (corr_id) WHERE corr_id IS NOT NULL | –ü–æ–∏—Å–∫ –ø–æ correlation ID (—Ç–æ–ª—å–∫–æ NOT NULL) |
| 5 | idx_ksk_result_error_output_ts | BRIN | (output_timestamp) | –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è —Å —Ç–∞–±–ª–∏—Ü–µ–π ksk_result –ø–æ output_timestamp |

---

### 5. ksk_system_operations_log (9 –ø–æ–ª–µ–π, 3 –∏–Ω–¥–µ–∫—Å–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (CRON, maintenance, cleanup)  
**–û–±—ä—ë–º:** ~100-1000 –∑–∞–ø–∏—Å–µ–π/–¥–µ–Ω—å

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π (9 –ø–æ–ª–µ–π)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY | AUTO | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ª–æ–≥–∞ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è |
| 2 | operation_code | VARCHAR(50) NOT NULL | ‚Äî | –ö–æ–¥ –æ–ø–µ—Ä–∞—Ü–∏–∏ | create_partitions, drop_partitions, cleanup_empty, run_report, monitor_bloat, –∏ —Ç.–¥. |
| 3 | operation_name | VARCHAR(200) NOT NULL | ‚Äî | –ù–∞–∑–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ | –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ |
| 4 | begin_time | TIMESTAMP(3) NOT NULL | NOW() | –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ | –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ INSERT) |
| 5 | end_time | TIMESTAMP(3) | NULL | –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è | –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ) |
| 6 | duration | INTERVAL | NULL | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ (–≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è: end_time - begin_time) |
| 7 | status | VARCHAR(20) NOT NULL | ‚Äî | –°—Ç–∞—Ç—É—Å | success –∏–ª–∏ error (CHECK constraint: status IN ('success', 'error')) |
| 8 | info | TEXT | NULL | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (JSON –∏–ª–∏ —Ç–µ–∫—Å—Ç) |
| 9 | err_msg | TEXT | NULL | –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ | –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è status='error') |

---

#### –ò–Ω–¥–µ–∫—Å—ã (3 —à—Ç)

| ‚Ññ | –ò–º—è | –¢–∏–ø | –ö–æ–ª–æ–Ω–∫–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|-----|-----|---------|------------|
| 1 | idx_ksk_system_operations_log_operation_code | B-tree | (operation_code) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–æ–≤ –ø–æ –∫–æ–¥—É –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| 2 | idx_ksk_system_operations_log_begin_time | B-tree | (begin_time) | –í—Ä–µ–º–µ–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–æ–≤ |
| 3 | idx_ksk_system_operations_log_status | B-tree | (status) | –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ (WHERE status = 'error') |

---

## üìä –¢–ò–ü–´ –û–¢–ß–Å–¢–û–í (5 —à—Ç)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –æ—Ç—á—ë—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ –ö–°–ö

**‚öôÔ∏è –•—Ä–∞–Ω–µ–Ω–∏–µ:** –¢–∞–±–ª–∏—Ü–∞ `ksk_report_orchestrator` ‚Äî —Å–º. [–û—Ç—á—ë—Ç–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã](#–æ—Ç—á—ë—Ç–Ω—ã–µ-—Ç–∞–±–ª–∏—Ü—ã)  
**‚öôÔ∏è –ó–∞–ø—É—Å–∫:** –§—É–Ω–∫—Ü–∏—è `ksk_run_report()` ‚Äî —Å–º. [–§—É–Ω–∫—Ü–∏–∏](#—Ñ—É–Ω–∫—Ü–∏–∏)

### –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –æ—Ç—á—ë—Ç–æ–≤

| report_code | report_function | report_table | name | system_ttl | user_ttl |
|-------------|-----------------|--------------|------|------------|----------|
| `totals` | ksk_report_totals | ksk_report_totals_data | –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | 365 | 14 |
| `totals_by_payment_type` | ksk_report_totals_by_payment_type | ksk_report_totals_by_payment_type_data | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π | 365 | 14 |
| `list_totals` | ksk_report_list_totals | ksk_report_list_totals_data | –ò—Ç–æ–≥–∏ –ø–æ —Å–ø–∏—Å–∫–∞–º | 365 | 14 |
| `list_totals_by_payment_type` | ksk_report_list_totals_by_payment_type | ksk_report_list_totals_by_payment_type_data | –ò—Ç–æ–≥–∏ –ø–æ —Å–ø–∏—Å–∫–∞–º –∏ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π | 365 | 14 |
| `figurants` | ksk_report_figurants | ksk_report_figurants_data | –û—Ç—á—ë—Ç –ø–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞–º | 30 | 7 |

---

### –°—Ö–µ–º–∞ —Å–≤—è–∑–µ–π

```
ksk_run_report('totals', ...)
    ‚Üì
    –ß–∏—Ç–∞–µ—Ç ksk_report_orchestrator: report_code='totals'
    ‚Üì
    –í—ã–∑—ã–≤–∞–µ—Ç report_function: ksk_report_totals()
    ‚Üì
    –í—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ report_table: ksk_report_totals_data
```

---

### –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –æ—Ç—á—ë—Ç–æ–≤

#### 1. totals ‚Äî –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º –∑–∞ –ø–µ—Ä–∏–æ–¥  
**–î–∞–Ω–Ω—ã–µ:** 7 —Å—á—ë—Ç—á–∏–∫–æ–≤ (total, total_without_result, total_with_result, total_allow, total_review, total_deny, total_bypass)  
**–¢–∞–±–ª–∏—Ü–∞:** ksk_report_totals_data (10 –ø–æ–ª–µ–π) ‚Äî —Å–º. [–û—Ç—á—ë—Ç–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã](#–æ—Ç—á—ë—Ç–Ω—ã–µ-—Ç–∞–±–ª–∏—Ü—ã)  
**–§—É–Ω–∫—Ü–∏—è:** ksk_report_totals() ‚Äî —Å–º. [–§—É–Ω–∫—Ü–∏–∏](#—Ñ—É–Ω–∫—Ü–∏–∏)  
**TTL:** 365 –¥–Ω–µ–π (system) / 14 –¥–Ω–µ–π (user)

---

#### 2. totals_by_payment_type ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ 5 —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π (I/O/T/M/V)  
**–î–∞–Ω–Ω—ã–µ:** 7 –æ–±—â–∏—Ö —Å—á—ë—Ç—á–∏–∫–æ–≤ + 5 –≥—Ä—É–ø–ø –ø–æ 7 —Å—á—ë—Ç—á–∏–∫–æ–≤ (44 –ø–æ–ª—è)  
**–¢–∞–±–ª–∏—Ü–∞:** ksk_report_totals_by_payment_type_data (44 –ø–æ–ª—è) ‚Äî —Å–º. [–û—Ç—á—ë—Ç–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã](#–æ—Ç—á—ë—Ç–Ω—ã–µ-—Ç–∞–±–ª–∏—Ü—ã)  
**–§—É–Ω–∫—Ü–∏—è:** ksk_report_totals_by_payment_type() ‚Äî —Å–º. [–§—É–Ω–∫—Ü–∏–∏](#—Ñ—É–Ω–∫—Ü–∏–∏)  
**TTL:** 365 –¥–Ω–µ–π (system) / 14 –¥–Ω–µ–π (user)

---

#### 3. list_totals ‚Äî –ò—Ç–æ–≥–∏ –ø–æ —Å–ø–∏—Å–∫–∞–º

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –∫–æ–¥–∞–º —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤  
**–î–∞–Ω–Ω—ã–µ:** 6 —Å—á—ë—Ç—á–∏–∫–æ–≤ –Ω–∞ –∫–∞–∂–¥—ã–π —Å–ø–∏—Å–æ–∫ (total_with_list, total_without_list, total_allow, total_review, total_deny, total_bypass)  
**–¢–∞–±–ª–∏—Ü–∞:** ksk_report_list_totals_data (10 –ø–æ–ª–µ–π) ‚Äî —Å–º. [–û—Ç—á—ë—Ç–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã](#–æ—Ç—á—ë—Ç–Ω—ã–µ-—Ç–∞–±–ª–∏—Ü—ã)  
**–§—É–Ω–∫—Ü–∏—è:** ksk_report_list_totals() ‚Äî —Å–º. [–§—É–Ω–∫—Ü–∏–∏](#—Ñ—É–Ω–∫—Ü–∏–∏)  
**TTL:** 365 –¥–Ω–µ–π (system) / 14 –¥–Ω–µ–π (user)

---

#### 4. list_totals_by_payment_type ‚Äî –ò—Ç–æ–≥–∏ –ø–æ —Å–ø–∏—Å–∫–∞–º –∏ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –∫–æ–¥–∞–º —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤ —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ 5 —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π  
**–î–∞–Ω–Ω—ã–µ:** 6 –æ–±—â–∏—Ö —Å—á—ë—Ç—á–∏–∫–æ–≤ + 5 –≥—Ä—É–ø–ø –ø–æ 6 —Å—á—ë—Ç—á–∏–∫–æ–≤ (39 –ø–æ–ª–µ–π)  
**–¢–∞–±–ª–∏—Ü–∞:** ksk_report_list_totals_by_payment_type_data (39 –ø–æ–ª–µ–π) ‚Äî —Å–º. [–û—Ç—á—ë—Ç–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã](#–æ—Ç—á—ë—Ç–Ω—ã–µ-—Ç–∞–±–ª–∏—Ü—ã)  
**–§—É–Ω–∫—Ü–∏—è:** ksk_report_list_totals_by_payment_type() ‚Äî —Å–º. [–§—É–Ω–∫—Ü–∏–∏](#—Ñ—É–Ω–∫—Ü–∏–∏)  
**TTL:** 365 –¥–Ω–µ–π (system) / 14 –¥–Ω–µ–π (user)

---

#### 5. figurants ‚Äî –û—Ç—á—ë—Ç –ø–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞–º

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É —Ñ–∏–≥—É—Ä–∞–Ω—Ç—É  
**–î–∞–Ω–Ω—ã–µ:** 5 —Å—á—ë—Ç—á–∏–∫–æ–≤ –Ω–∞ –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ (total, total_allow, total_review, total_deny, total_bypass) + –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ  
**–¢–∞–±–ª–∏—Ü–∞:** ksk_report_figurants_data (12 –ø–æ–ª–µ–π) ‚Äî —Å–º. [–û—Ç—á—ë—Ç–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã](#–æ—Ç—á—ë—Ç–Ω—ã–µ-—Ç–∞–±–ª–∏—Ü—ã)  
**–§—É–Ω–∫—Ü–∏—è:** ksk_report_figurants() ‚Äî —Å–º. [–§—É–Ω–∫—Ü–∏–∏](#—Ñ—É–Ω–∫—Ü–∏–∏)  
**TTL:** 30 –¥–Ω–µ–π (system) / 7 –¥–Ω–µ–π (user)  
**‚ö†Ô∏è –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `p_parameters` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∫–æ–¥–∞–º —Å–ø–∏—Å–∫–æ–≤

---

## üìã –û–¢–ß–Å–¢ –ü–û –°–û–í–ü–ê–î–ï–ù–ò–Ø–ú

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–µ—Ç–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, —Ç—Ä–µ–±—É—é—â–∏—Ö —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (resolution='review')  
**–°–∏–Ω–æ–Ω–∏–º—ã:** –û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–∞–º, –ü—Ä–æ–≤–µ—Ä–∫–∏  
**–¢–∏–ø:** VIEW-—Ñ—É–Ω–∫—Ü–∏—è (–±–µ–∑ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏)

**‚öôÔ∏è –§—É–Ω–∫—Ü–∏—è:** `ksk_report_review()` ‚Äî —Å–º. [–§—É–Ω–∫—Ü–∏–∏](#—Ñ—É–Ω–∫—Ü–∏–∏)

---

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –û–±—ã—á–Ω—ã–µ –æ—Ç—á—ë—Ç—ã (totals, list_totals, figurants) | ksk_report_review |
|----------|--------------------------------------------------|-------------------|
| **–í—ã–∑–æ–≤** | –ß–µ—Ä–µ–∑ ksk_run_report('totals', ...) | –ù–∞–ø—Ä—è–º—É—é SELECT * FROM ksk_report_review('2025-10-22') |
| **–•—Ä–∞–Ω–µ–Ω–∏–µ** | –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ (ksk_report_*_data) | –ù–ï–¢ —Ö—Ä–∞–Ω–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ VIEW/query) |
| **–ó–∞–≥–æ–ª–æ–≤–æ–∫** | –°–æ–∑–¥–∞—ë—Ç—Å—è –≤ ksk_report_header | –ù–ï–¢ –∑–∞–≥–æ–ª–æ–≤–∫–∞ |
| **TTL** | 7-365 –¥–Ω–µ–π | –ù–µ—Ç (–¥–∞–Ω–Ω—ã–µ –ù–ï —Ö—Ä–∞–Ω—è—Ç—Å—è) |
| **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä** | –ï—Å—Ç—å –∑–∞–ø–∏—Å—å –≤ ksk_report_orchestrator | –ù–ï–¢ –∑–∞–ø–∏—Å–∏ –≤ orchestrator |
| **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** | –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | –î–µ—Ç–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ |

---

### –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –ø–æ–ª—è (35 –ø–æ–ª–µ–π)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|--------------|----------|
| 1 | corr_id | VARCHAR(100) | –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π ID | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ |
| 2 | message_timestamp | TIMESTAMP(3) | –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è (output_timestamp) |
| 3 | algorithm | VARCHAR(100) | –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ | –ù–∞–∑–≤–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞, –Ω–∞—à–µ–¥—à–µ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ |
| 4 | match_value | TEXT | –ó–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–≤–ø–∞–ª–æ |
| 5 | match_payment_field | TEXT | –ü–æ–ª–µ –ø–ª–∞—Ç–µ–∂–∞ | –ò–º—è –ø–æ–ª—è –ø–ª–∞—Ç–µ–∂–∞, –≥–¥–µ –Ω–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ |
| 6 | match_payment_value | TEXT | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –ø–ª–∞—Ç–µ–∂–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –ø–ª–∞—Ç–µ–∂–∞, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–≤–ø–∞–ª–æ |
| 7 | list_code | TEXT | –ö–æ–¥ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ | –ö–æ–¥ —Å–ø–∏—Å–∫–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É —Å—Ä–∞–±–æ—Ç–∞–ª–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ |
| 8 | name_figurant | TEXT | –ò–º—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ | –ü–æ–ª–Ω–æ–µ –∏–º—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ –∏–∑ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ |
| 9 | president_group | TEXT | –ü—Ä–µ–∑–∏–¥–µ–Ω—Ç—Å–∫–∞—è –≥—Ä—É–ø–ø–∞ | –¢–∏–ø –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç—Å–∫–æ–π –≥—Ä—É–ø–ø—ã: part/full/none |
| 10 | auto_login | BOOLEAN | –ê–≤—Ç–æ–≤—Ö–æ–¥ | –ü—Ä–∏–∑–Ω–∞–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É |
| 11 | has_exclusion | BOOLEAN | –ù–∞–ª–∏—á–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è | –ü—Ä–∏–∑–Ω–∞–∫ –Ω–∞–ª–∏—á–∏—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ –≤ —Å–ø–∏—Å–∫–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π |
| 12 | exclusion_phrase | TEXT | –§—Ä–∞–∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è | –§—Ä–∞–∑–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π |
| 13 | exclusion_name_list | TEXT | –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π | –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π |
| 14 | is_bypass | VARCHAR(10) | –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ | –ü—Ä–∏–∑–Ω–∞–∫ –æ–±—Ö–æ–¥–∞ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞: yes/no |
| 15 | transaction_resolution | VARCHAR(20) | –†–µ–∑–æ–ª—é—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | –†–µ—à–µ–Ω–∏–µ –ø–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: allow/review/deny/empty |
| 16 | figurant_resolution | VARCHAR(20) | –†–µ–∑–æ–ª—é—Ü–∏—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ | –†–µ—à–µ–Ω–∏–µ –ø–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç—É: allow/review/deny |
| 17 | payment_id | TEXT | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–ª–∞—Ç–µ–∂–∞ | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–ª–∞—Ç–µ–∂–∞ |
| 18 | payment_purpose | TEXT | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ |
| 19 | account_debet | TEXT | –°—á—ë—Ç –¥–µ–±–µ—Ç–∞ | –°—á—ë—Ç –¥–µ–±–µ—Ç–∞ |
| 20 | account_credit | TEXT | –°—á—ë—Ç –∫—Ä–µ–¥–∏—Ç–∞ | –°—á—ë—Ç –∫—Ä–µ–¥–∏—Ç–∞ |
| 21 | payer_inn | TEXT | –ò–ù–ù –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ | –ò–ù–ù –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 22 | payer_name | TEXT | –ò–º—è –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ | –ò–º—è –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 23 | payer_account_number | TEXT | –ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ | –ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 24 | payer_document_type | TEXT | –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ | –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 25 | payer_bank_name | TEXT | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 26 | payer_bank_account_number | TEXT | –ö/—Å –±–∞–Ω–∫–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ | –ö/—Å –±–∞–Ω–∫–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 27 | receiver_account_number | TEXT | –ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è | –ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 28 | receiver_name | TEXT | –ò–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è | –ò–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 29 | receiver_inn | TEXT | –ò–ù–ù –ø–æ–ª—É—á–∞—Ç–µ–ª—è | –ò–ù–ù –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 30 | receiver_bank_name | TEXT | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 31 | receiver_bank_account_number | TEXT | –ö/—Å –±–∞–Ω–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è | –ö/—Å –±–∞–Ω–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 32 | receiver_document_type | TEXT | –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è | –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 33 | amount | TEXT | –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞ | –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞ |
| 34 | currency | TEXT | –í–∞–ª—é—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞ | –í–∞–ª—é—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞ |
| 35 | currency_control | TEXT | –ü—Ä–∏–∑–Ω–∞–∫ –≤–∞–ª—é—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è | –ü—Ä–∏–∑–Ω–∞–∫ –≤–∞–ª—é—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è |

---

## üìà –û–¢–ß–Å–¢–ù–´–ï –¢–ê–ë–õ–ò–¶–´ (7 —à—Ç, 137 –ø–æ–ª–µ–π)

**‚öôÔ∏è –û–±—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á—ë—Ç–æ–≤
- –°–≤—è–∑–∏: –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–≤—è–∑–∞–Ω—ã —Å ksk_report_header —á–µ—Ä–µ–∑ report_header_id (CASCADE DELETE)
- –ò–Ω–¥–µ–∫—Å—ã: –ú–∏–Ω–∏–º—É–º FK –∏–Ω–¥–µ–∫—Å—ã, –±–µ–∑ –∏–∑–ª–∏—à–Ω–∏—Ö

---

### 6. ksk_report_orchestrator (9 –ø–æ–ª–µ–π, 1 –∏–Ω–¥–µ–∫—Å)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç–∏–ø–æ–≤ –æ—Ç—á—ë—Ç–æ–≤ (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫)

**üìã –°–º. –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –æ—Ç—á—ë—Ç–æ–≤:** [–¢–∏–ø—ã –æ—Ç—á—ë—Ç–æ–≤](#—Ç–∏–ø—ã-–æ—Ç—á—ë—Ç–æ–≤)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY | AUTO | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–∏–ø–∞ –æ—Ç—á—ë—Ç–∞ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–∏–ø–∞ –æ—Ç—á—ë—Ç–∞ |
| 2 | report_code | VARCHAR(50) NOT NULL UNIQUE | ‚Äî | –ö–æ–¥ –æ—Ç—á—ë—Ç–∞ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥: totals, list_totals, figurants, –∏ —Ç.–¥. (UNIQUE —Å–æ–∑–¥–∞—ë—Ç –∏–Ω–¥–µ–∫—Å) |
| 3 | report_table | VARCHAR(100) | NULL | –¢–∞–±–ª–∏—Ü–∞ –¥–∞–Ω–Ω—ã—Ö | –ò–º—è —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç—á—ë—Ç–∞ |
| 4 | report_function | VARCHAR(100) NOT NULL | ‚Äî | –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ | –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–∞ |
| 5 | name | VARCHAR(200) NOT NULL | ‚Äî | –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞ | –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ |
| 6 | system_ttl | INTEGER NOT NULL | 30 | TTL —Å–∏—Å—Ç–µ–º–Ω—ã—Ö | TTL –≤ –¥–Ω—è—Ö –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤ |
| 7 | user_ttl | INTEGER NOT NULL | 7 | TTL –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö | TTL –≤ –¥–Ω—è—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –æ—Ç—á—ë—Ç–æ–≤ |
| 8 | created_at | TIMESTAMP | NOW() | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ —Ç–∏–ø–∞ –æ—Ç—á—ë—Ç–∞ |
| 9 | updated_at | TIMESTAMP | NOW() | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ |

**–ò–Ω–¥–µ–∫—Å:** UNIQUE (report_code) ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è constraint-–æ–º

**–°–≤—è–∑–∏:** ‚Üí ksk_report_header (1:N)

---

### 7. ksk_report_header (13 –ø–æ–ª–µ–π, 4 –∏–Ω–¥–µ–∫—Å–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç—á—ë—Ç–æ–≤ (—ç–∫–∑–µ–º–ø–ª—è—Ä—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY | AUTO | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ—Ç—á—ë—Ç–∞ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –æ—Ç—á—ë—Ç–∞ |
| 2 | orchestrator_id | INTEGER NOT NULL | ‚Äî | ID —Ç–∏–ø–∞ –æ—Ç—á—ë—Ç–∞ | –°—Å—ã–ª–∫–∞ –Ω–∞ ksk_report_orchestrator.id (FK —Å CASCADE DELETE) |
| 3 | name | VARCHAR(500) NOT NULL | ‚Äî | –ù–∞–∑–≤–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –æ—Ç—á—ë—Ç–∞ |
| 4 | initiator | VARCHAR(100) NOT NULL | ‚Äî | –ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä | –ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω–∏—è: system –∏–ª–∏ user (CHECK constraint) |
| 5 | user_login | VARCHAR(100) | NULL | –õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | –õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø—Ä–∏ initiator='user') |
| 6 | created_datetime | TIMESTAMP NOT NULL | NOW() | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á—ë—Ç–∞ |
| 7 | finished_datetime | TIMESTAMP | NULL | –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–∞ |
| 8 | status | VARCHAR(20) NOT NULL | 'created' | –°—Ç–∞—Ç—É—Å | –°—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: created, in_progress, done, error (CHECK constraint) |
| 9 | ttl | INTEGER NOT NULL | ‚Äî | TTL | Time-to-live –≤ –¥–Ω—è—Ö –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞ (–∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –∏–∑ orchestrator) |
| 10 | remove_date | DATE NOT NULL | ‚Äî | –î–∞—Ç–∞ —É–¥–∞–ª–µ–Ω–∏—è | –î–∞—Ç–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ—Ç—á—ë—Ç–∞ (—Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è: created_datetime + ttl) |
| 11 | start_date | DATE | NULL | –ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞ | –ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞ –æ—Ç—á—ë—Ç–∞ (—Ñ–∏–ª—å—Ç—Ä –¥–∞–Ω–Ω—ã—Ö) |
| 12 | end_date | DATE | NULL | –ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ | –ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ –æ—Ç—á—ë—Ç–∞ (—Ñ–∏–ª—å—Ç—Ä –¥–∞–Ω–Ω—ã—Ö) |
| 13 | parameters | JSONB | NULL | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç—á—ë—Ç–∞ | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç—á—ë—Ç–∞ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ |

---

#### –ò–Ω–¥–µ–∫—Å—ã (4 —à—Ç)

| ‚Ññ | –ò–º—è | –¢–∏–ø | –ö–æ–ª–æ–Ω–∫–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|-----|-----|---------|------------|
| 1 | idx_ksk_report_header_orchestrator_id | B-tree | (orchestrator_id) | JOIN —Å ksk_report_orchestrator (FK –∏–Ω–¥–µ–∫—Å) |
| 2 | idx_ksk_report_header_status | B-tree | (status) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ |
| 3 | idx_ksk_report_header_remove_date | B-tree | (remove_date) | –ü–æ–∏—Å–∫ –æ—Ç—á—ë—Ç–æ–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è (TTL) |
| 4 | idx_ksk_report_header_created_datetime | B-tree | (created_datetime) | –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –æ—Ç—á—ë—Ç–æ–≤ |

**–°–≤—è–∑–∏:**
- ‚Üê ksk_report_orchestrator (N:1)
- ‚Üí –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –¥–∞–Ω–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤ (1:N)

**Constraints:**
- CHECK: initiator IN ('system', 'user')
- CHECK: status IN ('created', 'in_progress', 'done', 'error')
- CHECK: (initiator='user' AND user_login IS NOT NULL) OR (initiator='system' AND user_login IS NULL)

---

### 8-12. –¢–∞–±–ª–∏—Ü—ã –¥–∞–Ω–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤ (5 —Ç–∞–±–ª–∏—Ü, 115 –ø–æ–ª–µ–π)

**‚öôÔ∏è –û–±—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–≤—è–∑–∞–Ω—ã —Å ksk_report_header (FK —Å CASCADE DELETE)
- –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏–º–µ—é—Ç –ø–æ–ª–µ created_date_time TIMESTAMP –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏–º–µ—é—Ç –º–∏–Ω–∏–º—É–º 1 FK –∏–Ω–¥–µ–∫—Å –Ω–∞ report_header_id

---

#### 8. ksk_report_totals_data (10 –ø–æ–ª–µ–π, 2 –∏–Ω–¥–µ–∫—Å–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º –∑–∞ –ø–µ—Ä–∏–æ–¥

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ |
|---|------|-----|--------------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ |
| 2 | report_header_id | INTEGER NOT NULL (FK) | ID –æ—Ç—á—ë—Ç–∞ |
| 3 | created_date_time | TIMESTAMP NOT NULL DEFAULT NOW() | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ |
| 4 | total | INTEGER NOT NULL | –í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ |
| 5 | total_without_result | INTEGER NOT NULL | –í—Å–µ–≥–æ –±–µ–∑ —Å—Ä–∞–±–æ—Ç–æ–∫ (resolution='empty') |
| 6 | total_with_result | INTEGER NOT NULL | –í—Å–µ–≥–æ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º (resolution IN ('allow','review','deny')) |
| 7 | total_allow | INTEGER NOT NULL | –° —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º "allow" |
| 8 | total_review | INTEGER NOT NULL | –° —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º "review" |
| 9 | total_deny | INTEGER NOT NULL | –° —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º "deny" |
| 10 | total_bypass | INTEGER NOT NULL | –° –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏ (has_bypass='yes') |

**–ò–Ω–¥–µ–∫—Å—ã:**
- idx_ksk_report_totals_data_report_header_id (B-tree): report_header_id (FK)
- idx_ksk_report_totals_data_created_date_time (B-tree): created_date_time

---

#### 9. ksk_report_list_totals_data (10 –ø–æ–ª–µ–π, 3 –∏–Ω–¥–µ–∫—Å–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –∫–æ–¥–∞–º —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ |
|---|------|-----|--------------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ |
| 2 | report_header_id | INTEGER NOT NULL (FK) | ID –æ—Ç—á—ë—Ç–∞ |
| 3 | created_date_time | TIMESTAMP NOT NULL DEFAULT NOW() | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ |
| 4 | list_code | VARCHAR(100) NOT NULL | –ö–æ–¥ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ |
| 5 | total_with_list | INTEGER NOT NULL | –°–æ–æ–±—â–µ–Ω–∏–π —Å–æ —Å–ø–∏—Å–∫–æ–º |
| 6 | total_without_list | INTEGER NOT NULL | –°–æ–æ–±—â–µ–Ω–∏–π –±–µ–∑ —Å–ø–∏—Å–∫–∞ |
| 7 | total_allow | INTEGER NOT NULL | –° —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º "allow" |
| 8 | total_review | INTEGER NOT NULL | –° —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º "review" |
| 9 | total_deny | INTEGER NOT NULL | –° —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º "deny" |
| 10 | total_bypass | INTEGER NOT NULL | –° –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏ |

**–ò–Ω–¥–µ–∫—Å—ã:**
- idx_ksk_report_list_totals_data_report_header_id (B-tree): report_header_id (FK)
- idx_ksk_report_list_totals_data_created_date_time (B-tree): created_date_time
- idx_ksk_report_list_totals_data_list_code (B-tree): list_code

---

#### 10. ksk_report_totals_by_payment_type_data (44 –ø–æ–ª—è, 1 –∏–Ω–¥–µ–∫—Å)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ 5 —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π (I, O, T, M, V)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** 
- 3 —Å–ª—É–∂–µ–±–Ω—ã—Ö –ø–æ–ª—è (id, report_header_id, created_date_time)
- 7 –æ–±—â–∏—Ö —Å—á—ë—Ç—á–∏–∫–æ–≤ (total, total_without_result, total_with_result, total_allow, total_review, total_deny, total_bypass)
- 5 –≥—Ä—É–ø–ø –ø–æ 7 —Å—á—ë—Ç—á–∏–∫–æ–≤ –∫–∞–∂–¥–∞—è:
  - **i_*** ‚Äî –í—Ö–æ–¥—è—â–∏–π (I)
  - **o_*** ‚Äî –ò—Å—Ö–æ–¥—è—â–∏–π (O)
  - **t_*** ‚Äî –¢—Ä–∞–Ω–∑–∏—Ç–Ω—ã–π (T)
  - **m_*** ‚Äî –ú–µ–∂—Ñ–∏–ª–∏–∞–ª—å–Ω—ã–π (M)
  - **v_*** ‚Äî –í–Ω—É—Ç—Ä–∏—Ñ–∏–ª–∏–∞–ª—å–Ω—ã–π (V)

**–ò–Ω–¥–µ–∫—Å:** idx_ksk_report_totals_by_payment_type_data_report_header_id (B-tree): report_header_id (FK)

---

#### 11. ksk_report_list_totals_by_payment_type_data (39 –ø–æ–ª–µ–π, 2 –∏–Ω–¥–µ–∫—Å–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò—Ç–æ–≥–∏ –ø–æ —Å–ø–∏—Å–∫–∞–º —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ 5 —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- 4 —Å–ª—É–∂–µ–±–Ω—ã—Ö –ø–æ–ª—è (id, report_header_id, created_date_time, list_code)
- 6 –æ–±—â–∏—Ö —Å—á—ë—Ç—á–∏–∫–æ–≤ (total_with_list, total_without_list, total_allow, total_review, total_deny, total_bypass)
- 5 –≥—Ä—É–ø–ø –ø–æ 6 —Å—á—ë—Ç—á–∏–∫–æ–≤ –∫–∞–∂–¥–∞—è –¥–ª—è —Ç–∏–ø–æ–≤ I, O, T, M, V

**–ò–Ω–¥–µ–∫—Å—ã:**
- idx_ksk_report_list_totals_by_payment_type_data_report_header_id (B-tree): report_header_id (FK)
- idx_ksk_report_list_totals_by_payment_type_data_list_code (B-tree): list_code

---

#### 12. ksk_report_figurants_data (12 –ø–æ–ª–µ–π, 1 –∏–Ω–¥–µ–∫—Å)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É —Ñ–∏–≥—É—Ä–∞–Ω—Ç—É

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ |
|---|------|-----|--------------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ |
| 2 | report_header_id | INTEGER NOT NULL (FK) | ID –æ—Ç—á—ë—Ç–∞ |
| 3 | created_date_time | TIMESTAMP NOT NULL DEFAULT NOW() | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ |
| 4 | list_code | VARCHAR(100) | –ö–æ–¥ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ |
| 5 | name_figurant | VARCHAR(200) | –ò–º—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ |
| 6 | president_group | VARCHAR(200) | –ì—Ä—É–ø–ø–∞ –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç–∞ |
| 7 | auto_login | VARCHAR(100) | –ê–≤—Ç–æ–ª–æ–≥–∏–Ω |
| 8 | exclusion_phrase | TEXT | –§—Ä–∞–∑—ã –∏—Å–∫–ª—é—á–µ–Ω–∏—è (—Ä–∞–∑–¥–µ–ª–µ–Ω—ã ;) |
| 9 | total | INTEGER | –í—Å–µ–≥–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π |
| 10 | total_allow | INTEGER | –° —Ä–µ–∑–æ–ª—é—Ü–∏–µ–π "allow" |
| 11 | total_review | INTEGER | –° —Ä–µ–∑–æ–ª—é—Ü–∏–µ–π "review" |
| 12 | total_deny | INTEGER | –° —Ä–µ–∑–æ–ª—é—Ü–∏–µ–π "deny" |
| 13 | total_bypass | INTEGER | –° –æ–±—Ö–æ–¥–æ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ |

**–ò–Ω–¥–µ–∫—Å:** idx_ksk_report_figurants_data_report_header_id (B-tree): report_header_id (FK)

---

## ‚öôÔ∏è –§–£–ù–ö–¶–ò–ò (23 —à—Ç)

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π

```
üìÇ –§—É–Ω–∫—Ü–∏–∏ –ö–°–ö (23 —à—Ç)
‚îÇ
‚îú‚îÄ‚îÄ üìÅ –í–°–¢–ê–í–ö–ê –î–ê–ù–ù–´–• (2)
‚îÇ   ‚îú‚îÄ‚îÄ put_ksk_result() ‚Üí INTEGER
‚îÇ   ‚îî‚îÄ‚îÄ put_ksk_result_batch() ‚Üí TABLE (total, success, error, error_ids)
‚îÇ
‚îú‚îÄ‚îÄ üìÅ –õ–û–ì–ò–ö–ê –ü–†–û–í–ï–†–ö–ò (2)
‚îÇ   ‚îú‚îÄ‚îÄ check_figurant_status() ‚Üí VARCHAR(20)
‚îÇ   ‚îî‚îÄ‚îÄ check_transaction_status() ‚Üí VARCHAR(20)
‚îÇ
‚îú‚îÄ‚îÄ üìÅ –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–ê–†–¢–ò–¶–ò–Ø–ú–ò (5)
‚îÇ   ‚îú‚îÄ‚îÄ ksk_create_partitions() ‚Üí TABLE (partition_name, created_at)
‚îÇ   ‚îú‚îÄ‚îÄ ksk_create_partitions_for_all_tables() ‚Üí VOID
‚îÇ   ‚îú‚îÄ‚îÄ ksk_list_partitions() ‚Üí TABLE (partition_name, date, date_next)
‚îÇ   ‚îú‚îÄ‚îÄ ksk_cleanup_empty_partitions() ‚Üí TABLE (log_id, deleted, time)
‚îÇ   ‚îî‚îÄ‚îÄ ksk_drop_partitions() ‚Üí VOID
‚îÇ
‚îú‚îÄ‚îÄ üìÅ –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–ï (3)
‚îÇ   ‚îú‚îÄ‚îÄ ksk_cleanup_empty_records() ‚Üí TABLE (deleted, dropped, time)
‚îÇ   ‚îú‚îÄ‚îÄ ksk_cleanup_with_logging() ‚Üí VOID
‚îÇ   ‚îî‚îÄ‚îÄ ksk_monitor_table_bloat() ‚Üí TABLE (schema, table, bloat_pct, bloat_mb)
‚îÇ
‚îú‚îÄ‚îÄ üìÅ –õ–û–ì–ò–†–û–í–ê–ù–ò–ï (2)
‚îÇ   ‚îú‚îÄ‚îÄ ksk_log_operation() ‚Üí INTEGER
‚îÇ   ‚îî‚îÄ‚îÄ ksk_cleanup_old_logs() ‚Üí TABLE (deleted_count, execution_time)
‚îÇ
‚îî‚îÄ‚îÄ üìÅ –û–¢–ß–Å–¢–´ (7)
    ‚îú‚îÄ‚îÄ ksk_run_report() ‚Üí INTEGER (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)
    ‚îú‚îÄ‚îÄ ksk_report_totals() ‚Üí VOID (—Å–º. –¢–∏–ø—ã –æ—Ç—á—ë—Ç–æ–≤ ‚Üí totals)
    ‚îú‚îÄ‚îÄ ksk_report_list_totals() ‚Üí VOID (—Å–º. –¢–∏–ø—ã –æ—Ç—á—ë—Ç–æ–≤ ‚Üí list_totals)
    ‚îú‚îÄ‚îÄ ksk_report_totals_by_payment_type() ‚Üí VOID (—Å–º. –¢–∏–ø—ã –æ—Ç—á—ë—Ç–æ–≤ ‚Üí totals_by_payment_type)
    ‚îú‚îÄ‚îÄ ksk_report_list_totals_by_payment_type() ‚Üí VOID (—Å–º. –¢–∏–ø—ã –æ—Ç—á—ë—Ç–æ–≤ ‚Üí list_totals_by_payment_type)
    ‚îú‚îÄ‚îÄ ksk_report_figurants() ‚Üí VOID (—Å–º. –¢–∏–ø—ã –æ—Ç—á—ë—Ç–æ–≤ ‚Üí figurants)
    ‚îî‚îÄ‚îÄ ksk_report_review() ‚Üí TABLE (35 –ø–æ–ª–µ–π) (—Å–º. –û—Ç—á—ë—Ç –ø–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º)
```

---

### –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### 1. put_ksk_result()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê—Ç–æ–º–∞—Ä–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞–º–∏ –∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º–∏

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (8 —à—Ç):**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|----------|
| p_input_timestamp | TIMESTAMP(3) | –î–∞ | –í—Ä–µ–º—è –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Kafka |
| p_output_timestamp | TIMESTAMP(3) | –î–∞ | –í—Ä–µ–º—è –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Kafka |
| p_input_json | JSONB | –î–∞ | –ü–æ–ª–Ω—ã–π JSON –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ |
| p_output_json | JSONB | –î–∞ | –ü–æ–ª–Ω—ã–π JSON —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ |
| p_input_kafka_partition | INTEGER | –ù–µ—Ç | –ù–æ–º–µ—Ä –ø–∞—Ä—Ç–∏—Ü–∏–∏ Kafka –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è |
| p_input_kafka_offset | BIGINT | –ù–µ—Ç | Offset –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Kafka |
| p_input_kafka_headers | JSONB | –ù–µ—Ç | –ó–∞–≥–æ–ª–æ–≤–∫–∏ Kafka –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è |
| p_output_kafka_headers | JSONB | –ù–µ—Ç | –ó–∞–≥–æ–ª–æ–≤–∫–∏ Kafka –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è |

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `INTEGER`
- > 0: ID –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏ (—É—Å–ø–µ—Ö)
- -1: –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–ª–∏ runtime (–¥–µ—Ç–∞–ª–∏ –≤ ksk_result_error)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö 6 –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ–¥–Ω–∏–º IF-ELSIF
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –ë–ï–ó –æ—Ç–∫–∞—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (RETURN -1)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª–µ–π –∏–∑ JSONB
- –í—Å—Ç–∞–≤–∫–∞ –≤ 3 —Ç–∞–±–ª–∏—Ü—ã: ksk_result ‚Üí ksk_figurant ‚Üí ksk_figurant_match

---

#### 2. ksk_run_report()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (6 —à—Ç):**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | Default | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|---------|--------------|----------|
| p_report_code | VARCHAR | ‚Äî | –î–∞ | –ö–æ–¥ –æ—Ç—á—ë—Ç–∞ –∏–∑ orchestrator (totals, list_totals, figurants, –∏ —Ç.–¥.) |
| p_initiator | VARCHAR | ‚Äî | –î–∞ | –ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä: 'system' –∏–ª–∏ 'user' |
| p_user_login | VARCHAR | NULL | –ù–µ—Ç | –õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø—Ä–∏ initiator='user') |
| p_start_date | DATE | CURRENT_DATE | –ù–µ—Ç | –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ –ø–µ—Ä–∏–æ–¥–∞ –æ—Ç—á—ë—Ç–∞ |
| p_end_date | DATE | NULL (= p_start_date) | –ù–µ—Ç | –ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ –ø–µ—Ä–∏–æ–¥–∞ –æ—Ç—á—ë—Ç–∞ |
| p_parameters | JSONB | NULL | –ù–µ—Ç | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ—Ç—á—ë—Ç–æ–º 'figurants') |

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `INTEGER` ‚Äî ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –æ—Ç—á—ë—Ç–∞ (`ksk_report_header.id`)

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```sql
-- –ü—Ä–∏–º–µ—Ä 1: –°–∏—Å—Ç–µ–º–Ω—ã–π –æ—Ç—á—ë—Ç –∑–∞ –¥–µ–Ω—å
SELECT ksk_run_report('totals', 'system', NULL, '2025-10-22');

-- –ü—Ä–∏–º–µ—Ä 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ—Ç—á—ë—Ç —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ –∫–æ–¥–∞–º —Å–ø–∏—Å–∫–æ–≤
SELECT ksk_run_report('figurants', 'user', 'ivanov', '2025-10-20', '2025-10-22', 
    '{"list_codes": ["4200", "4204"]}'::JSONB);
```

**‚ö†Ô∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü–∞—Ä–∞–º–µ—Ç—Ä `p_parameters` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ—Ç—á—ë—Ç–æ–º `figurants` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∫–æ–¥–∞–º —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤ (list_codes). –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—Ç—á—ë—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `NULL`.

---

#### 3. ksk_report_review()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –§–æ—Ä–º–∏—Ä—É–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º, —Ç—Ä–µ–±—É—é—â–∏–º —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (review)

**–°–º. –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:** [–û—Ç—á—ë—Ç –ø–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º](#–æ—Ç—á—ë—Ç-–ø–æ-—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º)

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `p_report_date` DATE DEFAULT CURRENT_DATE ‚Äî –¥–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** TABLE —Å 35 –ø–æ–ª—è–º–∏ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–ø–∏—Å–∞–Ω–∞ –≤ —Ä–∞–∑–¥–µ–ª–µ "–û—Ç—á—ë—Ç –ø–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º")

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```sql
-- –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ review –∑–∞ 22 –æ–∫—Ç—è–±—Ä—è 2025
SELECT * FROM ksk_report_review('2025-10-22');
```

---

#### 4. ksk_create_partitions()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∏–µ —Å—É—Ç–æ—á–Ω—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π –¥–ª—è –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `p_table_name` VARCHAR ‚Äî –∏–º—è —Ç–∞–±–ª–∏—Ü—ã (ksk_result, ksk_figurant, ksk_figurant_match)
- `p_days_ahead` INTEGER DEFAULT 7 ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤–ø–µ—Ä—ë–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞—Ä—Ç–∏—Ü–∏–π

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** TABLE (partition_name VARCHAR, created_at TIMESTAMP)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –°–æ–∑–¥–∞—ë—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏ —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏: **FROM 'YYYY-MM-DD 00:00:00' TO 'YYYY-MM-DD 00:00:00' + 1 day**
- –ü–µ—Ä–∏–æ–¥ –ø–∞—Ä—Ç–∏—Ü–∏–∏: **1 –î–ï–ù–¨ (24 —á–∞—Å–∞)**
- **TO ‚Äî –≠–ö–°–ö–õ–Æ–ó–ò–í–ù–ê–Ø –≥—Ä–∞–Ω–∏—Ü–∞** (–ø–∞—Ä—Ç–∏—Ü–∏—è –ù–ï –≤–∫–ª—é—á–∞–µ—Ç TO, –≤–∫–ª—é—á–∞–µ—Ç FROM)

**–ü—Ä–∏–º–µ—Ä:**

```sql
-- –°–æ–∑–¥–∞—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–∏ –Ω–∞ 7 –¥–Ω–µ–π –≤–ø–µ—Ä—ë–¥ –¥–ª—è ksk_result
SELECT * FROM ksk_create_partitions('ksk_result', 7);

-- –†–µ–∑—É–ª—å—Ç–∞—Ç:
-- partition_name: ksk_result_2025_10_31
-- created_at: 2025-10-31 01:42:15.123
-- (7 —Å—Ç—Ä–æ–∫ ‚Äî –ø–æ –æ–¥–Ω–æ–π –Ω–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å)
```

---

## ‚è∞ –†–ï–ì–£–õ–Ø–†–ù–´–ï –ó–ê–î–ê–ß–ò (CRON)

**‚ö†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ PostgreSQL `pg_cron` (—Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞)

### –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á (10 –∑–∞–¥–∞—á, 8 –∞–∫—Ç–∏–≤–Ω—ã—Ö + 2 –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö)

| # | –í—Ä–µ–º—è | –ó–∞–¥–∞—á–∞ | –§—É–Ω–∫—Ü–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|---|-------|--------|---------|------------|--------|
| 1 | 00:30 | ANALYZE –ø–∞—Ä—Ç–∏—Ü–∏–π –≤—á–µ—Ä–∞—à–Ω–µ–≥–æ –¥–Ω—è | SQL-–±–ª–æ–∫ | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ | ‚è∏Ô∏è **–û–¢–õ–û–ñ–ï–ù–û** |
| 2 | 01:00 | –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–π –Ω–∞ 7 –¥–Ω–µ–π –≤–ø–µ—Ä—ë–¥ | ksk_create_partitions_for_all_tables() | –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (—Å—É—Ç–æ—á–Ω—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏) | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| 3 | 01:30 | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤ | ksk_run_report() | –°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö 5 –æ—Ç—á—ë—Ç–æ–≤ –∑–∞ –≤—á–µ—Ä–∞ | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| 4 | 02:00 | –£–¥–∞–ª–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–π —Å—Ç–∞—Ä—à–µ 365 –¥–Ω–µ–π | ksk_drop_old_partitions(365) | –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –º–µ—Å—Ç–∞ | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| 5 | 03:00 | –£–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –∑–∞–ø–∏—Å–µ–π (14 –¥–Ω–µ–π) | ksk_cleanup_empty_records(14) | –û—á–∏—Å—Ç–∫–∞ resolution='empty' | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| 6 | 03:30 | –£–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π (14 –¥–Ω–µ–π) | ksk_cleanup_empty_partitions('all', 14) | –û—á–∏—Å—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| 7 | 04:00 | –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –æ—Ç—á—ë—Ç–æ–≤ (TTL) | ksk_cleanup_old_reports() | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–∞–º–∏ –ø–æ TTL | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| 8 | 04:30 | –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤ (365 –¥–Ω–µ–π) | ksk_cleanup_old_logs(365) | –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| 9 | 05:00 | VACUUM ANALYZE –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü | SQL-–±–ª–æ–∫ | –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –º–µ—Å—Ç–∞, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ | ‚è∏Ô∏è **–û–¢–õ–û–ñ–ï–ù–û** |
| 10 | 04:00 (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ) | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ bloat —Ç–∞–±–ª–∏—Ü | ksk_monitor_table_bloat() | –†–∞–Ω–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |

**‚ö†Ô∏è –°—Ç–∞—Ç—É—Å –û–¢–õ–û–ñ–ï–ù–û:** –ó–∞–¥–∞—á–∏ #1 –∏ #9 –æ—Ç–ª–æ–∂–µ–Ω—ã –¥–æ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

---

## üìù –ò–°–¢–û–†–ò–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô

### –í–µ—Ä—Å–∏—è 3.7 FINAL (31.10.2025 01:42 MSK)

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï:**

–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ç–µ–ø–µ—Ä—å —è–≤–ª—è–µ—Ç—Å—è **–ï–î–ò–ù–´–ú –ò–°–¢–û–ß–ù–ò–ö–û–ú –ò–°–¢–ò–ù–´ (Single Source of Truth)** –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞!

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**

1. ‚úÖ **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –î–û–ü–û–õ–ù–ï–ù–ò–ï: –ü–µ—Ä–∏–æ–¥ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**
   - **–ü–µ—Ä–∏–æ–¥ –ø–∞—Ä—Ç–∏—Ü–∏–∏:** 1 –î–ï–ù–¨ (24 —á–∞—Å–∞)
   - **–ì—Ä–∞–Ω–∏—Ü—ã –ø–∞—Ä—Ç–∏—Ü–∏–∏:** FROM 'YYYY-MM-DD 00:00:00' TO 'YYYY-MM-DD 00:00:00' + 1 day
   - **‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û:** TO ‚Äî –≠–ö–°–ö–õ–Æ–ó–ò–í–ù–ê–Ø –≥—Ä–∞–Ω–∏—Ü–∞! –ü–∞—Ä—Ç–∏—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç [FROM, TO)
   - **–ü—Ä–∏–º–µ—Ä:**
     - FROM: 2025-10-22 00:00:00.000 (–≤–∫–ª—é—á–∞—è)
     - TO: 2025-10-23 00:00:00.000 (–ù–ï –≤–∫–ª—é—á–∞—è)
     - –†–µ–∑—É–ª—å—Ç–∞—Ç: –í–°–ï timestamp —Å 2025-10-22 00:00:00.000 –¥–æ 2025-10-22 23:59:59.999

2. ‚úÖ **–§–£–ù–ö–¶–ò–Ø –°–û–ó–î–ê–ù–ò–Ø –ü–ê–†–¢–ò–¶–ò–ô:** –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ ksk_create_partitions()
   - SQL –∫–æ–º–∞–Ω–¥–∞: CREATE TABLE %I PARTITION OF %I FOR VALUES FROM (%L) TO (%L)
   - –†–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∑–∞ 22 –æ–∫—Ç—è–±—Ä—è 2025
   - –ü–æ—è—Å–Ω–µ–Ω–∏–µ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ—Å—Ç–∏ –≥—Ä–∞–Ω–∏—Ü—ã TO

3. ‚úÖ **–°–ï–ö–¶–ò–Ø "–ü–û–ß–ï–ú–£ TIMESTAMP, –ê –ù–ï DATE?"** –≤ —Ä–∞–∑–¥–µ–ª–µ "–î–æ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã"
   - 4 –ø—Ä–∏—á–∏–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è TIMESTAMP –≤–º–µ—Å—Ç–æ DATE –¥–ª—è –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   - –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—è date (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏)

4. ‚úÖ **–û–ë–ù–û–í–õ–ï–ù–ò–ï CRON:** –£—Ç–æ—á–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ #2 ‚Äî "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (—Å—É—Ç–æ—á–Ω—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏)"

5. ‚úÖ **–†–ê–ó–î–ï–õ "‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û"** –≤ –Ω–∞—á–∞–ª–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
   - –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ = –ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ô –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
   - –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ (—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏, –±–∏–∑–Ω–µ—Å, DBA, QA, –¥–æ–∫—É–º–µ–Ω—Ç–∞–ª–∏—Å—Ç—ã)
   - –ü—Ä–∏ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è—Ö: –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∏–º–µ–µ—Ç –í–´–°–®–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢

---

### –í–µ—Ä—Å–∏—è 3.6 FINAL (31.10.2025 01:22 MSK)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

1. ‚úÖ **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - **–ë–´–õ–û (v3.5):** "–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: PARTITION BY RANGE (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ–µ)"
   - **–°–¢–ê–õ–û (v3.6):** "–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: PARTITION BY RANGE –ø–æ **TIMESTAMP** (output_timestamp/timestamp)"
   
   **–î–µ—Ç–∞–ª–∏:**
   - ksk_result: PARTITION BY RANGE (output_timestamp)
   - ksk_figurant: PARTITION BY RANGE (timestamp)
   - ksk_figurant_match: PARTITION BY RANGE (timestamp)
   - –ü–æ–ª–µ date ‚Äî –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –ù–ï –¥–ª—è –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

---

**–ö–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞ ‚Äî –≠–¢–ê–õ–û–ù –°–ò–°–¢–ï–ú–´ –ö–°–ö v3.7 FINAL ‚úÖ**

**‚ö†Ô∏è –ü–†–ò –õ–Æ–ë–´–• –ò–ó–ú–ï–ù–ï–ù–ò–Ø–• –û–ë–ù–û–í–ò–¢–¨ –í–ï–†–°–ò–Æ –°–ü–†–ê–í–û–ß–ù–ò–ö–ê –ò –£–í–ï–î–û–ú–ò–¢–¨ –í–°–Æ –ö–û–ú–ê–ù–î–£!**