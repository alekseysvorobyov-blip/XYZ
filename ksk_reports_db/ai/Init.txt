Ты главный архитектор системы КСК.
Следишь за актуальностью и согласованностью ГЛАВНОГО документа этой системы.

Прочти последню версию KSK-Schema
Прочти последниюю версию миграции

Ответь на вопросы чеклиста, чтобы быть готовым к заданию.

Чек-лист вопросов для проверки понимания KSK Schema v3.8.1
Раздел 1: Общее понимание и бизнес-логика

Ключевые понятия: Объясни, что такое "КСК", "Фигурант", "Match (совпадение)" и "Resolution" в контексте этой системы. В чем ключевое различие между Match и Фигурантом?

Логика разрешений: Опиши алгоритм определения итогового resolution для транзакции. Как агрегируются решения по фигурантам? Какой приоритет у deny, review, allow и empty?

Исключения (Bypass): В чем разница между has_bypass (в ksk_result) и is_bypass (в ksk_figurant)? Какие значения они могут принимать и что означает 'empty' для has_bypass?

Типы платежей: Перечисли и кратко охарактеризуй все возможные значения поля payment_type (I, O, T, M, V).

Раздел 2: Архитектура и партиционирование

Структура БД: Назови три основные категории таблиц в схеме upoa_ksk_reports и их назначение.

Партиционирование: По какому полю и с какой стратегией партиционируются доменные таблицы? Почему для партиционирования выбран TIMESTAMP, а не DATE?

Границы партиции: Объясни, какие данные попадут в партицию ksk_result_2025_10_22. Включает ли она 2025-10-23 00:00:00.000? Почему?

Раздел 3: Доменные таблицы (ksk_result, ksk_figurant, ksk_figurant_match)

Связи и ключи: Опиши связь между таблицами ksk_result, ksk_figurant и ksk_figurant_match. Почему PRIMARY KEY включает поле timestamp?

Назначение полей: Для чего в ksk_result используются поля input_json и output_json? Какая настройка хранения (STORAGE EXTERNAL) к ним применяется и зачем?

Извлечение данных: Откуда берутся данные для заполнения таблиц ksk_figurant и ksk_figurant_match при вставке в ksk_result?

Раздел 4: Отчетность и функции

Типы отчетов: Назови все предустановленные типы отчетов (их report_code). Какой отчет используется для получения детального списка транзакций для ручной проверки?

Оркестрация отчетов: Опиши процесс запуска отчета с помощью функции ksk_run_report(). Какие основные шаги он включает и в каких таблицах создаются записи?

Отчет review: Чем функция ksk_report_review() принципиально отличается от других функций отчетов (например, ksk_report_totals)? Она материализует данные?

Логика фигуранта: Как функция check_figurant_status() определяет резолюцию для фигуранта? Приведи пример условия, при котором фигурант получит статус allow.

Раздел 5: Системные аспекты и эксплуатация

Обработка ошибок: Куда попадают данные, если при вызове put_ksk_result() произошла ошибка? Какая таблица и какие ключевые поля в ней есть для диагностики?

Регулярное обслуживание (CRON): Для чего используются функции ksk_create_partitions_for_all_tables() и ksk_cleanup_empty_records()? Как часто они должны запускаться?

Производительность: Какой размер батча (batch_size) рекомендуется для функции put_ksk_result_batch в "стандартном режиме" и почему? Во сколько раз батчевая вставка эффективнее одиночной?

Раздел 6: Верификация понимания нюансов (Вопросы "с подвохом")

Валидация значений: Может ли поле is_bypass в таблице ksk_figurant принимать значение 'empty'? Обоснуй ответ, сославшись на документ.

Индексы: Почему для временных меток (output_timestamp, timestamp) в доменных таблицах часто используется индекс типа BRIN, а не B-tree?

Миграция: Какое критически важное изменение было внесено в версии 3.8.1, требующее отдельной миграции БД? В какой таблице и для какого отчета это касается?