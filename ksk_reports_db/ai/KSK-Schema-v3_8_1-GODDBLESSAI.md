# üìò KSK Database Schema Reference

**–í–µ—Ä—Å–∏—è:** 3.8.1 CORRECTED (Part 1 of 2)  
**–î–∞—Ç–∞:** 31.10.2025 17:46 MSK  
**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL 16  
**–°—Ö–µ–º–∞:** `upoa_ksk_reports`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –≠–¢–ê–õ–û–ù ‚Äî –ï–î–ò–ù–´–ô –ò–°–¢–û–ß–ù–ò–ö –ò–°–¢–ò–ù–´ –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û

**–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è –ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ú –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã (Single Source of Truth) –¥–ª—è:**
- –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (Backend, Frontend, DevOps)
- –ë–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤ –∏ Product Owners
- DBA –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤
- –¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–æ–≤ –∏ QA
- –î–æ–∫—É–º–µ–Ω—Ç–∞–ª–∏—Å—Ç–æ–≤

**–ü—Ä–∏ –ª—é–±—ã—Ö –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è—Ö:** –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∏–º–µ–µ—Ç **–í–´–°–®–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢** –Ω–∞–¥ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏, –∫–æ–¥–æ–º, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π!

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. [–ì–ª–æ—Å—Å–∞—Ä–∏–π —Ç–µ—Ä–º–∏–Ω–æ–≤](#–≥–ª–æ—Å—Å–∞—Ä–∏–π-—Ç–µ—Ä–º–∏–Ω–æ–≤)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
3. [–î–æ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (3 —à—Ç, 59 –ø–æ–ª–µ–π)](#–¥–æ–º–µ–Ω–Ω—ã–µ-—Ç–∞–±–ª–∏—Ü—ã)
4. [–°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (2 —à—Ç, 23 –ø–æ–ª—è)](#—Å–∏—Å—Ç–µ–º–Ω—ã–µ-—Ç–∞–±–ª–∏—Ü—ã)
5. [–¢–∏–ø—ã –æ—Ç—á—ë—Ç–æ–≤ (5 —à—Ç)](#—Ç–∏–ø—ã-–æ—Ç—á—ë—Ç–æ–≤)
6. [–û—Ç—á—ë—Ç –ø–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º (review)](#–æ—Ç—á—ë—Ç-–ø–æ-—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º)

**‚ö†Ô∏è –ü–†–û–î–û–õ–ñ–ï–ù–ò–ï:** –°–º. **Part 2** –¥–ª—è —Ä–∞–∑–¥–µ–ª–æ–≤ 7-11

---

## üìö –ì–õ–û–°–°–ê–†–ò–ô –¢–ï–†–ú–ò–ù–û–í

### –ö–ª—é—á–µ–≤—ã–µ –ø–æ–Ω—è—Ç–∏—è –ö–°–ö

| –¢–µ—Ä–º–∏–Ω | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|--------|-------------|------------|
| **–ö–°–ö** | –ö–æ–º–ø–ª–∞–µ–Ω—Å-—Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è | –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã–º —Å–ø–∏—Å–∫–∞–º |
| **–§–∏–≥—É—Ä–∞–Ω—Ç** | –°—É–±—ä–µ–∫—Ç —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ | –§–∏–∑–∏—á–µ—Å–∫–æ–µ –∏–ª–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ, –Ω–∞—Ö–æ–¥—è—â–µ–µ—Å—è –≤ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–º —Å–ø–∏—Å–∫–µ |
| **Match (—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)** | –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, –Ω–∞–π–¥–µ–Ω–Ω–æ–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º | –û–¥–∏–Ω —Ñ–∏–≥—É—Ä–∞–Ω—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –ù–ï–°–ö–û–õ–¨–ö–û matches, –µ—Å–ª–∏ —Å—Ä–∞–±–æ—Ç–∞–ª–∏ —Ä–∞–∑–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–∏—Å–∫–∞ |
| **Resolution** | –ò—Ç–æ–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ | –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ —Ä–µ—à–µ–Ω–∏–π –ø–æ –≤—Å–µ–º —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ |

---

### Resolution (–†–µ–∑–æ–ª—é—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)

**–¢–∏–ø:** `VARCHAR(20)`  
**–ó–Ω–∞—á–µ–Ω–∏—è:**

| –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ |
|----------|--------------|----------|---------------|
| `allow` | –†–∞–∑—Ä–µ—à–∏—Ç—å | –ü–ª–∞—Ç—ë–∂ —Ä–∞–∑—Ä–µ—à—ë–Ω –∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é | –í—Å–µ —Ñ–∏–≥—É—Ä–∞–Ω—Ç—ã –∏–º–µ—é—Ç —Å—Ç–∞—Ç—É—Å `allow` |
| `review` | –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ | –ü–ª–∞—Ç—ë–∂ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–º–ø–ª–∞–µ–Ω—Å-–æ—Ñ–∏—Ü–µ—Ä–æ–º | –•–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ñ–∏–≥—É—Ä–∞–Ω—Ç `review`, –Ω–µ—Ç `deny` |
| `deny` | –û—Ç–∫–ª–æ–Ω–∏—Ç—å | –ü–ª–∞—Ç—ë–∂ –æ—Ç–∫–ª–æ–Ω—ë–Ω | –•–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ñ–∏–≥—É—Ä–∞–Ω—Ç `deny` |
| `empty` | –ù–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π | –°–æ–≤–ø–∞–¥–µ–Ω–∏–π —Å —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã–º–∏ —Å–ø–∏—Å–∫–∞–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ | –ú–∞—Å—Å–∏–≤ `searchCheckResultKCKH` –ø—É—Å—Ç |

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∞–≥—Ä–µ–≥–∞—Ü–∏–∏:** `deny` > `review` > `allow` > `empty`

---

### Bypass (–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è)

#### has_bypass (ksk_result) ‚Äî –ò—Å–∫–ª—é—á–µ–Ω–∞ –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û:** –¢–∏–ø ‚Äî `VARCHAR(10)`, –ù–ï BOOLEAN!

**–ó–Ω–∞—á–µ–Ω–∏—è:**

| –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `'yes'` | –ò—Å–∫–ª—é—á—ë–Ω | –ü–ª–∞—Ç—ë–∂ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–∫–ª—é—á—ë–Ω –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è –ö–°–ö |
| `'no'` | –ù–µ –∏—Å–∫–ª—é—á—ë–Ω | –ü–ª–∞—Ç—ë–∂ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É |
| `'empty'` | –ù–µ—Ç —Ñ–∏–≥—É—Ä–∞–Ω—Ç–æ–≤ | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø—Ä–æ—à–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫—É, –Ω–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç—ã –Ω–µ –≤—ã—è–≤–ª–µ–Ω—ã (resolution='empty') |

**‚ö†Ô∏è –í–ê–ñ–ù–û:** `'empty'` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –í–´–ü–û–õ–ù–ï–ù–ê, –Ω–æ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –Ω–µ –Ω–∞—à–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π.

---

#### is_bypass (ksk_figurant) ‚Äî –ò—Å–∫–ª—é—á–µ–Ω –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û:** –¢–∏–ø ‚Äî `VARCHAR(10)`, –ù–ï BOOLEAN!

**–ó–Ω–∞—á–µ–Ω–∏—è (–¢–û–õ–¨–ö–û –î–í–ê!):**

| –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `'yes'` | –ò—Å–∫–ª—é—á—ë–Ω | –§–∏–≥—É—Ä–∞–Ω—Ç –∏—Å–∫–ª—é—á—ë–Ω –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏) |
| `'no'` | –ù–µ –∏—Å–∫–ª—é—á—ë–Ω | –§–∏–≥—É—Ä–∞–Ω—Ç —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ resolution |

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –ù–∞ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–µ –≤–æ–∑–º–æ–∂–Ω—ã –¢–û–õ–¨–ö–û –∑–Ω–∞—á–µ–Ω–∏—è `'yes'` –∏–ª–∏ `'no'`. –ù–ï–¢ –∑–Ω–∞—á–µ–Ω–∏—è `'empty'`!

---

### Payment Type (–¢–∏–ø –ø–ª–∞—Ç–µ–∂–∞)

**–¢–∏–ø:** `VARCHAR(20)`  
**–ó–Ω–∞—á–µ–Ω–∏—è:**

| –ö–æ–¥ | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|--------------|----------|
| `I` | –í—Ö–æ–¥—è—â–∏–π | –ü–ª–∞—Ç—ë–∂ –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –±–∞–Ω–∫–∞ –≤ –Ω–∞—à –±–∞–Ω–∫ |
| `O` | –ò—Å—Ö–æ–¥—è—â–∏–π | –ü–ª–∞—Ç—ë–∂ –∏–∑ –Ω–∞—à–µ–≥–æ –±–∞–Ω–∫–∞ –≤–æ –≤–Ω–µ—à–Ω–∏–π –±–∞–Ω–∫ |
| `T` | –¢—Ä–∞–Ω–∑–∏—Ç–Ω—ã–π | –ü–ª–∞—Ç—ë–∂ —á–µ—Ä–µ–∑ –Ω–∞—à –±–∞–Ω–∫ (–æ–±–∞ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ –≤–Ω–µ—à–Ω–∏–µ) |
| `M` | –ú–µ–∂—Ñ–∏–ª–∏–∞–ª—å–Ω—ã–π | –ü–ª–∞—Ç—ë–∂ –º–µ–∂–¥—É —Ñ–∏–ª–∏–∞–ª–∞–º–∏ –Ω–∞—à–µ–≥–æ –±–∞–Ω–∫–∞ |
| `V` | –í–Ω—É—Ç—Ä–∏—Ñ–∏–ª–∏–∞–ª—å–Ω—ã–π | –ü–ª–∞—Ç—ë–∂ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞ |

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ë–ê–ó–´ –î–ê–ù–ù–´–•

### –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü

```
upoa_ksk_reports (—Å—Ö–µ–º–∞) ‚Äî 12 —Ç–∞–±–ª–∏—Ü, 221 –ø–æ–ª–µ–π
‚îÇ
‚îú‚îÄ‚îÄ üìÅ –î–û–ú–ï–ù–ù–´–ï –¢–ê–ë–õ–ò–¶–´ (3 —à—Ç, 59 –ø–æ–ª–µ–π)
‚îÇ   ‚îú‚îÄ‚îÄ ksk_result ‚Äî 34 –ø–æ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ ksk_figurant ‚Äî 15 –ø–æ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ ksk_figurant_match ‚Äî 10 –ø–æ–ª–µ–π
‚îÇ
‚îú‚îÄ‚îÄ üìÅ –°–ò–°–¢–ï–ú–ù–´–ï –¢–ê–ë–õ–ò–¶–´ (2 —à—Ç, 23 –ø–æ–ª—è)
‚îÇ   ‚îú‚îÄ‚îÄ ksk_result_error ‚Äî 14 –ø–æ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ ksk_system_operations_log ‚Äî 9 –ø–æ–ª–µ–π
‚îÇ
‚îî‚îÄ‚îÄ üìÅ –û–¢–ß–Å–¢–ù–´–ï –¢–ê–ë–õ–ò–¶–´ (7 —à—Ç, 139 –ø–æ–ª–µ–π)
    ‚îú‚îÄ‚îÄ –û–†–ö–ï–°–¢–†–ê–¢–û–† (9 –ø–æ–ª–µ–π)
    ‚îÇ   ‚îî‚îÄ‚îÄ ksk_report_orchestrator ‚Äî —Å–º. –¢–∏–ø—ã –æ—Ç—á—ë—Ç–æ–≤
    ‚îÇ
    ‚îú‚îÄ‚îÄ –ó–ê–ì–û–õ–û–í–û–ö (13 –ø–æ–ª–µ–π)
    ‚îÇ   ‚îî‚îÄ‚îÄ ksk_report_header
    ‚îÇ
    ‚îî‚îÄ‚îÄ –î–ê–ù–ù–´–ï –û–¢–ß–Å–¢–û–í (117 –ø–æ–ª–µ–π)
        ‚îú‚îÄ‚îÄ ksk_report_totals_data ‚Äî 10 –ø–æ–ª–µ–π
        ‚îú‚îÄ‚îÄ ksk_report_list_totals_data ‚Äî 10 –ø–æ–ª–µ–π
        ‚îú‚îÄ‚îÄ ksk_report_totals_by_payment_type_data ‚Äî 44 –ø–æ–ª—è
        ‚îú‚îÄ‚îÄ ksk_report_list_totals_by_payment_type_data ‚Äî 39 –ø–æ–ª–µ–π
        ‚îî‚îÄ‚îÄ ksk_report_figurants_data ‚Äî 14 –ø–æ–ª–µ–π
```

---

### –°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –¢–∞–±–ª–∏—Ü | –ü–æ–ª–µ–π | –ò–Ω–¥–µ–∫—Å–æ–≤ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|--------|-------|----------|------------|
| **–î–æ–º–µ–Ω–Ω—ã–µ** | 3 | 59 | 13 | –û—Å–Ω–æ–≤–Ω—ã–µ –±–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏ (–ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ) |
| **–°–∏—Å—Ç–µ–º–Ω—ã–µ** | 2 | 23 | 8 | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ |
| **–û—Ç—á—ë—Ç–Ω—ã–µ** | 7 | 139 | 12 | –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤ |
| **–ò–¢–û–ì–û** | **12** | **221** | **33** | **–ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Å–∏—Å—Ç–µ–º—ã –ö–°–ö** |

---

## üìä –î–û–ú–ï–ù–ù–´–ï –¢–ê–ë–õ–ò–¶–´ (3 —à—Ç)

**‚öôÔ∏è –û–±—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**

### üîë –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:** `PARTITION BY RANGE` –ø–æ **TIMESTAMP** (output_timestamp/timestamp)  
**–ü–µ—Ä–∏–æ–¥ –ø–∞—Ä—Ç–∏—Ü–∏–∏:** **1 –î–ï–ù–¨ (24 —á–∞—Å–∞)**  
**–ì—Ä–∞–Ω–∏—Ü—ã –ø–∞—Ä—Ç–∏—Ü–∏–∏:** `FROM 'YYYY-MM-DD 00:00:00' TO 'YYYY-MM-DD 00:00:00' + 1 day`

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: TO ‚Äî –≠–ö–°–ö–õ–Æ–ó–ò–í–ù–ê–Ø –≥—Ä–∞–Ω–∏—Ü–∞!**
- –ü–∞—Ä—Ç–∏—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω: **[FROM, TO)**
- **FROM:** 2025-10-22 00:00:00.000 (**–≤–∫–ª—é—á–∞—è**)
- **TO:** 2025-10-23 00:00:00.000 (**–ù–ï –≤–∫–ª—é—á–∞—è**)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í–°–ï timestamp —Å `2025-10-22 00:00:00.000` –¥–æ `2025-10-22 23:59:59.999`

**–§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞—Ä—Ç–∏—Ü–∏–π:** `ksk_create_partitions()`
```sql
-- SQL –∫–æ–º–∞–Ω–¥–∞
CREATE TABLE %I PARTITION OF %I 
FOR VALUES FROM (%L) TO (%L);

-- –ü—Ä–∏–º–µ—Ä: –ø–∞—Ä—Ç–∏—Ü–∏—è –∑–∞ 22 –æ–∫—Ç—è–±—Ä—è 2025
CREATE TABLE ksk_result_2025_10_22 PARTITION OF ksk_result
FOR VALUES FROM ('2025-10-22 00:00:00') TO ('2025-10-23 00:00:00');
-- ‚úÖ –í–∫–ª—é—á–∞–µ—Ç: 2025-10-22 00:00:00.000 ... 2025-10-22 23:59:59.999
-- ‚ùå –ù–ï –≤–∫–ª—é—á–∞–µ—Ç: 2025-10-23 00:00:00.000 –∏ –ø–æ–∑–∂–µ
```

**–¢–∞–±–ª–∏—Ü—ã —Å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º:**
| –¢–∞–±–ª–∏—Ü–∞ | –ö–ª—é—á –ø–∞—Ä—Ç–∏—Ü–∏–∏ | –ü–µ—Ä–∏–æ–¥ | PRIMARY KEY |
|---------|---------------|--------|-------------|
| ksk_result | **output_timestamp** | 1 –¥–µ–Ω—å | (id, output_timestamp) |
| ksk_figurant | **timestamp** | 1 –¥–µ–Ω—å | (id, timestamp) |
| ksk_figurant_match | **timestamp** | 1 –¥–µ–Ω—å | (id, timestamp) |

**‚ö†Ô∏è –í–ê–ñ–ù–û:**
- **–ü–æ–ª–µ `date`** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏, **–ù–ï –¥–ª—è –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**
- **PRIMARY KEY** –≤–∫–ª—é—á–∞–µ—Ç TIMESTAMP –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ –ø–∞—Ä—Ç–∏—Ü–∏–∏
- **–ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:** ksk_result ‚Üí ksk_figurant ‚Üí ksk_figurant_match

### üéØ –ü–æ—á–µ–º—É TIMESTAMP, –∞ –Ω–µ DATE?

1. **PRIMARY KEY** —Ç—Ä–µ–±—É–µ—Ç TIMESTAMP –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ –ø–∞—Ä—Ç–∏—Ü–∏–∏ (–∫–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π timestamp —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥)
2. **–ì—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∏—è:** –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ TIMESTAMP –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** BRIN –∏–Ω–¥–µ–∫—Å—ã –ø–æ TIMESTAMP —Ä–∞–±–æ—Ç–∞—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
4. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:** –ü–æ–ª–µ `date` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ –ø—Ä–∏ JOIN-–∞—Ö, –Ω–æ –ù–ï –¥–ª—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### üì¶ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

- **JSONB –ø–æ–ª—è:** `STORAGE EXTERNAL` (—ç–∫–æ–Ω–æ–º–∏—è shared_buffers, TOAST-—Ç–∞–±–ª–∏—Ü—ã –≤–Ω–µ –∫—ç—à–∞)
- **–ò–Ω–¥–µ–∫—Å—ã:** –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã (BRIN –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏, B-tree –¥–ª—è FK, GIN –¥–ª—è –º–∞—Å—Å–∏–≤–æ–≤)
- **–û–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö:** ~3M –∑–∞–ø–∏—Å–µ–π/–¥–µ–Ω—å –≤ ksk_result, ~100-500 –∑–∞–ø–∏—Å–µ–π/–¥–µ–Ω—å –≤ ksk_figurant

---

### 1. ksk_result (34 –ø–æ–ª—è, 5 –∏–Ω–¥–µ–∫—Å–æ–≤)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π –ö–°–ö  
**–û–±—ä—ë–º:** ~3M –∑–∞–ø–∏—Å–µ–π/–¥–µ–Ω—å (~3TB/–≥–æ–¥ –Ω–∞ HDD)  
**–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:** `PARTITION BY RANGE (output_timestamp)` ‚Äî **–ø–µ—Ä–∏–æ–¥ 1 –î–ï–ù–¨**  
**PRIMARY KEY:** `(id, output_timestamp)`

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π (34 –ø–æ–ª—è)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY | AUTO | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ (PRIMARY KEY) |
| 2 | date | DATE NOT NULL | ‚Äî | –î–∞—Ç–∞ | –î–∞—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏, –ù–ï –∫–ª—é—á –ø–∞—Ä—Ç–∏—Ü–∏–∏) |
| 3 | corr_id | VARCHAR(100) NOT NULL | ‚Äî | –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π ID | Correlation ID –ø–ª–∞—Ç–µ–∂–∞ –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ (–∏–Ω–¥–µ–∫—Å B-tree) |
| 4 | input_timestamp | TIMESTAMP(3) | NULL | –í—Ä–µ–º—è –≤—Ö–æ–¥—è—â–µ–≥–æ | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Kafka |
| 5 | output_timestamp | TIMESTAMP(3) NOT NULL | ‚Äî | –í—Ä–µ–º—è –∏—Å—Ö–æ–¥—è—â–µ–≥–æ | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (PRIMARY KEY, **–ö–õ–Æ–ß –ü–ê–†–¢–ò–¶–ò–ò**, –∏–Ω–¥–µ–∫—Å BRIN) |
| 6 | input_json | JSONB | NULL | –í—Ö–æ–¥—è—â–∏–π JSON | –ü–æ–ª–Ω—ã–π JSON –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (EXTERNAL STORAGE) |
| 7 | output_json | JSONB | NULL | –ò—Å—Ö–æ–¥—è—â–∏–π JSON | –ü–æ–ª–Ω—ã–π JSON —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ (EXTERNAL STORAGE) |
| 8 | payment_type | VARCHAR(20) NOT NULL | ‚Äî | –¢–∏–ø –ø–ª–∞—Ç–µ–∂–∞ | –¢–∏–ø –ø–ª–∞—Ç–µ–∂–∞: I/O/T/M/V |
| 9 | resolution | VARCHAR(20) NOT NULL | ‚Äî | –†–µ–∑–æ–ª—é—Ü–∏—è | –ò—Ç–æ–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ: allow/review/deny/empty |
| 10 | list_codes | TEXT[] | NULL | –ö–æ–¥—ã —Å–ø–∏—Å–∫–æ–≤ | –ú–∞—Å—Å–∏–≤ –∫–æ–¥–æ–≤ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤ (GIN –∏–Ω–¥–µ–∫—Å) |
| 11 | has_bypass | VARCHAR(10) | 'empty' | –ò—Å–∫–ª—é—á–µ–Ω–∞ –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è | –ü—Ä–∏–∑–Ω–∞–∫ –æ–±—Ö–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: yes/no/empty |

#### –î–∞–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∞ (–ø–æ–ª—è 12-30, 19 –ø–æ–ª–µ–π)

**–ì—Ä—É–ø–ø–∞: paymentInfo (3 –ø–æ–ª—è)**
| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|
| 12 | payment_id | TEXT | NULL | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–ª–∞—Ç–µ–∂–∞ |
| 13 | payment_purpose | TEXT | NULL | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ |
| 14 | amount | TEXT | NULL | –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞ |

**–ì—Ä—É–ø–ø–∞: –°—á–µ—Ç–∞ (2 –ø–æ–ª—è)**
| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|
| 15 | account_debet | TEXT | NULL | –°—á—ë—Ç –¥–µ–±–µ—Ç–∞ |
| 16 | account_credit | TEXT | NULL | –°—á—ë—Ç –∫—Ä–µ–¥–∏—Ç–∞ |

**–ì—Ä—É–ø–ø–∞: payerInfo (5 –ø–æ–ª–µ–π)**
| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|
| 17 | payer_inn | TEXT | NULL | –ò–ù–ù –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 18 | payer_name | TEXT | NULL | –ò–º—è –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 19 | payer_account_number | TEXT | NULL | –ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 20 | payer_document_type | TEXT | NULL | –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 21 | payer_bank_name | TEXT | NULL | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |

**–ì—Ä—É–ø–ø–∞: receiverInfo (6 –ø–æ–ª–µ–π)**
| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|
| 22 | receiver_name | TEXT | NULL | –ò–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 23 | receiver_inn | TEXT | NULL | –ò–ù–ù –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 24 | receiver_account_number | TEXT | NULL | –ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 25 | receiver_document_type | TEXT | NULL | –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 26 | receiver_bank_name | TEXT | NULL | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 27 | payer_bank_account_number | TEXT | NULL | –ö/—Å –±–∞–Ω–∫–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |

**–ì—Ä—É–ø–ø–∞: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã (3 –ø–æ–ª—è)**
| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|
| 28 | receiver_bank_account_number | TEXT | NULL | –ö/—Å –±–∞–Ω–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 29 | currency | TEXT | NULL | –í–∞–ª—é—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞ |
| 30 | currency_control | TEXT | NULL | –ü—Ä–∏–∑–Ω–∞–∫ –≤–∞–ª—é—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è |

#### Kafka –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–ø–æ–ª—è 31-34, 4 –ø–æ–ª—è)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 31 | input_kafka_headers | JSONB | NULL | Kafka headers –≤—Ö–æ–¥—è—â–µ–≥–æ | –ó–∞–≥–æ–ª–æ–≤–∫–∏ Kafka (upoa_enriched_transactions) EXTERNAL STORAGE |
| 32 | output_kafka_headers | JSONB | NULL | Kafka headers –∏—Å—Ö–æ–¥—è—â–µ–≥–æ | –ó–∞–≥–æ–ª–æ–≤–∫–∏ Kafka (upoa_ksk_results) EXTERNAL STORAGE |
| 33 | input_kafka_partition | INTEGER | NULL | Kafka partition | –ù–æ–º–µ—Ä –ø–∞—Ä—Ç–∏—Ü–∏–∏ Kafka –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (—Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞) |
| 34 | input_kafka_offset | BIGINT | NULL | Kafka offset | Offset –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (—É–Ω–∏–∫–∞–ª–µ–Ω —Å partition) |

---

#### –ò–Ω–¥–µ–∫—Å—ã (5 —à—Ç)

| ‚Ññ | –ò–º—è | –¢–∏–ø | –ö–æ–ª–æ–Ω–∫–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|-----|-----|---------|------------|
| 1 | idx_ksk_result_corr_id | B-tree | (corr_id) | –ü–æ–∏—Å–∫ –ø–æ correlation ID |
| 2 | idx_ksk_result_output_ts_brin | BRIN | (output_timestamp) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º (~1000x –º–µ–Ω—å—à–µ B-tree) |
| 3 | idx_ksk_result_list_codes_gin | GIN | (list_codes) | –ü–æ–∏—Å–∫ –ø–æ –º–∞—Å—Å–∏–≤—É –∫–æ–¥–æ–≤ —Å–ø–∏—Å–∫–æ–≤ |
| 4 | idx_ksk_result_aggregation | B-tree Covering | (output_timestamp, resolution, has_bypass) INCLUDE (payment_type) | Index-only scan –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤ |
| 5 | idx_ksk_result_payment_type | B-tree | (payment_type) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π |

**–°–≤—è–∑–∏:** ‚Üí ksk_figurant (1:N)

---

### 2. ksk_figurant (15 –ø–æ–ª–µ–π, 5 –∏–Ω–¥–µ–∫—Å–æ–≤)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–æ–≤ –ø–æ –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏  
**–û–±—ä—ë–º:** ~100-500 —Ñ–∏–≥—É—Ä–∞–Ω—Ç–æ–≤ –Ω–∞ 1M —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π  
**–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:** `PARTITION BY RANGE (timestamp)` ‚Äî **–ø–µ—Ä–∏–æ–¥ 1 –î–ï–ù–¨**  
**PRIMARY KEY:** `(id, timestamp)`

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π (15 –ø–æ–ª–µ–π)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY | AUTO | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ (PRIMARY KEY) |
| 2 | source_id | INTEGER NOT NULL | ‚Äî | ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | –°—Å—ã–ª–∫–∞ –Ω–∞ ksk_result.id (N:1 —Å–≤—è–∑—å, FK —Å CASCADE DELETE) |
| 3 | date | DATE NOT NULL | ‚Äî | –î–∞—Ç–∞ | –î–∞—Ç–∞ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å ksk_result.date, –ù–ï –∫–ª—é—á –ø–∞—Ä—Ç–∏—Ü–∏–∏) |
| 4 | timestamp | TIMESTAMP(3) NOT NULL | ‚Äî | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ (PRIMARY KEY, **–ö–õ–Æ–ß –ü–ê–†–¢–ò–¶–ò–ò**, = output_timestamp) |
| 5 | figurant | JSONB NOT NULL | ‚Äî | –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è | –ü–æ–ª–Ω—ã–π JSON —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ –∏–∑ output_json.searchCheckResultKCKH (EXTERNAL STORAGE) |
| 6 | figurant_index | INTEGER NOT NULL | ‚Äî | –ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä | –ò–Ω–¥–µ–∫—Å —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ –≤ –º–∞—Å—Å–∏–≤–µ searchCheckResultKCKH (0, 1, 2...) |
| 7 | resolution | VARCHAR(20) NOT NULL | ‚Äî | –†–µ–∑–æ–ª—é—Ü–∏—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ | –†–µ—à–µ–Ω–∏–µ –ø–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç—É: allow/review/deny (–≤—ã—á–∏—Å–ª–µ–Ω–æ check_figurant_status) |
| 8 | is_bypass | VARCHAR(10) | 'no' | –ò—Å–∫–ª—é—á–µ–Ω –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è | –ü—Ä–∏–∑–Ω–∞–∫ –æ–±—Ö–æ–¥–∞: yes/no (–¢–û–õ–¨–ö–û –î–í–ê –ó–ù–ê–ß–ï–ù–ò–Ø!) |
| 9 | list_code | TEXT | NULL | –ö–æ–¥ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ | –ö–æ–¥ —Å–ø–∏—Å–∫–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É —Å—Ä–∞–±–æ—Ç–∞–ª–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (SDN, OFAC, –∏ —Ç.–¥.) |
| 10 | name_figurant | TEXT | NULL | –ò–º—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ | –ü–æ–ª–Ω–æ–µ –∏–º—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ –∏–∑ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ |
| 11 | president_group | TEXT | NULL | –ü—Ä–µ–∑–∏–¥–µ–Ω—Ç—Å–∫–∞—è –≥—Ä—É–ø–ø–∞ | –¢–∏–ø –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç—Å–∫–æ–π –≥—Ä—É–ø–ø—ã: part/full/none (–¥–ª—è –º–∞—Ç—Ä–∏—Ü—ã check_figurant_status) |
| 12 | auto_login | BOOLEAN | NULL | –ê–≤—Ç–æ–≤—Ö–æ–¥ | –ü—Ä–∏–∑–Ω–∞–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É (–≤–ª–∏—è–µ—Ç –Ω–∞ resolution) |
| 13 | has_exclusion | BOOLEAN | NULL | –ù–∞–ª–∏—á–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è | –ü—Ä–∏–∑–Ω–∞–∫ –Ω–∞–ª–∏—á–∏—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ –≤ —Å–ø–∏—Å–∫–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π (–≤–ª–∏—è–µ—Ç –Ω–∞ resolution) |
| 14 | exclusion_phrase | TEXT | NULL | –§—Ä–∞–∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è | –§—Ä–∞–∑–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π, –ø–æ –∫–æ—Ç–æ—Ä–æ–π —Ñ–∏–≥—É—Ä–∞–Ω—Ç –±—ã–ª –∏—Å–∫–ª—é—á—ë–Ω |
| 15 | exclusion_name_list | TEXT | NULL | –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π | –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç |

---

#### –ò–Ω–¥–µ–∫—Å—ã (5 —à—Ç)

| ‚Ññ | –ò–º—è | –¢–∏–ø | –ö–æ–ª–æ–Ω–∫–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|-----|-----|---------|------------|
| 1 | idx_ksk_figurant_ts_brin | BRIN | (timestamp) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º (~1000x –º–µ–Ω—å—à–µ B-tree) |
| 2 | idx_ksk_figurant_list_code | B-tree Partial | (list_code) WHERE list_code IS NOT NULL | –ü–æ–∏—Å–∫ –ø–æ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–º—É —Å–ø–∏—Å–∫—É |
| 3 | idx_ksk_figurant_source_id | B-tree | (source_id) | JOIN —Å ksk_result (FK –∏–Ω–¥–µ–∫—Å) |
| 4 | idx_ksk_figurant_resolution | B-tree | (resolution) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–µ–∑–æ–ª—é—Ü–∏–∏ (–¥–ª—è –æ—Ç—á—ë—Ç–æ–≤) |
| 5 | idx_ksk_figurant_is_bypass_yes | B-tree Partial | (is_bypass) WHERE is_bypass = 'yes' | –ü–æ–∏—Å–∫ –æ–±—Ö–æ–¥–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–≤—ã—Å–æ–∫–∞—è —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å) |

**–°–≤—è–∑–∏:**
- ‚Üê ksk_result (N:1)
- ‚Üí ksk_figurant_match (1:N)

---

### 3. ksk_figurant_match (10 –ø–æ–ª–µ–π, 3 –∏–Ω–¥–µ–∫—Å–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π (match) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞  
**–û–±—ä—ë–º:** ~1-10 —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–∞ 1 —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞  
**–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:** `PARTITION BY RANGE (timestamp)` ‚Äî **–ø–µ—Ä–∏–æ–¥ 1 –î–ï–ù–¨**  
**PRIMARY KEY:** `(id, timestamp)`

**‚ö†Ô∏è –í–ê–ñ–ù–û:** Match (—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ) ‚Äî —ç—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, –Ω–∞–π–¥–µ–Ω–Ω–æ–µ –û–î–ù–ò–ú –ê–õ–ì–û–†–ò–¢–ú–û–ú. –û–¥–∏–Ω —Ñ–∏–≥—É—Ä–∞–Ω—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –ù–ï–°–ö–û–õ–¨–ö–û matches, –µ—Å–ª–∏ —Å—Ä–∞–±–æ—Ç–∞–ª–∏ —Ä–∞–∑–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–∏—Å–∫–∞.

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π (10 –ø–æ–ª–µ–π)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY | AUTO | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (PRIMARY KEY) |
| 2 | figurant_id | INTEGER NOT NULL | ‚Äî | ID —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ | –°—Å—ã–ª–∫–∞ –Ω–∞ ksk_figurant.id (N:1 —Å–≤—è–∑—å, FK —Å CASCADE DELETE) |
| 3 | date | DATE NOT NULL | ‚Äî | –î–∞—Ç–∞ | –î–∞—Ç–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å ksk_figurant.date, –ù–ï –∫–ª—é—á –ø–∞—Ä—Ç–∏—Ü–∏–∏) |
| 4 | timestamp | TIMESTAMP(3) NOT NULL | ‚Äî | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (PRIMARY KEY, **–ö–õ–Æ–ß –ü–ê–†–¢–ò–¶–ò–ò**, = ksk_figurant.timestamp) |
| 5 | match | JSONB NOT NULL | ‚Äî | –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è | –ü–æ–ª–Ω—ã–π JSON —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –∏–∑ figurant.matches (EXTERNAL STORAGE) |
| 6 | match_index | INTEGER NOT NULL | ‚Äî | –ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä | –ò–Ω–¥–µ–∫—Å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –≤ –º–∞—Å—Å–∏–≤–µ figurant.matches (0, 1, 2...) |
| 7 | algorithm | VARCHAR(100) NOT NULL | ‚Äî | –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ | –ù–∞–∑–≤–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—à—ë–ª —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ |
| 8 | match_value | TEXT | NULL | –ó–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–≤–ø–∞–ª–æ |
| 9 | match_payment_field | TEXT | NULL | –ü–æ–ª–µ –ø–ª–∞—Ç–µ–∂–∞ | –ò–º—è –ø–æ–ª—è –ø–ª–∞—Ç–µ–∂–∞, –≥–¥–µ –Ω–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ |
| 10 | match_payment_value | TEXT | NULL | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –ø–ª–∞—Ç–µ–∂–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –ø–ª–∞—Ç–µ–∂–∞, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–≤–ø–∞–ª–æ |

---

#### –ò–Ω–¥–µ–∫—Å—ã (3 —à—Ç)

| ‚Ññ | –ò–º—è | –¢–∏–ø | –ö–æ–ª–æ–Ω–∫–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|-----|-----|---------|------------|
| 1 | idx_ksk_match_ts_brin | BRIN | (timestamp) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º (~1000x –º–µ–Ω—å—à–µ B-tree) |
| 2 | idx_ksk_match_figurant_id | B-tree | (figurant_id) | JOIN —Å ksk_figurant (FK –∏–Ω–¥–µ–∫—Å) |
| 3 | idx_ksk_match_algorithm | B-tree | (algorithm) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞) |

**–°–≤—è–∑–∏:** ‚Üê ksk_figurant (N:1)

---

## üîß –°–ò–°–¢–ï–ú–ù–´–ï –¢–ê–ë–õ–ò–¶–´ (2 —à—Ç)

### 4. ksk_result_error (14 –ø–æ–ª–µ–π, 5 –∏–Ω–¥–µ–∫—Å–æ–≤)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ put_ksk_result()  
**–û–±—ä—ë–º:** ~0.01-0.1% –æ—Ç –æ–±—ä—ë–º–∞ ksk_result (—Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏)

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π (14 –ø–æ–ª–µ–π)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY | AUTO | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ—à–∏–±–∫–∏ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ –æ–± –æ—à–∏–±–∫–µ |
| 2 | error_timestamp | TIMESTAMP(3) NOT NULL | NOW() | –í—Ä–µ–º—è –æ—à–∏–±–∫–∏ | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –æ—à–∏–±–∫–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ INSERT) |
| 3 | error_code | VARCHAR(50) NOT NULL | ‚Äî | –ö–æ–¥ –æ—à–∏–±–∫–∏ | MISSING_REQUIRED_FIELD, INVALID_JSON_STRUCTURE, TYPE_MISMATCH, CONSTRAINT_VIOLATION, UNKNOWN_ERROR |
| 4 | error_message | TEXT NOT NULL | ‚Äî | –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ | –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –∏–ª–∏ —Ç–µ–∫—Å—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è PostgreSQL |
| 5 | input_timestamp | TIMESTAMP(3) | NULL | –í—Ä–µ–º—è –≤—Ö–æ–¥—è—â–µ–≥–æ | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (p_input_timestamp –∏–∑ put_ksk_result) |
| 6 | output_timestamp | TIMESTAMP(3) | NULL | –í—Ä–µ–º—è –∏—Å—Ö–æ–¥—è—â–µ–≥–æ | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (p_output_timestamp –∏–∑ put_ksk_result) |
| 7 | kafka_partition | INTEGER NOT NULL | ‚Äî | Kafka partition | –ù–æ–º–µ—Ä –ø–∞—Ä—Ç–∏—Ü–∏–∏ Kafka –≤—Ö–æ–¥—è—â–µ–≥–æ —Ç–æ–ø–∏–∫–∞ (–¥–ª—è replay –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π) |
| 8 | kafka_offset | BIGINT NOT NULL | ‚Äî | Kafka offset | Offset —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Kafka –ø–∞—Ä—Ç–∏—Ü–∏–∏ (—É–Ω–∏–∫–∞–ª–µ–Ω –≤–º–µ—Å—Ç–µ —Å partition, –¥–ª—è replay) |
| 9 | input_kafka_headers | JSONB | NULL | Kafka headers –≤—Ö–æ–¥—è—â–µ–≥–æ | –ü–æ–ª–Ω—ã–µ Kafka headers upoa_enriched_transactions (EXTERNAL STORAGE) |
| 10 | output_kafka_headers | JSONB | NULL | Kafka headers –∏—Å—Ö–æ–¥—è—â–µ–≥–æ | –ü–æ–ª–Ω—ã–µ Kafka headers upoa_ksk_results (EXTERNAL STORAGE) |
| 11 | corr_id | VARCHAR(100) | NULL | Correlation ID | Correlation ID –∏–∑ input_json.corrId (–º–æ–∂–µ—Ç –±—ã—Ç—å NULL –ø—Ä–∏ –±–∏—Ç–æ–º JSON) |
| 12 | input_json | JSONB NOT NULL | ‚Äî | –í—Ö–æ–¥—è—â–∏–π JSON | –ü–æ–ª–Ω—ã–π –¥–∞–º–ø –≤—Ö–æ–¥—è—â–µ–≥–æ JSON –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –±–∏—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö (EXTERNAL STORAGE) |
| 13 | output_json | JSONB | NULL | –ò—Å—Ö–æ–¥—è—â–∏–π JSON | –ü–æ–ª–Ω—ã–π –¥–∞–º–ø –∏—Å—Ö–æ–¥—è—â–µ–≥–æ JSON (EXTERNAL STORAGE, –º–æ–∂–µ—Ç –±—ã—Ç—å NULL) |
| 14 | function_context | TEXT | NULL | –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ | –°—Ç–µ–∫-—Ç—Ä–µ–π—Å, SQLSTATE –∫–æ–¥, –∏–ª–∏ –¥—Ä—É–≥–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è |

---

#### –ò–Ω–¥–µ–∫—Å—ã (5 —à—Ç)

| ‚Ññ | –ò–º—è | –¢–∏–ø | –ö–æ–ª–æ–Ω–∫–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|-----|-----|---------|------------|
| 1 | idx_ksk_result_error_timestamp | BRIN | (error_timestamp) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –æ—à–∏–±–∫–∏ (~1000x –º–µ–Ω—å—à–µ B-tree) |
| 2 | idx_ksk_result_error_error_code | B-tree | (error_code) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É –æ—à–∏–±–∫–∏ (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥) |
| 3 | idx_ksk_result_error_kafka_meta | B-tree Composite | (kafka_partition, kafka_offset) | –ü–æ–∏—Å–∫ –ø–æ Kafka –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º –¥–ª—è replay |
| 4 | idx_ksk_result_error_corr_id | B-tree Partial | (corr_id) WHERE corr_id IS NOT NULL | –ü–æ–∏—Å–∫ –ø–æ correlation ID (—Ç–æ–ª—å–∫–æ NOT NULL) |
| 5 | idx_ksk_result_error_output_ts | BRIN | (output_timestamp) | –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è —Å —Ç–∞–±–ª–∏—Ü–µ–π ksk_result –ø–æ output_timestamp |

---

### 5. ksk_system_operations_log (9 –ø–æ–ª–µ–π, 3 –∏–Ω–¥–µ–∫—Å–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (CRON, maintenance, cleanup)  
**–û–±—ä—ë–º:** ~100-1000 –∑–∞–ø–∏—Å–µ–π/–¥–µ–Ω—å

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π (9 –ø–æ–ª–µ–π)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY | AUTO | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ª–æ–≥–∞ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è |
| 2 | operation_code | VARCHAR(50) NOT NULL | ‚Äî | –ö–æ–¥ –æ–ø–µ—Ä–∞—Ü–∏–∏ | create_partitions, drop_partitions, cleanup_empty, run_report, monitor_bloat, –∏ —Ç.–¥. |
| 3 | operation_name | VARCHAR(200) NOT NULL | ‚Äî | –ù–∞–∑–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ | –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ |
| 4 | begin_time | TIMESTAMP(3) NOT NULL | NOW() | –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ | –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ INSERT) |
| 5 | end_time | TIMESTAMP(3) | NULL | –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è | –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ) |
| 6 | duration | INTERVAL | NULL | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ (–≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è: end_time - begin_time) |
| 7 | status | VARCHAR(20) NOT NULL | ‚Äî | –°—Ç–∞—Ç—É—Å | success –∏–ª–∏ error (CHECK constraint: status IN ('success', 'error')) |
| 8 | info | TEXT | NULL | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (JSON –∏–ª–∏ —Ç–µ–∫—Å—Ç) |
| 9 | err_msg | TEXT | NULL | –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ | –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è status='error') |

---

#### –ò–Ω–¥–µ–∫—Å—ã (3 —à—Ç)

| ‚Ññ | –ò–º—è | –¢–∏–ø | –ö–æ–ª–æ–Ω–∫–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|-----|-----|---------|------------|
| 1 | idx_ksk_system_operations_log_operation_code | B-tree | (operation_code) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–æ–≤ –ø–æ –∫–æ–¥—É –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| 2 | idx_ksk_system_operations_log_begin_time | B-tree | (begin_time) | –í—Ä–µ–º–µ–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–æ–≤ |
| 3 | idx_ksk_system_operations_log_status | B-tree | (status) | –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ (WHERE status = 'error') |

---

## üìä –¢–ò–ü–´ –û–¢–ß–Å–¢–û–í (5 —à—Ç)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –æ—Ç—á—ë—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ –ö–°–ö

**‚öôÔ∏è –•—Ä–∞–Ω–µ–Ω–∏–µ:** –¢–∞–±–ª–∏—Ü–∞ `ksk_report_orchestrator` ‚Äî —Å–º. [–û—Ç—á—ë—Ç–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã] –≤ Part 2  
**‚öôÔ∏è –ó–∞–ø—É—Å–∫:** –§—É–Ω–∫—Ü–∏—è `ksk_run_report()` ‚Äî —Å–º. [–§—É–Ω–∫—Ü–∏–∏] –≤ Part 2

### –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –æ—Ç—á—ë—Ç–æ–≤

| report_code | report_function | report_table | name | system_ttl | user_ttl |
|-------------|-----------------|--------------|------|------------|----------|
| `totals` | ksk_report_totals | ksk_report_totals_data | –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | 365 | 14 |
| `totals_by_payment_type` | ksk_report_totals_by_payment_type | ksk_report_totals_by_payment_type_data | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π (–ø–æ—Ç–æ–∫–∏) | 365 | 14 |
| `list_totals` | ksk_report_list_totals | ksk_report_list_totals_data | –ò—Ç–æ–≥–∏ –ø–æ —Å–ø–∏—Å–∫–∞–º | 365 | 14 |
| `list_totals_by_payment_type` | ksk_report_list_totals_by_payment_type | ksk_report_list_totals_by_payment_type_data | –°–ø–∏—Å–∫–∏ –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π (–ø–æ—Ç–æ–∫–∏) | 365 | 14 |
| `figurants` | ksk_report_figurants | ksk_report_figurants_data | –û—Ç—á—ë—Ç –ø–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞–º | 30 | 7 |

---

### –°—Ö–µ–º–∞ —Å–≤—è–∑–µ–π

```
ksk_run_report('totals', ...)
    ‚Üì
    –ß–∏—Ç–∞–µ—Ç ksk_report_orchestrator: report_code='totals'
    ‚Üì
    –í—ã–∑—ã–≤–∞–µ—Ç report_function: ksk_report_totals()
    ‚Üì
    –í—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ report_table: ksk_report_totals_data
```

---

### –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –æ—Ç—á—ë—Ç–æ–≤

#### 1. totals ‚Äî –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º –∑–∞ –ø–µ—Ä–∏–æ–¥  
**–î–∞–Ω–Ω—ã–µ:** 7 —Å—á—ë—Ç—á–∏–∫–æ–≤ (total, total_without_result, total_with_result, total_allow, total_review, total_deny, total_bypass)  
**–¢–∞–±–ª–∏—Ü–∞:** ksk_report_totals_data (10 –ø–æ–ª–µ–π) ‚Äî —Å–º. Part 2  
**–§—É–Ω–∫—Ü–∏—è:** ksk_report_totals() ‚Äî —Å–º. Part 2  
**TTL:** 365 –¥–Ω–µ–π (system) / 14 –¥–Ω–µ–π (user)

---

#### 2. totals_by_payment_type ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π (–ø–æ—Ç–æ–∫–∏)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ 5 —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π (I/O/T/M/V)  
**–î–∞–Ω–Ω—ã–µ:** 7 –æ–±—â–∏—Ö —Å—á—ë—Ç—á–∏–∫–æ–≤ + 5 –≥—Ä—É–ø–ø –ø–æ 7 —Å—á—ë—Ç—á–∏–∫–æ–≤ (44 –ø–æ–ª—è)  
**–¢–∞–±–ª–∏—Ü–∞:** ksk_report_totals_by_payment_type_data (44 –ø–æ–ª—è) ‚Äî —Å–º. Part 2  
**–§—É–Ω–∫—Ü–∏—è:** ksk_report_totals_by_payment_type() ‚Äî —Å–º. Part 2  
**TTL:** 365 –¥–Ω–µ–π (system) / 14 –¥–Ω–µ–π (user)

---

#### 3. list_totals ‚Äî –ò—Ç–æ–≥–∏ –ø–æ —Å–ø–∏—Å–∫–∞–º

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –∫–æ–¥–∞–º —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤  
**–î–∞–Ω–Ω—ã–µ:** 6 —Å—á—ë—Ç—á–∏–∫–æ–≤ –Ω–∞ –∫–∞–∂–¥—ã–π —Å–ø–∏—Å–æ–∫ (total_with_list, total_without_list, total_allow, total_review, total_deny, total_bypass)  
**–¢–∞–±–ª–∏—Ü–∞:** ksk_report_list_totals_data (10 –ø–æ–ª–µ–π) ‚Äî —Å–º. Part 2  
**–§—É–Ω–∫—Ü–∏—è:** ksk_report_list_totals() ‚Äî —Å–º. Part 2  
**TTL:** 365 –¥–Ω–µ–π (system) / 14 –¥–Ω–µ–π (user)

---

#### 4. list_totals_by_payment_type ‚Äî –°–ø–∏—Å–∫–∏ –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π (–ø–æ—Ç–æ–∫–∏)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –∫–æ–¥–∞–º —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤ —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ 5 —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π  
**–î–∞–Ω–Ω—ã–µ:** 6 –æ–±—â–∏—Ö —Å—á—ë—Ç—á–∏–∫–æ–≤ + 5 –≥—Ä—É–ø–ø –ø–æ 6 —Å—á—ë—Ç—á–∏–∫–æ–≤ (39 –ø–æ–ª–µ–π)  
**–¢–∞–±–ª–∏—Ü–∞:** ksk_report_list_totals_by_payment_type_data (39 –ø–æ–ª–µ–π) ‚Äî —Å–º. Part 2  
**–§—É–Ω–∫—Ü–∏—è:** ksk_report_list_totals_by_payment_type() ‚Äî —Å–º. Part 2  
**TTL:** 365 –¥–Ω–µ–π (system) / 14 –¥–Ω–µ–π (user)

---

#### 5. figurants ‚Äî –û—Ç—á—ë—Ç –ø–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞–º

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É —Ñ–∏–≥—É—Ä–∞–Ω—Ç—É  
**–î–∞–Ω–Ω—ã–µ:** 5 —Å—á—ë—Ç—á–∏–∫–æ–≤ –Ω–∞ –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ (total, total_allow, total_review, total_deny, total_bypass) + –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ  
**–¢–∞–±–ª–∏—Ü–∞:** ksk_report_figurants_data (14 –ø–æ–ª–µ–π) ‚Äî —Å–º. Part 2  
**–§—É–Ω–∫—Ü–∏—è:** ksk_report_figurants() ‚Äî —Å–º. Part 2  
**TTL:** 30 –¥–Ω–µ–π (system) / 7 –¥–Ω–µ–π (user)  
**‚ö†Ô∏è –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `p_parameters` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∫–æ–¥–∞–º —Å–ø–∏—Å–∫–æ–≤

---

## üìã –û–¢–ß–Å–¢ –ü–û –°–û–í–ü–ê–î–ï–ù–ò–Ø–ú

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–µ—Ç–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, —Ç—Ä–µ–±—É—é—â–∏—Ö —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (resolution='review')  
**–°–∏–Ω–æ–Ω–∏–º—ã:** –û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–∞–º, –ü—Ä–æ–≤–µ—Ä–∫–∏  
**–¢–∏–ø:** VIEW-—Ñ—É–Ω–∫—Ü–∏—è (–±–µ–∑ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏)

**‚öôÔ∏è –§—É–Ω–∫—Ü–∏—è:** `ksk_report_review()` ‚Äî —Å–º. Part 2

---

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –û–±—ã—á–Ω—ã–µ –æ—Ç—á—ë—Ç—ã (totals, list_totals, figurants) | ksk_report_review |
|----------|--------------------------------------------------|-------------------|
| **–í—ã–∑–æ–≤** | –ß–µ—Ä–µ–∑ ksk_run_report('totals', ...) | –ù–∞–ø—Ä—è–º—É—é SELECT * FROM ksk_report_review('2025-10-22') |
| **–•—Ä–∞–Ω–µ–Ω–∏–µ** | –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ (ksk_report_*_data) | –ù–ï–¢ —Ö—Ä–∞–Ω–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ VIEW/query) |
| **–ó–∞–≥–æ–ª–æ–≤–æ–∫** | –°–æ–∑–¥–∞—ë—Ç—Å—è –≤ ksk_report_header | –ù–ï–¢ –∑–∞–≥–æ–ª–æ–≤–∫–∞ |
| **TTL** | 7-365 –¥–Ω–µ–π | –ù–µ—Ç (–¥–∞–Ω–Ω—ã–µ –ù–ï —Ö—Ä–∞–Ω—è—Ç—Å—è) |
| **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä** | –ï—Å—Ç—å –∑–∞–ø–∏—Å—å –≤ ksk_report_orchestrator | –ù–ï–¢ –∑–∞–ø–∏—Å–∏ –≤ orchestrator |
| **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** | –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | –î–µ—Ç–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ |

---

### –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –ø–æ–ª—è (35 –ø–æ–ª–µ–π)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|--------------|----------|
| 1 | corr_id | VARCHAR(100) | –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π ID | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ |
| 2 | message_timestamp | TIMESTAMP(3) | –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è (output_timestamp) |
| 3 | algorithm | VARCHAR(100) | –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ | –ù–∞–∑–≤–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞, –Ω–∞—à–µ–¥—à–µ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ |
| 4 | match_value | TEXT | –ó–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–≤–ø–∞–ª–æ |
| 5 | match_payment_field | TEXT | –ü–æ–ª–µ –ø–ª–∞—Ç–µ–∂–∞ | –ò–º—è –ø–æ–ª—è –ø–ª–∞—Ç–µ–∂–∞, –≥–¥–µ –Ω–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ |
| 6 | match_payment_value | TEXT | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –ø–ª–∞—Ç–µ–∂–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –ø–ª–∞—Ç–µ–∂–∞, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–≤–ø–∞–ª–æ |
| 7 | list_code | TEXT | –ö–æ–¥ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ | –ö–æ–¥ —Å–ø–∏—Å–∫–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É —Å—Ä–∞–±–æ—Ç–∞–ª–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ |
| 8 | name_figurant | TEXT | –ò–º—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ | –ü–æ–ª–Ω–æ–µ –∏–º—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ –∏–∑ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ |
| 9 | president_group | TEXT | –ü—Ä–µ–∑–∏–¥–µ–Ω—Ç—Å–∫–∞—è –≥—Ä—É–ø–ø–∞ | –¢–∏–ø –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç—Å–∫–æ–π –≥—Ä—É–ø–ø—ã: part/full/none |
| 10 | auto_login | BOOLEAN | –ê–≤—Ç–æ–≤—Ö–æ–¥ | –ü—Ä–∏–∑–Ω–∞–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É |
| 11 | has_exclusion | BOOLEAN | –ù–∞–ª–∏—á–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è | –ü—Ä–∏–∑–Ω–∞–∫ –Ω–∞–ª–∏—á–∏—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ –≤ —Å–ø–∏—Å–∫–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π |
| 12 | exclusion_phrase | TEXT | –§—Ä–∞–∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è | –§—Ä–∞–∑–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π |
| 13 | exclusion_name_list | TEXT | –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π | –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π |
| 14 | is_bypass | VARCHAR(10) | –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ | –ü—Ä–∏–∑–Ω–∞–∫ –æ–±—Ö–æ–¥–∞ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞: yes/no |
| 15 | transaction_resolution | VARCHAR(20) | –†–µ–∑–æ–ª—é—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | –†–µ—à–µ–Ω–∏–µ –ø–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: allow/review/deny/empty |
| 16 | figurant_resolution | VARCHAR(20) | –†–µ–∑–æ–ª—é—Ü–∏—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ | –†–µ—à–µ–Ω–∏–µ –ø–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç—É: allow/review/deny |
| 17 | payment_id | TEXT | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–ª–∞—Ç–µ–∂–∞ | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–ª–∞—Ç–µ–∂–∞ |
| 18 | payment_purpose | TEXT | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ |
| 19 | account_debet | TEXT | –°—á—ë—Ç –¥–µ–±–µ—Ç–∞ | –°—á—ë—Ç –¥–µ–±–µ—Ç–∞ |
| 20 | account_credit | TEXT | –°—á—ë—Ç –∫—Ä–µ–¥–∏—Ç–∞ | –°—á—ë—Ç –∫—Ä–µ–¥–∏—Ç–∞ |
| 21 | payer_inn | TEXT | –ò–ù–ù –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ | –ò–ù–ù –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 22 | payer_name | TEXT | –ò–º—è –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ | –ò–º—è –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 23 | payer_account_number | TEXT | –ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ | –ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 24 | payer_document_type | TEXT | –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ | –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 25 | payer_bank_name | TEXT | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 26 | payer_bank_account_number | TEXT | –ö/—Å –±–∞–Ω–∫–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ | –ö/—Å –±–∞–Ω–∫–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ |
| 27 | receiver_account_number | TEXT | –ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è | –ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 28 | receiver_name | TEXT | –ò–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è | –ò–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 29 | receiver_inn | TEXT | –ò–ù–ù –ø–æ–ª—É—á–∞—Ç–µ–ª—è | –ò–ù–ù –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 30 | receiver_bank_name | TEXT | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 31 | receiver_bank_account_number | TEXT | –ö/—Å –±–∞–Ω–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è | –ö/—Å –±–∞–Ω–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 32 | receiver_document_type | TEXT | –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è | –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è |
| 33 | amount | TEXT | –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞ | –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞ |
| 34 | currency | TEXT | –í–∞–ª—é—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞ | –í–∞–ª—é—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞ |
| 35 | currency_control | TEXT | –ü—Ä–∏–∑–Ω–∞–∫ –≤–∞–ª—é—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è | –ü—Ä–∏–∑–Ω–∞–∫ –≤–∞–ª—é—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è |

---
# üìò KSK Database Schema Reference

**–í–µ—Ä—Å–∏—è:** 3.8.1 CORRECTED (Part 2 of 2)  
**–î–∞—Ç–∞:** 31.10.2025 17:46 MSK

---

## üìà –û–¢–ß–Å–¢–ù–´–ï –¢–ê–ë–õ–ò–¶–´ (7 —à—Ç, 139 –ø–æ–ª–µ–π)

**‚öôÔ∏è –û–±—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á—ë—Ç–æ–≤
- –°–≤—è–∑–∏: –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–≤—è–∑–∞–Ω—ã —Å ksk_report_header —á–µ—Ä–µ–∑ report_header_id (CASCADE DELETE)
- –ò–Ω–¥–µ–∫—Å—ã: –ú–∏–Ω–∏–º—É–º FK –∏–Ω–¥–µ–∫—Å—ã, –±–µ–∑ –∏–∑–ª–∏—à–Ω–∏—Ö

---

### 6. ksk_report_orchestrator (9 –ø–æ–ª–µ–π, 1 –∏–Ω–¥–µ–∫—Å)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç–∏–ø–æ–≤ –æ—Ç—á—ë—Ç–æ–≤ (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫)

**üìã –°–º. –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –æ—Ç—á—ë—Ç–æ–≤:** [–¢–∏–ø—ã –æ—Ç—á—ë—Ç–æ–≤] –≤ Part 1

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π (9 –ø–æ–ª–µ–π)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY | AUTO | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–∏–ø–∞ –æ—Ç—á—ë—Ç–∞ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ |
| 2 | report_code | VARCHAR(50) NOT NULL UNIQUE | ‚Äî | –ö–æ–¥ –æ—Ç—á—ë—Ç–∞ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥: totals, list_totals, figurants, –∏ —Ç.–¥. (UNIQUE constraint) |
| 3 | report_table | VARCHAR(100) | NULL | –¢–∞–±–ª–∏—Ü–∞ –¥–∞–Ω–Ω—ã—Ö | –ò–º—è —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ |
| 4 | report_function | VARCHAR(100) NOT NULL | ‚Äî | –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ | –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–∞ |
| 5 | name | VARCHAR(200) NOT NULL | ‚Äî | –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞ | –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ |
| 6 | system_ttl | INTEGER NOT NULL | 30 | –°–∏—Å—Ç–µ–º–Ω—ã–π TTL | Time-to-live –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤ (–¥–Ω–∏) |
| 7 | user_ttl | INTEGER NOT NULL | 7 | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π TTL | Time-to-live –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –æ—Ç—á—ë—Ç–æ–≤ (–¥–Ω–∏) |
| 8 | created_at | TIMESTAMP | NOW() | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è | –î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ |
| 9 | updated_at | TIMESTAMP | NOW() | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ |

#### –ò–Ω–¥–µ–∫—Å—ã (1 —à—Ç)

- **UNIQUE** –Ω–∞ `report_code` (constraint-–∏–Ω–¥–µ–∫—Å)

**–°–≤—è–∑–∏:** ‚Üí ksk_report_header (1:N)

---

### 7. ksk_report_header (13 –ø–æ–ª–µ–π, 4 –∏–Ω–¥–µ–∫—Å–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç—á—ë—Ç–æ–≤ (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞)

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π (13 –ø–æ–ª–µ–π)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY | AUTO | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞ |
| 2 | orchestrator_id | INTEGER NOT NULL | ‚Äî | ID —Ç–∏–ø–∞ –æ—Ç—á—ë—Ç–∞ | –°—Å—ã–ª–∫–∞ –Ω–∞ ksk_report_orchestrator.id (FK —Å CASCADE DELETE) |
| 3 | name | VARCHAR(500) NOT NULL | ‚Äî | –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞ | –ù–∞–∑–≤–∞–Ω–∏–µ —Å –ø–µ—Ä–∏–æ–¥–æ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä "–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ 22.10.2025" |
| 4 | initiator | VARCHAR(100) NOT NULL | ‚Äî | –ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä –∑–∞–ø—É—Å–∫–∞ | system –∏–ª–∏ user (CHECK constraint) |
| 5 | user_login | VARCHAR(100) | NULL | –õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è, –µ—Å–ª–∏ initiator='user' |
| 6 | created_datetime | TIMESTAMP NOT NULL | NOW() | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è | –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á—ë—Ç–∞ |
| 7 | finished_datetime | TIMESTAMP | NULL | –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è | –í—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–∞ |
| 8 | status | VARCHAR(20) NOT NULL | 'created' | –°—Ç–∞—Ç—É—Å –æ—Ç—á—ë—Ç–∞ | created, in_progress, done, error (CHECK constraint) |
| 9 | ttl | INTEGER NOT NULL | ‚Äî | TTL –æ—Ç—á—ë—Ç–∞ | Time-to-live (–≤–∑—è—Ç–æ –∏–∑ orchestrator) |
| 10 | remove_date | DATE NOT NULL | ‚Äî | –î–∞—Ç–∞ —É–¥–∞–ª–µ–Ω–∏—è | created_datetime + ttl –¥–Ω–µ–π |
| 11 | start_date | DATE | NULL | –ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞ | –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞ |
| 12 | end_date | DATE | NULL | –ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ | –ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å = start_date) |
| 13 | parameters | JSONB | NULL | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞ | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ |

#### –ò–Ω–¥–µ–∫—Å—ã (4 —à—Ç)

| ‚Ññ | –ò–º—è | –¢–∏–ø | –ö–æ–ª–æ–Ω–∫–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|-----|-----|---------|------------|
| 1 | idx_ksk_report_header_orchestrator_id | B-tree | (orchestrator_id) | JOIN —Å ksk_report_orchestrator (FK –∏–Ω–¥–µ–∫—Å) |
| 2 | idx_ksk_report_header_status | B-tree | (status) | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É |
| 3 | idx_ksk_report_header_remove_date | B-tree | (remove_date) | –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –æ—Ç—á—ë—Ç–æ–≤ (TTL cleanup) |
| 4 | idx_ksk_report_header_created_datetime | B-tree | (created_datetime) | –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è |

**–°–≤—è–∑–∏:**
- ‚Üê ksk_report_orchestrator (N:1)
- ‚Üí ksk_report_*_data (1:N)

**Constraints:**
- `CHECK (initiator IN ('system', 'user'))`
- `CHECK (status IN ('created', 'in_progress', 'done', 'error'))`
- `CHECK ((initiator='user' AND user_login IS NOT NULL) OR (initiator='system' AND user_login IS NULL))`

---

### 8-12. –¢–∞–±–ª–∏—Ü—ã –¥–∞–Ω–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤ (5 —à—Ç, 117 –ø–æ–ª–µ–π)

**‚öôÔ∏è –û–±—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–≤—è–∑–∞–Ω—ã —Å ksk_report_header —á–µ—Ä–µ–∑ report_header_id (CASCADE DELETE)
- created_datetime ‚Äî TIMESTAMP –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
- –ú–∏–Ω–∏–º—É–º 1 FK –∏–Ω–¥–µ–∫—Å –Ω–∞ report_header_id

---

### 8. ksk_report_totals_data (10 –ø–æ–ª–µ–π, 2 –∏–Ω–¥–µ–∫—Å–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—á—ë—Ç–∞ "–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π (10 –ø–æ–ª–µ–π)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY | AUTO | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ |
| 2 | report_header_id | INTEGER NOT NULL | ‚Äî | ID –∑–∞–≥–æ–ª–æ–≤–∫–∞ | –°—Å—ã–ª–∫–∞ –Ω–∞ ksk_report_header.id (FK —Å CASCADE DELETE) |
| 3 | created_datetime | TIMESTAMP NOT NULL | NOW() | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö |
| 4 | total | INTEGER NOT NULL | ‚Äî | –í—Å–µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π | –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π |
| 5 | total_without_result | INTEGER NOT NULL | ‚Äî | –ù–µ —Å–æ–≤–ø–∞–ª–æ —Å –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ –î–û–ü–ë | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±–µ–∑ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π —Å –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ |
| 6 | total_with_result | INTEGER NOT NULL | ‚Äî | –°–æ–≤–ø–∞–ª–æ —Å –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ –î–û–ü–ë | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ |
| 7 | total_allow | INTEGER NOT NULL | ‚Äî | –†–∞–∑—Ä–µ—à–µ–Ω–æ | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å resolution='allow' |
| 8 | total_review | INTEGER NOT NULL | ‚Äî | –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å resolution='review' |
| 9 | total_deny | INTEGER NOT NULL | ‚Äî | –û—Ç–∫–ª–æ–Ω–µ–Ω–æ | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å resolution='deny' |
| 10 | total_bypass | INTEGER NOT NULL | ‚Äî | –ò—Å–∫–ª—é—á–µ–Ω–æ –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å has_bypass='yes' |

#### –ò–Ω–¥–µ–∫—Å—ã (2 —à—Ç)

- `idx_ksk_report_totals_data_report_header_id` ‚Äî B-tree –Ω–∞ (report_header_id) –¥–ª—è FK
- `idx_ksk_report_totals_data_created_datetime` ‚Äî B-tree –Ω–∞ (created_datetime)

---

### 9. ksk_report_list_totals_data (10 –ø–æ–ª–µ–π, 3 –∏–Ω–¥–µ–∫—Å–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—á—ë—Ç–∞ "–ò—Ç–æ–≥–∏ –ø–æ —Å–ø–∏—Å–∫–∞–º"

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π (10 –ø–æ–ª–µ–π)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY | AUTO | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ |
| 2 | report_header_id | INTEGER NOT NULL | ‚Äî | ID –∑–∞–≥–æ–ª–æ–≤–∫–∞ | –°—Å—ã–ª–∫–∞ –Ω–∞ ksk_report_header.id (FK —Å CASCADE DELETE) |
| 3 | created_datetime | TIMESTAMP NOT NULL | NOW() | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö |
| 4 | list_code | VARCHAR(100) NOT NULL | ‚Äî | –ö–æ–¥ —Å–ø–∏—Å–∫–∞ | –ö–æ–¥ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ |
| 5 | total_with_list | INTEGER NOT NULL | ‚Äî | –° —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º–∏ | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º–∏ –ø–æ —ç—Ç–æ–º—É —Å–ø–∏—Å–∫—É |
| 6 | total_without_list | INTEGER NOT NULL | ‚Äî | –ë–µ–∑ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±–µ–∑ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –ø–æ —ç—Ç–æ–º—É —Å–ø–∏—Å–∫—É |
| 7 | total_allow | INTEGER NOT NULL | ‚Äî | –†–∞–∑—Ä–µ—à–µ–Ω–æ | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å resolution='allow' |
| 8 | total_review | INTEGER NOT NULL | ‚Äî | –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å resolution='review' |
| 9 | total_deny | INTEGER NOT NULL | ‚Äî | –û—Ç–∫–ª–æ–Ω–µ–Ω–æ | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å resolution='deny' |
| 10 | total_bypass | INTEGER NOT NULL | ‚Äî | –ò—Å–∫–ª—é—á–µ–Ω–æ –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å has_bypass='yes' |

#### –ò–Ω–¥–µ–∫—Å—ã (3 —à—Ç)

- `idx_ksk_report_list_totals_data_report_header_id` ‚Äî B-tree –Ω–∞ (report_header_id) –¥–ª—è FK
- `idx_ksk_report_list_totals_data_created_datetime` ‚Äî B-tree –Ω–∞ (created_datetime)
- `idx_ksk_report_list_totals_data_list_code` ‚Äî B-tree –Ω–∞ (list_code)

---

### 10. ksk_report_totals_by_payment_type_data (44 –ø–æ–ª—è, 1 –∏–Ω–¥–µ–∫—Å)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—á—ë—Ç–∞ "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π (–ø–æ—Ç–æ–∫–∏)"

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π (44 –ø–æ–ª—è)

**–û–±—â–∏–µ –ø–æ–ª—è (3 –ø–æ–ª—è):**
- `id` ‚Äî PRIMARY KEY
- `report_header_id` ‚Äî FK –Ω–∞ ksk_report_header
- `created_datetime` ‚Äî TIMESTAMP

**–û–±—â–∏–µ —Å—á—ë—Ç—á–∏–∫–∏ (7 –ø–æ–ª–µ–π):**
- `total` ‚Äî –í—Å–µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- `total_without_result` ‚Äî –ù–µ —Å–æ–≤–ø–∞–ª–æ —Å –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ –î–û–ü–ë
- `total_with_result` ‚Äî –°–æ–≤–ø–∞–ª–æ —Å –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ –î–û–ü–ë
- `total_allow` ‚Äî –†–∞–∑—Ä–µ—à–µ–Ω–æ
- `total_review` ‚Äî –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- `total_deny` ‚Äî –û—Ç–∫–ª–æ–Ω–µ–Ω–æ
- `total_bypass` ‚Äî –ò—Å–∫–ª—é—á–µ–Ω–æ –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è

**–ì—Ä—É–ø–ø—ã –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π (5 –≥—Ä—É–ø–ø √ó 7 —Å—á—ë—Ç—á–∏–∫–æ–≤ = 34 –ø–æ–ª—è):**
- **–ü—Ä–µ—Ñ–∏–∫—Å `i_`:** –í—Ö–æ–¥—è—â–∏–π (I)
- **–ü—Ä–µ—Ñ–∏–∫—Å `o_`:** –ò—Å—Ö–æ–¥—è—â–∏–π (O)
- **–ü—Ä–µ—Ñ–∏–∫—Å `t_`:** –¢—Ä–∞–Ω–∑–∏—Ç–Ω—ã–π (T)
- **–ü—Ä–µ—Ñ–∏–∫—Å `m_`:** –ú–µ–∂—Ñ–∏–ª–∏–∞–ª—å–Ω—ã–π (M)
- **–ü—Ä–µ—Ñ–∏–∫—Å `v_`:** –í–Ω—É—Ç—Ä–∏—Ñ–∏–ª–∏–∞–ª—å–Ω—ã–π (V)

–ö–∞–∂–¥–∞—è –≥—Ä—É–ø–ø–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç 7 –ø–æ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è `i_`):
- `i_total`, `i_total_without_result`, `i_total_with_result`, `i_total_allow`, `i_total_review`, `i_total_deny`, `i_total_bypass`

#### –ò–Ω–¥–µ–∫—Å—ã (1 —à—Ç)

- `idx_ksk_report_totals_by_payment_type_data_report_header_id` ‚Äî B-tree –Ω–∞ (report_header_id) –¥–ª—è FK

---

### 11. ksk_report_list_totals_by_payment_type_data (39 –ø–æ–ª–µ–π, 2 –∏–Ω–¥–µ–∫—Å–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—á—ë—Ç–∞ "–°–ø–∏—Å–∫–∏ –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π (–ø–æ—Ç–æ–∫–∏)"

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π (39 –ø–æ–ª–µ–π)

**–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (4 –ø–æ–ª—è):**
- `id` ‚Äî PRIMARY KEY
- `report_header_id` ‚Äî FK –Ω–∞ ksk_report_header
- `created_datetime` ‚Äî TIMESTAMP
- `list_code` ‚Äî –ö–æ–¥ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞

**–û–±—â–∏–µ —Å—á—ë—Ç—á–∏–∫–∏ (6 –ø–æ–ª–µ–π):**
- `total_with_list` ‚Äî –° —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º–∏
- `total_without_list` ‚Äî –ë–µ–∑ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
- `total_allow` ‚Äî –†–∞–∑—Ä–µ—à–µ–Ω–æ
- `total_review` ‚Äî –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- `total_deny` ‚Äî –û—Ç–∫–ª–æ–Ω–µ–Ω–æ
- `total_bypass` ‚Äî –ò—Å–∫–ª—é—á–µ–Ω–æ –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è

**–ì—Ä—É–ø–ø—ã –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π (5 –≥—Ä—É–ø–ø √ó 6 —Å—á—ë—Ç—á–∏–∫–æ–≤ = 30 –ø–æ–ª–µ–π):**
- **–ü—Ä–µ—Ñ–∏–∫—Å `i_`:** –í—Ö–æ–¥—è—â–∏–π (I)
- **–ü—Ä–µ—Ñ–∏–∫—Å `o_`:** –ò—Å—Ö–æ–¥—è—â–∏–π (O)
- **–ü—Ä–µ—Ñ–∏–∫—Å `t_`:** –¢—Ä–∞–Ω–∑–∏—Ç–Ω—ã–π (T)
- **–ü—Ä–µ—Ñ–∏–∫—Å `m_`:** –ú–µ–∂—Ñ–∏–ª–∏–∞–ª—å–Ω—ã–π (M)
- **–ü—Ä–µ—Ñ–∏–∫—Å `v_`:** –í–Ω—É—Ç—Ä–∏—Ñ–∏–ª–∏–∞–ª—å–Ω—ã–π (V)

–ö–∞–∂–¥–∞—è –≥—Ä—É–ø–ø–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç 6 –ø–æ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è `i_`):
- `i_total_with_list`, `i_total_without_list`, `i_total_allow`, `i_total_review`, `i_total_deny`, `i_total_bypass`

#### –ò–Ω–¥–µ–∫—Å—ã (2 —à—Ç)

- `idx_ksk_report_list_totals_by_payment_type_data_report_header_id` ‚Äî B-tree –Ω–∞ (report_header_id) –¥–ª—è FK
- `idx_ksk_report_list_totals_by_payment_type_data_list_code` ‚Äî B-tree –Ω–∞ (list_code)

---

### 12. ksk_report_figurants_data (14 –ø–æ–ª–µ–π, 1 –∏–Ω–¥–µ–∫—Å)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—á—ë—Ç–∞ "–û—Ç—á—ë—Ç –ø–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞–º"

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –í –≤–µ—Ä—Å–∏–∏ 3.8 –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `exclusion_name_list` (–ø–æ–ª–µ ‚Ññ9). –¢—Ä–µ–±—É–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è –ë–î ‚Äî —Å–º. MIGRATION_CHANGELOG_v3_8_1.md

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π (14 –ø–æ–ª–µ–π)

| ‚Ññ | –ü–æ–ª–µ | –¢–∏–ø | Default | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|-----|---------|--------------|----------|
| 1 | id | INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY | AUTO | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ |
| 2 | report_header_id | INTEGER NOT NULL | ‚Äî | ID –∑–∞–≥–æ–ª–æ–≤–∫–∞ | –°—Å—ã–ª–∫–∞ –Ω–∞ ksk_report_header.id (FK —Å CASCADE DELETE) |
| 3 | created_datetime | TIMESTAMP NOT NULL | NOW() | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö |
| 4 | list_code | VARCHAR(100) | ‚Äî | –ö–æ–¥ —Å–ø–∏—Å–∫–∞ | –ö–æ–¥ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ |
| 5 | name_figurant | VARCHAR(200) | ‚Äî | –ò–º—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ | –ü–æ–ª–Ω–æ–µ –∏–º—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ |
| 6 | president_group | VARCHAR(200) | ‚Äî | –ü—Ä–µ–∑–∏–¥–µ–Ω—Ç—Å–∫–∞—è –≥—Ä—É–ø–ø–∞ | –¢–∏–ø –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç—Å–∫–æ–π –≥—Ä—É–ø–ø—ã |
| 7 | auto_login | VARCHAR(100) | ‚Äî | –ê–≤—Ç–æ–≤—Ö–æ–¥ | –ü—Ä–∏–∑–Ω–∞–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞ |
| 8 | exclusion_phrase | TEXT | ‚Äî | –§—Ä–∞–∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è | –§—Ä–∞–∑–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π |
| 9 | exclusion_name_list | VARCHAR(200) | ‚Äî | –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π | –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ñ–∏–≥—É—Ä–∞–Ω—Ç |
| 10 | total | INTEGER | ‚Äî | –í—Å–µ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π —Å —ç—Ç–∏–º —Ñ–∏–≥—É—Ä–∞–Ω—Ç–æ–º |
| 11 | total_allow | INTEGER | ‚Äî | –†–∞–∑—Ä–µ—à–µ–Ω–æ | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å resolution='allow' |
| 12 | total_review | INTEGER | ‚Äî | –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å resolution='review' |
| 13 | total_deny | INTEGER | ‚Äî | –û—Ç–∫–ª–æ–Ω–µ–Ω–æ | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å resolution='deny' |
| 14 | total_bypass | INTEGER | ‚Äî | –ò—Å–∫–ª—é—á–µ–Ω–æ –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å is_bypass='yes' |

#### –ò–Ω–¥–µ–∫—Å—ã (1 —à—Ç)

- `idx_ksk_report_figurants_data_report_header_id` ‚Äî B-tree –Ω–∞ (report_header_id) –¥–ª—è FK

---

## ‚öôÔ∏è –§–£–ù–ö–¶–ò–ò (25 —à—Ç)

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π

```
üìÇ –§—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –ö–°–ö (25 —à—Ç)
‚îÇ
‚îú‚îÄ‚îÄ üìÅ –†–ê–ë–û–¢–ê –° –î–ê–ù–ù–´–ú–ò (5 —à—Ç)
‚îÇ   ‚îú‚îÄ‚îÄ put_ksk_result() ‚Äî –≤—Å—Ç–∞–≤–∫–∞ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ üÜï put_ksk_result_batch() v3.0 ‚Äî –ø–∞–∫–µ—Ç–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ (–¥–æ 10K –∑–∞–ø–∏—Å–µ–π)
‚îÇ   ‚îú‚îÄ‚îÄ üÜï put_ksk_result_batch_optimized() ‚Äî –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ check_figurant_status() ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∑–æ–ª—é—Ü–∏–∏ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ check_transaction_status() ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∑–æ–ª—é—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
‚îÇ
‚îú‚îÄ‚îÄ üìÅ –ì–ï–ù–ï–†–ê–¶–ò–Ø –û–¢–ß–Å–¢–û–í (12 —à—Ç)
‚îÇ   ‚îú‚îÄ‚îÄ –û–†–ö–ï–°–¢–†–ê–¢–û–† (2 —à—Ç)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ksk_run_report() ‚Äî –∑–∞–ø—É—Å–∫ –ª—é–±–æ–≥–æ –æ—Ç—á—ë—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ksk_report_review() ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ –§–£–ù–ö–¶–ò–ò –û–¢–ß–Å–¢–û–í (10 —à—Ç)
‚îÇ       ‚îú‚îÄ‚îÄ 5 —Ñ—É–Ω–∫—Ü–∏–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (totals, list_totals, figurants, –∏ –¥—Ä.)
‚îÇ       ‚îî‚îÄ‚îÄ 5 —Ñ—É–Ω–∫—Ü–∏–π –ø–æ–ª—É—á–µ–Ω–∏—è (get_*_data)
‚îÇ
‚îú‚îÄ‚îÄ üìÅ –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–ï (6 —à—Ç)
‚îÇ   ‚îú‚îÄ‚îÄ ksk_create_partitions() ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ ksk_cleanup_empty_records() ‚Äî –æ—á–∏—Å—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –∑–∞–ø–∏—Å–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ ksk_cleanup_old_logs() ‚Äî –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ ksk_cleanup_empty_partitions() ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ ksk_monitor_table_bloat() ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–∑–¥—É–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
‚îÇ   ‚îî‚îÄ‚îÄ ksk_log_operation() ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
‚îÇ
‚îî‚îÄ‚îÄ üìÅ –£–¢–ò–õ–ò–¢–´ (2 —à—Ç)
    ‚îú‚îÄ‚îÄ add_column_if_not_exists() ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏
    ‚îî‚îÄ‚îÄ jsonb_object_length() ‚Äî –ø–æ–¥—Å—á—ë—Ç –ø–æ–ª–µ–π –≤ JSONB
```

---

### üìÅ –†–ê–ë–û–¢–ê –° –î–ê–ù–ù–´–ú–ò (5 —à—Ç)

#### 1. put_ksk_result()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í—Å—Ç–∞–≤–∫–∞ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ ksk_result

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (8 —à—Ç):**
- `p_input_timestamp` TIMESTAMP
- `p_output_timestamp` TIMESTAMP
- `p_input_json` JSONB
- `p_output_json` JSONB
- `p_input_kafka_partition` INTEGER
- `p_input_kafka_offset` BIGINT
- `p_input_kafka_headers` JSONB
- `p_output_kafka_headers` JSONB

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `INTEGER` ‚Äî ID –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏ (ksk_result.id)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑ JSON (corrId, paymentType, resolution, –∏ —Ç.–¥.)
- –í—ã–∑—ã–≤–∞–µ—Ç check_transaction_status() –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è resolution
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ñ–∏–≥—É—Ä–∞–Ω—Ç–æ–≤ –∏–∑ searchCheckResultKCKH[] –∏ –≤—Å—Ç–∞–≤–ª—è–µ—Ç –≤ ksk_figurant
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç matches[] –∏ –≤—Å—Ç–∞–≤–ª—è–µ—Ç –≤ ksk_figurant_match
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ ksk_result_error
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ~200-250 rec/s (single insert)

---

#### 2. üÜï put_ksk_result_batch() v3.0

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–∞–∫–µ—Ç–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `p_batch` JSONB ‚Äî –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ –º–∞—Å—Å–∏–≤–∞ (snake_case):**
```json
{
  "input_timestamp": "2025-10-31T10:00:00.123",
  "output_timestamp": "2025-10-31T10:00:00.456",
  "input_json": {...},
  "output_json": {...},
  "input_kafka_partition": 1,
  "input_kafka_offset": 12345,
  "input_kafka_headers": {...},
  "output_kafka_headers": {...}
}
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** TABLE
- `total_records` INTEGER ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ –±–∞—Ç—á–µ
- `success_count` INTEGER ‚Äî —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
- `error_count` INTEGER ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- `error_ids` INTEGER[] ‚Äî –º–∞—Å—Å–∏–≤ –∏–Ω–¥–µ–∫—Å–æ–≤ –∑–∞–ø–∏—Å–µ–π —Å –æ—à–∏–±–∫–∞–º–∏ (1-based)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ v3.0:**
- BEGIN/EXCEPTION –±–ª–æ–∫ –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ (–Ω–µ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –≤–µ—Å—å –±–∞—Ç—á)
- –°–±–æ—Ä error_ids –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ ~3300 rec/s
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–∞—Ç—á–∏ –¥–æ 10000 –∑–∞–ø–∏—Å–µ–π –±–µ–∑ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏

---

#### 3. üÜï put_ksk_result_batch_optimized()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø–∞–∫–µ—Ç–Ω–æ–π –≤—Å—Ç–∞–≤–∫–∏ (—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è)

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ put_ksk_result_batch()

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ put_ksk_result_batch()

**–û—Ç–ª–∏—á–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç bulk INSERT –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ú–µ–Ω–µ–µ –¥–µ—Ç–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è batch-–∑–∞–≥—Ä—É–∑–æ–∫ —Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

---

#### 4. check_figurant_status()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∑–æ–ª—é—Ü–∏–∏ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–∞—Ç—Ä–∏—Ü—ã —Ä–µ—à–µ–Ω–∏–π

**–ü–∞—Ä–∞–º–µ—Ç—Ä:**
- `p_figurant` JSONB ‚Äî –ø–æ–ª–Ω—ã–π JSON —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `VARCHAR(20)` ‚Äî —Ä–µ–∑–æ–ª—é—Ü–∏—è: `allow` / `review` / `deny`

**–ú–∞—Ç—Ä–∏—Ü–∞ —Ä–µ—à–µ–Ω–∏–π:**

| president_group | auto_login | has_exclusion | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------------|------------|---------------|-----------|
| `full` | –ª—é–±–æ–µ | –ª—é–±–æ–µ | `deny` |
| `part` | `false` | –ª—é–±–æ–µ | `review` |
| `part` | `true` | `false` | `review` |
| `part` | `true` | `true` | `allow` |
| `none` | –ª—é–±–æ–µ | `false` | `review` |
| `none` | –ª—é–±–æ–µ | `true` | `allow` |

---

#### 5. check_transaction_status()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∑–æ–ª—é—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–æ–≤

**–ü–∞—Ä–∞–º–µ—Ç—Ä:**
- `p_figurants` JSONB ‚Äî –º–∞—Å—Å–∏–≤ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–æ–≤

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `VARCHAR(20)` ‚Äî —Ä–µ–∑–æ–ª—é—Ü–∏—è: `allow` / `review` / `deny` / `empty`

**–ê–ª–≥–æ—Ä–∏—Ç–º –∞–≥—Ä–µ–≥–∞—Ü–∏–∏:**
1. –ï—Å–ª–∏ –º–∞—Å—Å–∏–≤ –ø—É—Å—Ç ‚Üí `empty`
2. –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ñ–∏–≥—É—Ä–∞–Ω—Ç `deny` (–∏ is_bypass='no') ‚Üí `deny`
3. –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ñ–∏–≥—É—Ä–∞–Ω—Ç `review` (–∏ is_bypass='no') ‚Üí `review`
4. –ï—Å–ª–∏ –≤—Å–µ —Ñ–∏–≥—É—Ä–∞–Ω—Ç—ã `allow` (–∏–ª–∏ is_bypass='yes') ‚Üí `allow`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** `deny` > `review` > `allow` > `empty`

---

### üìÅ –ì–ï–ù–ï–†–ê–¶–ò–Ø –û–¢–ß–Å–¢–û–í (12 —à—Ç)

#### –û–†–ö–ï–°–¢–†–ê–¢–û–† (2 —à—Ç)

##### 6. ksk_run_report()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –ª—é–±–æ–≥–æ —Ç–∏–ø–∞ –æ—Ç—á—ë—Ç–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (6 —à—Ç):**
- `p_report_code` VARCHAR ‚Äî –∫–æ–¥ –æ—Ç—á—ë—Ç–∞ –∏–∑ orchestrator (`totals`, `list_totals`, `figurants`, –∏ —Ç.–¥.)
- `p_initiator` VARCHAR ‚Äî `'system'` –∏–ª–∏ `'user'`
- `p_user_login` VARCHAR ‚Äî –ª–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (NULL –¥–ª—è system)
- `p_start_date` DATE DEFAULT CURRENT_DATE ‚Äî –Ω–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞
- `p_end_date` DATE ‚Äî –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ (NULL = p_start_date)
- `p_parameters` JSONB ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–¥–ª—è figurants)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `INTEGER` ‚Äî ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞ (ksk_report_header.id)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –ß–∏—Ç–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑ ksk_report_orchestrator –ø–æ report_code
2. –°–æ–∑–¥–∞—ë—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤ ksk_report_header
3. –í—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (report_function)
4. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ 'done' –∏–ª–∏ 'error'

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** p_parameters –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç—á—ë—Ç–∞ `figurants` (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ list_codes). –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å NULL.

---

##### 7. ksk_report_review()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–µ—Ç–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (resolution='review')

**–ü–∞—Ä–∞–º–µ—Ç—Ä:**
- `p_report_date` DATE DEFAULT CURRENT_DATE

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** TABLE (35 –ø–æ–ª–µ–π) ‚Äî —Å–º. –æ–ø–∏—Å–∞–Ω–∏–µ –≤ Part 1

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ù–ï –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è (VIEW-—Ñ—É–Ω–∫—Ü–∏—è)
- –ù–ï —Å–æ–∑–¥–∞—ë—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤ ksk_report_header
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é: `SELECT * FROM ksk_report_review('2025-10-22')`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏–∑ –¥–æ–º–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∫–æ–º–ø–ª–∞–µ–Ω—Å-–æ—Ñ–∏—Ü–µ—Ä–æ–≤

---

#### –§–£–ù–ö–¶–ò–ò –û–¢–ß–Å–¢–û–í (10 —à—Ç)

**üìã 5 —Ñ—É–Ω–∫—Ü–∏–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:**

##### 8. ksk_report_totals()
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: p_report_header_id, p_start_date, p_end_date
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: VOID
- –í—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ ksk_report_totals_data

##### 9. ksk_report_list_totals()
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: p_report_header_id, p_start_date, p_end_date
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: VOID
- –í—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ ksk_report_list_totals_data

##### 10. ksk_report_totals_by_payment_type()
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: p_report_header_id, p_start_date, p_end_date
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: VOID
- –í—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ ksk_report_totals_by_payment_type_data

##### 11. ksk_report_list_totals_by_payment_type()
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: p_report_header_id, p_start_date, p_end_date
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: VOID
- –í—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ ksk_report_list_totals_by_payment_type_data

##### 12. ksk_report_figurants()
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: p_report_header_id, p_start_date, p_end_date, p_parameters
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: VOID
- –í—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ ksk_report_figurants_data
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ list_codes —á–µ—Ä–µ–∑ p_parameters
- **‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –û–ë–ù–û–í–õ–ï–ù–ò–ï:** –î–æ–±–∞–≤–∏—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª—è `exclusion_name_list` ‚Äî —Å–º. MIGRATION_CHANGELOG_v3_8_1.md

---

**üìã 5 —Ñ—É–Ω–∫—Ü–∏–π –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:**

–≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ—Ç—á—ë—Ç–æ–≤.

##### 13-17. get_*_data()

- `ksk_get_totals_data(p_report_header_id)` ‚Üí TABLE
- `ksk_get_list_totals_data(p_report_header_id)` ‚Üí TABLE
- `ksk_get_totals_by_payment_type_data(p_report_header_id)` ‚Üí TABLE
- `ksk_get_list_totals_by_payment_type_data(p_report_header_id)` ‚Üí TABLE
- `ksk_get_figurants_data(p_report_header_id)` ‚Üí TABLE

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç `p_report_header_id` –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü—ã.

---

### üìÅ –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–ï (6 —à—Ç)

#### 18. ksk_create_partitions()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–π –¥–ª—è –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é –¥–∞—Ç—É

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `p_table_name` VARCHAR ‚Äî –∏–º—è —Ç–∞–±–ª–∏—Ü—ã (ksk_result, ksk_figurant, ksk_figurant_match)
- `p_date` DATE ‚Äî –¥–∞—Ç–∞ –ø–∞—Ä—Ç–∏—Ü–∏–∏

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** TABLE
- `partition_name` VARCHAR ‚Äî –∏–º—è —Å–æ–∑–¥–∞–Ω–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏
- `created_at` TIMESTAMP ‚Äî –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –°–æ–∑–¥–∞—ë—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏ —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏: **FROM 'YYYY-MM-DD 00:00:00' TO 'YYYY-MM-DD 00:00:00' + 1 day**
- –ü–µ—Ä–∏–æ–¥ –ø–∞—Ä—Ç–∏—Ü–∏–∏: **1 –î–ï–ù–¨ (24 —á–∞—Å–∞)**
- **TO ‚Äî –≠–ö–°–ö–õ–Æ–ó–ò–í–ù–ê–Ø –≥—Ä–∞–Ω–∏—Ü–∞** (–ø–∞—Ä—Ç–∏—Ü–∏—è –ù–ï –≤–∫–ª—é—á–∞–µ—Ç TO, –≤–∫–ª—é—á–∞–µ—Ç FROM)

---

#### 19. ksk_create_partitions_for_all_tables()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–π –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –Ω–∞ N –¥–Ω–µ–π –≤–ø–µ—Ä—ë–¥

**–ü–∞—Ä–∞–º–µ—Ç—Ä:**
- `p_days_ahead` INTEGER DEFAULT 7 ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤–ø–µ—Ä—ë–¥

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** VOID

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –í—ã–∑—ã–≤–∞–µ—Ç ksk_create_partitions() –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ CRON –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞—Ä—Ç–∏—Ü–∏–π

---

#### 20. ksk_cleanup_empty_records()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π —Å resolution='empty' —Å—Ç–∞—Ä—à–µ N –¥–Ω–µ–π

**–ü–∞—Ä–∞–º–µ—Ç—Ä:**
- `p_days_old` INTEGER DEFAULT 14 ‚Äî –≤–æ–∑—Ä–∞—Å—Ç –∑–∞–ø–∏—Å–µ–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** TABLE
- `deleted` INTEGER ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
- `dropped` INTEGER ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π
- `time` INTERVAL ‚Äî –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –£–¥–∞–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏ —Å resolution='empty' (–Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π)
- –£–¥–∞–ª—è–µ—Ç –ø—É—Å—Ç—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏
- –õ–æ–≥–∏—Ä—É–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –≤ ksk_system_operations_log

---

#### 21. ksk_cleanup_empty_partitions()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `p_table_name` VARCHAR ‚Äî –∏–º—è —Ç–∞–±–ª–∏—Ü—ã ('ksk_result', 'ksk_figurant', 'all')
- `p_days_old` INTEGER DEFAULT 14 ‚Äî –≤–æ–∑—Ä–∞—Å—Ç –ø–∞—Ä—Ç–∏—Ü–∏–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** TABLE
- `log_id` INTEGER ‚Äî ID –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥–µ
- `deleted` INTEGER ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π
- `time` INTERVAL ‚Äî –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

#### 22. ksk_cleanup_old_logs()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π –∏–∑ ksk_system_operations_log

**–ü–∞—Ä–∞–º–µ—Ç—Ä:**
- `p_days_old` INTEGER DEFAULT 365 ‚Äî –≤–æ–∑—Ä–∞—Å—Ç –ª–æ–≥–æ–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** TABLE
- `deleted_count` INTEGER ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
- `execution_time` INTERVAL ‚Äî –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

#### 23. ksk_monitor_table_bloat()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–∑–¥—É–≤–∞–Ω–∏—è (bloat) —Ç–∞–±–ª–∏—Ü

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** –ù–µ—Ç

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** TABLE
- `schema` VARCHAR ‚Äî –∏–º—è —Å—Ö–µ–º—ã
- `table` VARCHAR ‚Äî –∏–º—è —Ç–∞–±–ª–∏—Ü—ã
- `bloat_pct` NUMERIC ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç bloat
- `bloat_mb` NUMERIC ‚Äî —Ä–∞–∑–º–µ—Ä bloat –≤ –ú–ë

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –¥–æ–º–µ–Ω–Ω—ã–µ –∏ –æ—Ç—á—ë—Ç–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–Ω–Ω–µ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ CRON –µ–∂–µ–¥–Ω–µ–≤–Ω–æ

---

#### 24. ksk_log_operation()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `p_operation_code` VARCHAR ‚Äî –∫–æ–¥ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `p_operation_name` VARCHAR ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `p_status` VARCHAR ‚Äî —Å—Ç–∞—Ç—É—Å ('success' –∏–ª–∏ 'error')
- `p_info` TEXT ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `p_err_msg` TEXT ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `INTEGER` ‚Äî ID –∑–∞–ø–∏—Å–∏ –ª–æ–≥–∞

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç duration (end_time - begin_time)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å–µ–º–∏ maintenance —Ñ—É–Ω–∫—Ü–∏—è–º–∏

---

### üìÅ –£–¢–ò–õ–ò–¢–´ (2 —à—Ç)

#### 25. add_column_if_not_exists()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É (–¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π)

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `p_table_name` VARCHAR ‚Äî –∏–º—è —Ç–∞–±–ª–∏—Ü—ã
- `p_column_name` VARCHAR ‚Äî –∏–º—è –∫–æ–ª–æ–Ω–∫–∏
- `p_column_type` VARCHAR ‚Äî —Ç–∏–ø –∫–æ–ª–æ–Ω–∫–∏
- `p_default_value` VARCHAR ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** BOOLEAN ‚Äî TRUE, –µ—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ –±—ã–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞

---

#### 26. jsonb_object_length()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–¥—Å—á—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª–µ–π –≤ JSONB –æ–±—ä–µ–∫—Ç–µ

**–ü–∞—Ä–∞–º–µ—Ç—Ä:**
- `p_json` JSONB ‚Äî JSON –æ–±—ä–µ–∫—Ç

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** INTEGER ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–π –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è

---

## üß™ –¢–ï–°–¢–û–í–´–ï –§–£–ù–ö–¶–ò–ò (5 —à—Ç)

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** –í—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `ksk_test_` –¥–ª—è –æ—Ç–ª–∏—á–∏—è –æ—Ç –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

```
üìÇ –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ö–°–ö (5 —à—Ç)
‚îÇ
‚îú‚îÄ‚îÄ üìÅ –ì–ï–ù–ï–†–ê–¶–ò–Ø –î–ê–ù–ù–´–• (1 —à—Ç)
‚îÇ   ‚îî‚îÄ‚îÄ ksk_test_generate_data_messages() ‚Üí TABLE (input_json, output_json)
‚îÇ
‚îú‚îÄ‚îÄ üìÅ –¢–ï–°–¢–´ –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò SINGLE (2 —à—Ç)
‚îÇ   ‚îú‚îÄ‚îÄ ksk_test_put_ksk_result_speed_test() ‚Üí TABLE (5 –º–µ—Ç—Ä–∏–∫)
‚îÇ   ‚îî‚îÄ‚îÄ ksk_test_put_ksk_result_performance_test() ‚Üí TABLE (7 –º–µ—Ç—Ä–∏–∫)
‚îÇ
‚îî‚îÄ‚îÄ üìÅ –¢–ï–°–¢–´ –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò BATCH (2 —à—Ç)
    ‚îú‚îÄ‚îÄ ksk_test_put_ksk_result_batch_speed_test() ‚Üí TABLE (metric, value)
    ‚îî‚îÄ‚îÄ ksk_test_put_ksk_result_batch_performance_test() ‚Üí TABLE (metric, value)
```

---

### 1. ksk_test_generate_data_messages()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã—Ö –ø–∞—Ä JSON (input + output) –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** –ù–µ—Ç

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** TABLE
- `input_json` JSONB ‚Äî –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ Kafka
- `output_json` JSONB ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ö–°–ö

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- VOLATILE —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: 70% –±–µ–∑ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π, 20% —Å 1 —Ñ–∏–≥—É—Ä–∞–Ω—Ç–æ–º, 10% —Å 2-4 —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞–º–∏
- –£ –≤—Å–µ—Ö —Ñ–∏–≥—É—Ä–∞–Ω—Ç–æ–≤ –í–°–ï–ì–î–ê –µ—Å—Ç—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (99% ‚Üí 1 match, 1% ‚Üí 2-4 matches)
- –û–¥–∏–Ω–∞–∫–æ–≤—ã–π corrId –≤ input –∏ output –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏–∑ production

---

### 2. ksk_test_put_ksk_result_speed_test()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¢–µ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ put_ksk_result –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–∞–ø–∏—Å–µ–π

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `p_count` INTEGER DEFAULT 1000 ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è —Ç–µ—Å—Ç–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** TABLE
- `total_count` BIGINT ‚Äî –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞–ø–∏—Å–µ–π
- `elapsed_seconds` NUMERIC ‚Äî –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (—Å–µ–∫—É–Ω–¥—ã)
- `records_per_second` NUMERIC ‚Äî –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (rec/s)
- `figurants_inserted` BIGINT ‚Äî –≤—Å—Ç–∞–≤–ª–µ–Ω–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–æ–≤
- `matches_inserted` BIGINT ‚Äî –≤—Å—Ç–∞–≤–ª–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ—Ç—á—ë—Ç—ã –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ —á–µ—Ä–µ–∑ RAISE NOTICE
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ksk_test_generate_data_messages() –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ Kafka headers —Å –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏ –∏ offset
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

---

### 3. ksk_test_put_ksk_result_performance_test()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¢–µ—Å—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ put_ksk_result –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `p_duration_seconds` INTEGER DEFAULT 60 ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** TABLE
- `total_count` BIGINT ‚Äî –≤—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞–ø–∏—Å–µ–π
- `elapsed_seconds` NUMERIC ‚Äî —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `records_per_second` NUMERIC ‚Äî —Å—Ä–µ–¥–Ω—è—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- `max_records_per_10sec` BIGINT ‚Äî –º–∞–∫—Å–∏–º—É–º –∑–∞–ø–∏—Å–µ–π –∑–∞ 10 —Å–µ–∫—É–Ω–¥
- `min_records_per_10sec` BIGINT ‚Äî –º–∏–Ω–∏–º—É–º –∑–∞–ø–∏—Å–µ–π –∑–∞ 10 —Å–µ–∫—É–Ω–¥
- `figurants_inserted` BIGINT ‚Äî –≤—Å—Ç–∞–≤–ª–µ–Ω–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–æ–≤
- `matches_inserted` BIGINT ‚Äî –≤—Å—Ç–∞–≤–ª–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –í—Å—Ç–∞–≤–ª—è–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –∑–∞ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
- –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ—Ç—á—ë—Ç—ã –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã

---

### 4. ksk_test_put_ksk_result_batch_speed_test()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¢–µ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ put_ksk_result_batch –¥–ª—è –æ–¥–Ω–æ–≥–æ –±–∞—Ç—á–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `p_batch_size` INTEGER DEFAULT 100 ‚Äî —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** TABLE (metric TEXT, value TEXT)

**–ú–µ—Ç—Ä–∏–∫–∏ –≤–∫–ª—é—á–∞—é—Ç:**
- TEST_ID ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–µ—Å—Ç–∞
- TEST_TIMESTAMP ‚Äî –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–∞
- BATCH_SIZE ‚Äî —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞
- TOTAL_RECORDS ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ –±–∞—Ç—á–µ
- SUCCESS_COUNT ‚Äî —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
- ERROR_COUNT ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- DURATION_MS ‚Äî –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
- RECORDS_PER_SEC ‚Äî –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (rec/s)
- MS_PER_RECORD ‚Äî –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥ –Ω–∞ –æ–¥–Ω—É –∑–∞–ø–∏—Å—å
- INSERTED_KSK_RESULT ‚Äî –≤—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ ksk_result
- INSERTED_KSK_FIGURANT ‚Äî –≤—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ ksk_figurant
- INSERTED_KSK_MATCH ‚Äî –≤—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ ksk_figurant_match
- VERDICT ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞ (‚úÖ PASS / ‚ö†Ô∏è WARNING / ‚ùå FAIL)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –°–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å put_ksk_result_batch v3.0
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç snake_case –≤ JSON –ø–æ–ª—è—Ö (input_timestamp, output_json –∏ —Ç.–¥.)
- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å—Ç–∞–≤–∫–∞–º –≤ –∫–∞–∂–¥—É—é —Ç–∞–±–ª–∏—Ü—É
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (VERDICT)

---

### 5. ksk_test_put_ksk_result_batch_performance_test()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ put_ksk_result_batch (throughput test)

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `p_test_duration` INTERVAL DEFAULT '00:00:30' ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞
- `p_batch_size` INTEGER DEFAULT 100 ‚Äî —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** TABLE (metric TEXT, value TEXT)

**–ú–µ—Ç—Ä–∏–∫–∏ –≤–∫–ª—é—á–∞—é—Ç:**
- TEST_ID ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–µ—Å—Ç–∞
- TEST_TYPE ‚Äî —Ç–∏–ø —Ç–µ—Å—Ç–∞ (BATCH_THROUGHPUT)
- TARGET_DURATION ‚Äî –∑–∞–¥–∞–Ω–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ACTUAL_DURATION ‚Äî —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- TOTAL_BATCHES ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –±–∞—Ç—á–µ–π
- TOTAL_RECORDS ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
- TOTAL_SUCCESS ‚Äî —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
- TOTAL_ERRORS ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- THROUGHPUT_RECORDS/SEC ‚Äî –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å (rec/s)
- THROUGHPUT_BATCHES/SEC ‚Äî –±–∞—Ç—á–µ–π –≤ —Å–µ–∫—É–Ω–¥—É
- MIN_BATCH_DURATION_MS ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –±–∞—Ç—á–∞
- MAX_BATCH_DURATION_MS ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –±–∞—Ç—á–∞
- AVG_BATCH_DURATION_MS ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –±–∞—Ç—á–∞
- VERDICT ‚Äî –æ—Ü–µ–Ω–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ –±–∞—Ç—á–µ–π –≤ —Ç–µ—á–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- –ü—Ä–æ–≥—Ä–µ—Å—Å-—Ä–µ–ø–æ—Ä—Ç—ã –∫–∞–∂–¥—ã–µ 10 –∏—Ç–µ—Ä–∞—Ü–∏–π
- –†–∞—Å—á—ë—Ç throughput –º–µ—Ç—Ä–∏–∫
- –û—Ü–µ–Ω–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## ‚è∞ –†–ï–ì–£–õ–Ø–†–ù–´–ï –ó–ê–î–ê–ß–ò (CRON)

**‚ö†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ PostgreSQL `pg_cron` (—Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞)

### –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á (10 –∑–∞–¥–∞—á, 8 –∞–∫—Ç–∏–≤–Ω—ã—Ö + 2 –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö)

| # | –í—Ä–µ–º—è | –ó–∞–¥–∞—á–∞ | –§—É–Ω–∫—Ü–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|---|-------|--------|---------|------------|--------|
| 1 | 00:30 | ANALYZE –ø–∞—Ä—Ç–∏—Ü–∏–π –≤—á–µ—Ä–∞—à–Ω–µ–≥–æ –¥–Ω—è | SQL-–±–ª–æ–∫ | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ | ‚è∏Ô∏è **–û–¢–õ–û–ñ–ï–ù–û** |
| 2 | 01:00 | –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–π –Ω–∞ 7 –¥–Ω–µ–π –≤–ø–µ—Ä—ë–¥ | ksk_create_partitions_for_all_tables() | –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (—Å—É—Ç–æ—á–Ω—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏) | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| 3 | 01:30 | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤ | ksk_run_report() | –°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö 5 –æ—Ç—á—ë—Ç–æ–≤ –∑–∞ –≤—á–µ—Ä–∞ | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| 4 | 02:00 | –£–¥–∞–ª–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–π —Å—Ç–∞—Ä—à–µ 365 –¥–Ω–µ–π | ksk_drop_old_partitions(365) | –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –º–µ—Å—Ç–∞ | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| 5 | 03:00 | –£–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –∑–∞–ø–∏—Å–µ–π (14 –¥–Ω–µ–π) | ksk_cleanup_empty_records(14) | –û—á–∏—Å—Ç–∫–∞ resolution='empty' | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| 6 | 03:30 | –£–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π (14 –¥–Ω–µ–π) | ksk_cleanup_empty_partitions('all', 14) | –û—á–∏—Å—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| 7 | 04:00 | –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –æ—Ç—á—ë—Ç–æ–≤ (TTL) | ksk_cleanup_old_reports() | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–∞–º–∏ –ø–æ TTL | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| 8 | 04:30 | –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤ (365 –¥–Ω–µ–π) | ksk_cleanup_old_logs(365) | –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| 9 | 05:00 | VACUUM ANALYZE –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü | SQL-–±–ª–æ–∫ | –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –º–µ—Å—Ç–∞, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ | ‚è∏Ô∏è **–û–¢–õ–û–ñ–ï–ù–û** |
| 10 | 04:00 (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ) | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ bloat —Ç–∞–±–ª–∏—Ü | ksk_monitor_table_bloat() | –†–∞–Ω–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |

**‚ö†Ô∏è –°—Ç–∞—Ç—É—Å –û–¢–õ–û–ñ–ï–ù–û:** –ó–∞–¥–∞—á–∏ #1 –∏ #9 –æ—Ç–ª–æ–∂–µ–Ω—ã –¥–æ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

---

## üìä –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –°–ò–°–¢–ï–ú–´

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è put_ksk_result_batch v3.0

**–¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- PostgreSQL 16
- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –¥–Ω—è–º (PARTITION BY RANGE)
- BEGIN/EXCEPTION –±–ª–æ–∫ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- –¢–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä: 8 CPU, 32GB RAM, SSD

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

| Batch Size | Throughput (rec/s) | –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –±–∞—Ç—á–∞ (–º—Å) | –î–µ–≥—Ä–∞–¥–∞—Ü–∏—è | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------|-------------------|------------------------|------------|-------------|
| 100 | 2564.10 | ~39 | baseline | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å |
| 500 | 3141.40 | ~159 | +22.5% | –•–æ—Ä–æ—à–∞—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å |
| **1000** | **3346.10** | ~299 | **+30.5%** | **–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä** |
| 2000 | 3279.39 | ~610 | +27.9% | –ù–∞—á–∞–ª–æ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ |
| 5000 | 3216.60 | ~1554 | +25.4% | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è (-3.9% –æ—Ç –ø–∏–∫–∞) |
| 10000 | 3195.60 | ~3129 | +24.6% | –í—Å–µ–≥–æ -4.5% –æ—Ç –ø–∏–∫–∞ |

**–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã:**

1. **–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π batch_size:** 1000-2000 –∑–∞–ø–∏—Å–µ–π
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 3346 rec/s –ø—Ä–∏ batch_size=1000
   - –ü—Ä–∏–µ–º–ª–µ–º–∞—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: ~300–º—Å –¥–ª—è –±–∞—Ç—á–∞ –∏–∑ 1000 –∑–∞–ø–∏—Å–µ–π

2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –û—Ç–ª–∏—á–Ω–∞—è
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è –¥–∞–∂–µ –ø—Ä–∏ 10K –∑–∞–ø–∏—Å–µ–π (–≤—Å–µ–≥–æ -4.5%)
   - –õ–∏–Ω–µ–π–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ 1000 –∑–∞–ø–∏—Å–µ–π
   - –°—Ç–∞–±–∏–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –±–æ–ª—å—à–∏—Ö –±–∞—Ç—á–∞—Ö

3. **–ü—Ä–æ–≥–Ω–æ–∑ –¥–ª—è production:**
   - –° –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö: ~3300 rec/s
   - –ë–µ–∑ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ): ~4000 rec/s –æ–∂–∏–¥–∞–µ—Ç—Å—è
   - –ü—Ä–∏ 3 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö consumer: ~10000-12000 rec/s –æ–±—â–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è production:**

1. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ–∂–∏–º:** batch_size = 1000
   - –ë–∞–ª–∞–Ω—Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
   - –û–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è Kafka consumer —Å auto-commit

2. **Low-latency —Ä–µ–∂–∏–º:** batch_size = 500
   - –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å < 200ms
   - –î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∫ –∑–∞–¥–µ—Ä–∂–∫–∞–º —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

3. **High-throughput —Ä–µ–∂–∏–º:** batch_size = 2000-5000
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
   - –î–ª—è batch-–æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –Ω–æ—á–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ single vs batch

| –ú–µ—Ç–æ–¥ | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –Ω–∞ –∑–∞–ø–∏—Å—å | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|-------|-------------------|----------------------|---------------|
| put_ksk_result (single) | ~200 rec/s | 5ms | –ï–¥–∏–Ω–∏—á–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, real-time |
| put_ksk_result_batch (1000) | ~3300 rec/s | 0.3ms | –ú–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞, Kafka consumer |
| –£–ª—É—á—à–µ–Ω–∏–µ | **16.5x** | **16.7x –±—ã—Å—Ç—Ä–µ–µ** | ‚Äî |

---

## üìù –ò–°–¢–û–†–ò–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô

### –í–µ—Ä—Å–∏—è 3.8.1 CORRECTED (31.10.2025 17:46 MSK)

**üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:**

1. ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û: ksk_report_figurants_data ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–µ–π**
   - **–ë–´–õ–û:** –ó–∞–≥–æ–ª–æ–≤–æ–∫ —É–∫–∞–∑—ã–≤–∞–ª "13 –ø–æ–ª–µ–π"
   - **–°–¢–ê–õ–û:** –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ–±–Ω–æ–≤–ª—ë–Ω –Ω–∞ "14 –ø–æ–ª–µ–π"
   - **–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ª–µ exclusion_name_list (‚Ññ9) —É–∂–µ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ v3.8, –Ω–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–µ –æ–±–Ω–æ–≤–∏–ª–∏

2. ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û: –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–µ–π**
   - **–ë–´–õ–û:** –°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É–∫–∞–∑—ã–≤–∞–ª–∞ 220 –ø–æ–ª–µ–π
   - **–°–¢–ê–õ–û:** –û–±–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ 221 –ø–æ–ª–µ
   - **–î–µ—Ç–∞–ª–∏:** 
     - –û—Ç—á—ë—Ç–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã: 137 ‚Üí 139 –ø–æ–ª–µ–π
     - –ò—Ç–æ–≥–æ: 220 ‚Üí 221 –ø–æ–ª–µ

3. ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û: –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π v3.8**
   - **–ë–´–õ–û:** "–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–µ–π: 219 ‚Üí 220"
   - **–°–¢–ê–õ–û:** "–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–µ–π: 219 ‚Üí 221"

4. ‚ö†Ô∏è **–î–û–ë–ê–í–õ–ï–ù CHANGELOG –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–ê**
   - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª: MIGRATION_CHANGELOG_v3_8_1.md
   - –°–æ–¥–µ—Ä–∂–∏—Ç SQL –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—è exclusion_name_list
   - –°–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é —Ñ—É–Ω–∫—Ü–∏–∏ ksk_report_figurants()
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –ü–æ–ª–µ `exclusion_name_list` –æ–ø–∏—Å–∞–Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ v3.8, –Ω–æ **–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î**. –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∏–∑ MIGRATION_CHANGELOG_v3_8_1.md!

---

### –í–µ—Ä—Å–∏—è 3.8 FINAL (31.10.2025 14:00 MSK)

**üìã –û–ë–ù–û–í–õ–ï–ù–ò–ï –¢–ï–†–ú–ò–ù–û–õ–û–ì–ò–ò –ü–û –¢–†–ï–ë–û–í–ê–ù–ò–Æ –ë–ò–ó–ù–ï–°–ê**

**–ò–∑–º–µ–Ω–µ–Ω–æ:**

1. ‚úÖ **–û–ë–ù–û–í–õ–ï–ù–ò–ï –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ï–í –ö –ü–û–õ–Ø–ú**
   - **ksk_result.has_bypass:** "–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞" ‚Üí "–ò—Å–∫–ª—é—á–µ–Ω–∞ –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è"
   - **ksk_figurant.is_bypass:** "–ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞" ‚Üí "–ò—Å–∫–ª—é—á–µ–Ω –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è"
   - **ksk_report_totals_data:**
     - total: "–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ" ‚Üí "–í—Å–µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π"
     - total_without_result: "–í—Å–µ–≥–æ –±–µ–∑ —Å—Ä–∞–±–æ—Ç–æ–∫" ‚Üí "–ù–µ —Å–æ–≤–ø–∞–ª–æ —Å –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ –î–û–ü–ë"
     - total_with_result: "–í—Å–µ–≥–æ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º" ‚Üí "–°–æ–≤–ø–∞–ª–æ —Å –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ –î–û–ü–ë"
     - total_bypass: "–° –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏" ‚Üí "–ò—Å–∫–ª—é—á–µ–Ω–æ –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è"
   - **–í—Å–µ –æ—Ç—á–µ—Ç–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:** –ü–æ–ª—è *_bypass: "–° –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏" ‚Üí "–ò—Å–∫–ª—é—á–µ–Ω–æ –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è"

2. ‚úÖ **–û–ë–ù–û–í–õ–ï–ù–ò–ï –ù–ê–ó–í–ê–ù–ò–ô –û–¢–ß–ï–¢–û–í**
   - **totals_by_payment_type:** "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π" ‚Üí "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π (–ø–æ—Ç–æ–∫–∏)"
   - **list_totals_by_payment_type:** "–ò—Ç–æ–≥–∏ –ø–æ —Å–ø–∏—Å–∫–∞–º –∏ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π" ‚Üí "–°–ø–∏—Å–∫–∏ –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π (–ø–æ—Ç–æ–∫–∏)"

3. ‚úÖ **–î–û–ë–ê–í–õ–ï–ù–ò–ï –ù–û–í–û–ì–û –ü–û–õ–Ø**
   - **ksk_report_figurants_data.exclusion_name_list** VARCHAR(200) ‚Äî "–ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π"
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è ksk_report_figurants() –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è
   - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–µ–π: 219 ‚Üí 221

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** –§–∏–∑–∏—á–µ—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π –≤ –ë–î –ù–ï –∏–∑–º–µ–Ω–∏–ª–∏—Å—å. –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è (COMMENT ON COLUMN).

---

### –í–µ—Ä—Å–∏—è 3.7 FINAL (31.10.2025 01:42 MSK)

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï:**

–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ç–µ–ø–µ—Ä—å —è–≤–ª—è–µ—Ç—Å—è **–ï–î–ò–ù–´–ú –ò–°–¢–û–ß–ù–ò–ö–û–ú –ò–°–¢–ò–ù–´ (Single Source of Truth)** –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞!

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**

1. ‚úÖ **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –î–û–ü–û–õ–ù–ï–ù–ò–ï: –ü–µ—Ä–∏–æ–¥ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**
   - **–ü–µ—Ä–∏–æ–¥ –ø–∞—Ä—Ç–∏—Ü–∏–∏:** 1 –î–ï–ù–¨ (24 —á–∞—Å–∞)
   - **–ì—Ä–∞–Ω–∏—Ü—ã –ø–∞—Ä—Ç–∏—Ü–∏–∏:** FROM 'YYYY-MM-DD 00:00:00' TO 'YYYY-MM-DD 00:00:00' + 1 day
   - **‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û:** TO ‚Äî –≠–ö–°–ö–õ–Æ–ó–ò–í–ù–ê–Ø –≥—Ä–∞–Ω–∏—Ü–∞! –ü–∞—Ä—Ç–∏—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç [FROM, TO)

2. ‚úÖ **–§–£–ù–ö–¶–ò–Ø –°–û–ó–î–ê–ù–ò–Ø –ü–ê–†–¢–ò–¶–ò–ô:** –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ ksk_create_partitions()

3. ‚úÖ **–°–ï–ö–¶–ò–Ø "–ü–û–ß–ï–ú–£ TIMESTAMP, –ê –ù–ï DATE?"** –≤ —Ä–∞–∑–¥–µ–ª–µ "–î–æ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã"

4. ‚úÖ **–û–ë–ù–û–í–õ–ï–ù–ò–ï CRON:** –£—Ç–æ—á–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ #2 ‚Äî "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (—Å—É—Ç–æ—á–Ω—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏)"

5. ‚úÖ **–†–ê–ó–î–ï–õ "‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û"** –≤ –Ω–∞—á–∞–ª–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞

---

### –í–µ—Ä—Å–∏—è 3.6 FINAL (31.10.2025 01:22 MSK)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

1. ‚úÖ **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - **–ë–´–õ–û (v3.5):** "–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: PARTITION BY RANGE (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ–µ)"
   - **–°–¢–ê–õ–û (v3.6):** "–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: PARTITION BY RANGE –ø–æ **TIMESTAMP** (output_timestamp/timestamp)"

---

**–ö–æ–Ω–µ—Ü Part 2 ‚Äî –≠–¢–ê–õ–û–ù –°–ò–°–¢–ï–ú–´ –ö–°–ö v3.8.1 CORRECTED ‚úÖ**

**‚ö†Ô∏è –ü–†–ò –õ–Æ–ë–´–• –ò–ó–ú–ï–ù–ï–ù–ò–Ø–• –û–ë–ù–û–í–ò–¢–¨ –í–ï–†–°–ò–Æ –°–ü–†–ê–í–û–ß–ù–ò–ö–ê –ò –£–í–ï–î–û–ú–ò–¢–¨ –í–°–Æ –ö–û–ú–ê–ù–î–£!**

**üìå –í–ê–ñ–ù–û –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–û–í:** –ü–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ v3.8.1 –≤ production –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∏–∑ —Ñ–∞–π–ª–∞ MIGRATION_CHANGELOG_v3_8_1.md!