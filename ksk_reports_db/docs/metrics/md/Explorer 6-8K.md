┌─────────────────────────────────────────────────────────────────┐
│                         ЭТАП 1: РОУТИНГ                         │
│                    (один вызов LLM, ~2K токенов)                │
├─────────────────────────────────────────────────────────────────┤
│  Вход:                                                          │
│    - Вопрос: "Какие типы отчетов есть в системе?"               │
│    - Каталог объектов (компактный список имён)                  │
│                                                                 │
│  Выход:                                                         │
│    - mode: "explore" | "explain"                                │
│    - filter: "*report*"                                         │
│    - target: null (для explore) | "schema.object" (для explain) │
└─────────────────────────────────────────────────────────────────┘
                              │
              ┌───────────────┴───────────────┐
              ▼                               ▼
┌──────────────────────────┐    ┌──────────────────────────────────┐
│      EXPLAIN (простой)    │    │         EXPLORE (итеративный)    │
│    один вызов LLM         │    │      цикл по объектам            │
├──────────────────────────┤    ├──────────────────────────────────┤
│  Промпт Explain           │    │  Для каждого объекта по фильтру: │
│  + исходник объекта       │    │                                  │
│  → ответ пользователю     │    │  ┌─────────────────────────────┐ │
│                           │    │  │ Mini-Explain (один вызов):  │ │
│  ~3-4K токенов            │    │  │ - Объект подходит? да/нет   │ │
│  Влезает в 90% случаев    │    │  │ - Если да: какие контексты? │ │
└──────────────────────────┘    │  └─────────────────────────────┘ │
                                │              │                    │
                                │              ▼                    │
                                │  findings[] += {obj, contexts}   │
                                │              │                    │
                                │              ▼                    │
                                │  ┌─────────────────────────────┐ │
                                │  │ Финальная классификация:    │ │
                                │  │ - Список findings           │ │
                                │  │ - Группировка/ответ         │ │
                                │  └─────────────────────────────┘ │
                                └──────────────────────────────────┘
