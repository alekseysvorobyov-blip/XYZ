
# –ü–æ–µ—Ö–∞–ª–∏ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –æ—Ç—á–µ—Ç–∞–º

–ú–µ–Ω—é "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ"

–ü–æ–ø–∞–¥–∞–µ–º –Ω–∞ —Å–ø–∏—Å–æ–∫ –æ—Ç—á–µ—Ç–æ–≤ ksk_report_header
–¢–∞–±–ª–∏—Ü–∞ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–∞ —Ç–∞–∫ —á—Ç–æ –≤–∏–¥–∏–º —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã.

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–æ—Å—Ç—É–ø–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å"
–ü–æ –Ω–∞–∂–∞—Ç–∏—é –Ω–∞ –∫–Ω–æ–ø–∫—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞, —Ç–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–∏–ø –æ—Ç—á–µ—Ç–∞, –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç. –ù–∞–∂–∏–º–∞–µ—Ç —Å–æ–∑–¥–∞—Ç—å. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ ksk_report_header –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç—á–µ—Ç –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ.
UI —Ä–µ–≥—É–ª—è—Ä–Ω–æ –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç –±–∞–∫–µ–Ω–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç—á–µ—Ç–∞

–¢.–µ. –Ω–∞–º –Ω—É–∂–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ REST API

1. —Å–ø–∏—Å–æ–∫ –æ—Ç—á–µ—Ç–æ–≤
2. —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
3. –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
4. –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç—á–µ—Ç–∞

–í—ã–≤–µ–¥–∏ –≤ —Ç–æ–º –∂–µ –≤–∏–¥–µ. –ü—Ä–µ–¥–ª–æ–∂–∏ —É–ª—É—á—à–µ–Ω–∏—è.

–û—Ç–ª–∏—á–Ω–æ! –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î. –¢–µ–ø–µ—Ä—å —Å—Ñ–æ—Ä–º–∏—Ä—É—é REST API –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –æ—Ç—á–µ—Ç–æ–≤ —Å —É–ª—É—á—à–µ–Ω–∏—è–º–∏.

***

# REST API –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –æ—Ç—á–µ—Ç–æ–≤ –ö–°–ö

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 26 –æ–∫—Ç—è–±—Ä—è 2025, 20:48

***

## **–°–ü–ò–°–û–ö –§–£–ù–ö–¶–ò–ô API:**

1. `GET /api/reports/user?status=all&limit=50&offset=0` - —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –æ—Ç—á–µ—Ç–æ–≤
2. `POST /api/reports/user` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ—Ç—á–µ—Ç–∞
3. `DELETE /api/reports/user/{report_id}` - —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ—Ç—á–µ—Ç–∞
4. `GET /api/reports/user/{report_id}/status` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç—á–µ—Ç–∞
5. **‚ú® –£–õ–£–ß–®–ï–ù–ò–ï:** `GET /api/reports/user/types` - —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—Ç—á–µ—Ç–æ–≤
6. **‚ú® –£–õ–£–ß–®–ï–ù–ò–ï:** `GET /api/reports/user/{report_id}/data` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–æ–≥–æ –æ—Ç—á–µ—Ç–∞
7. **‚ú® –£–õ–£–ß–®–ï–ù–ò–ï:** `GET /api/reports/user/{report_id}/export/{format}` - —ç–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–∞

***

## **–§–£–ù–ö–¶–ò–Ø 1: –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –æ—Ç—á–µ—Ç–æ–≤**

### **REST API:**

```
GET /api/reports/user?status=all&limit=50&offset=0
```


### **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**

- `status` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): `all` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), `created`, `in_progress`, `done`, `error`
- `limit` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50, –º–∞–∫—Å–∏–º—É–º 100)
- `offset` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0)


### **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:**

- **–¢–∞–±–ª–∏—Ü–∞:** `ksk_report_header`
- **JOIN:** —Å `ksk_report_orchestrator`
- **–£—Å–ª–æ–≤–∏–µ:** WHERE `initiator = 'user'` AND `user_login = {current_user}`


### **–ü—Ä–∏–º–µ—Ä JSON –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "data": [
    {
      "id": 123,
      "report_code": "totals",
      "report_name": "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
      "status": "done",
      "created_datetime": "2025-10-25T14:30:00",
      "finished_datetime": "2025-10-25T14:30:45",
      "start_date": "2025-10-01",
      "end_date": "2025-10-25",
      "remove_date": "2025-11-08",
      "user_login": "ivanov",
      "parameters": {
        "list_codes": ["4200", "4204"]
      }
    },
    {
      "id": 124,
      "report_code": "figurants",
      "report_name": "–û—Ç—á—ë—Ç –ø–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞–º",
      "status": "in_progress",
      "created_datetime": "2025-10-26T10:15:00",
      "finished_datetime": null,
      "start_date": "2025-10-20",
      "end_date": "2025-10-26",
      "remove_date": "2025-11-02",
      "user_login": "ivanov",
      "parameters": null
    },
    {
      "id": 125,
      "report_code": "list_totals",
      "report_name": "–ò—Ç–æ–≥–∏ –ø–æ —Å–ø–∏—Å–∫–∞–º",
      "status": "error",
      "created_datetime": "2025-10-26T09:00:00",
      "finished_datetime": "2025-10-26T09:00:15",
      "start_date": "2025-10-15",
      "end_date": "2025-10-25",
      "remove_date": "2025-11-02",
      "user_login": "ivanov",
      "parameters": null
    }
  ],
  "pagination": {
    "total_records": 15,
    "limit": 50,
    "offset": 0,
    "has_more": false
  }
}
```


***

## **–§–£–ù–ö–¶–ò–Ø 2: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ—Ç—á–µ—Ç–∞**

### **REST API:**

```
POST /api/reports/user
```


### **–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**

```json
{
  "report_code": "figurants",
  "start_date": "2025-10-01",
  "end_date": "2025-10-25",
  "parameters": {
    "list_codes": ["4200", "4204", "2254"]
  }
}
```


### **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:**

- **–§—É–Ω–∫—Ü–∏—è:** `ksk_report_create()`
- **–î–µ–π—Å—Ç–≤–∏–µ:** –°–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ `ksk_report_header` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `created`
- **–¢—Ä–∏–≥–≥–µ—Ä:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞


### **–ü—Ä–∏–º–µ—Ä JSON –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "id": 126,
  "report_code": "figurants",
  "report_name": "–û—Ç—á—ë—Ç –ø–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞–º",
  "status": "created",
  "created_datetime": "2025-10-26T20:48:30",
  "start_date": "2025-10-01",
  "end_date": "2025-10-25",
  "remove_date": "2025-11-02",
  "ttl": 7,
  "message": "–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ"
}
```

**HTTP –∫–æ–¥—ã:**

- `201 Created` - –æ—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω
- `400 Bad Request` - –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- `404 Not Found` - –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π report_code

***

## **–§–£–ù–ö–¶–ò–Ø 3: –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ—Ç—á–µ—Ç–∞**

### **REST API:**

```
DELETE /api/reports/user/{report_id}
```


### **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:**

- **–§—É–Ω–∫—Ü–∏—è:** `ksk_cleanup_reports(specific_report_id)`
- **–î–µ–π—Å—Ç–≤–∏–µ:** –£–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –∏–∑ `ksk_report_header` (–∫–∞—Å–∫–∞–¥–Ω–æ —É–¥–∞–ª—è—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç–∞)


### **–ü—Ä–∏–º–µ—Ä JSON –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "message": "–û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω",
  "deleted_report_id": 123
}
```

**HTTP –∫–æ–¥—ã:**

- `200 OK` - –æ—Ç—á–µ—Ç —É–¥–∞–ª–µ–Ω
- `403 Forbidden` - –ø–æ–ø—ã—Ç–∫–∞ —É–¥–∞–ª–∏—Ç—å —á—É–∂–æ–π –æ—Ç—á–µ—Ç
- `404 Not Found` - –æ—Ç—á–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω

***

## **–§–£–ù–ö–¶–ò–Ø 4: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç—á–µ—Ç–∞**

### **REST API:**

```
GET /api/reports/user/{report_id}/status
```


### **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:**

- **–¢–∞–±–ª–∏—Ü–∞:** `ksk_report_header`
- **–£—Å–ª–æ–≤–∏–µ:** WHERE `id = report_id` AND `initiator = 'user'` AND `user_login = {current_user}`


### **–ü—Ä–∏–º–µ—Ä JSON –æ—Ç–≤–µ—Ç–∞ (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ):**

```json
{
  "id": 124,
  "status": "in_progress",
  "created_datetime": "2025-10-26T10:15:00",
  "finished_datetime": null,
  "progress_percentage": null,
  "message": "–û—Ç—á–µ—Ç —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è..."
}
```


### **–ü—Ä–∏–º–µ—Ä JSON –æ—Ç–≤–µ—Ç–∞ (–≥–æ—Ç–æ–≤):**

```json
{
  "id": 123,
  "status": "done",
  "created_datetime": "2025-10-25T14:30:00",
  "finished_datetime": "2025-10-25T14:30:45",
  "duration_seconds": 45,
  "message": "–û—Ç—á–µ—Ç –≥–æ—Ç–æ–≤"
}
```


### **–ü—Ä–∏–º–µ—Ä JSON –æ—Ç–≤–µ—Ç–∞ (–æ—à–∏–±–∫–∞):**

```json
{
  "id": 125,
  "status": "error",
  "created_datetime": "2025-10-26T09:00:00",
  "finished_datetime": "2025-10-26T09:00:15",
  "error_message": "–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: timeout –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö",
  "message": "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –æ—Ç—á–µ—Ç–∞"
}
```


***

## **‚ú® –§–£–ù–ö–¶–ò–Ø 5: –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—Ç—á–µ—Ç–æ–≤ (–£–õ–£–ß–®–ï–ù–ò–ï)**

### **REST API:**

```
GET /api/reports/user/types
```


### **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:**

- **–¢–∞–±–ª–∏—Ü–∞:** `ksk_report_orchestrator`
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤ –æ—Ç—á–µ—Ç–æ–≤, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è


### **–ü—Ä–∏–º–µ—Ä JSON –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "data": [
    {
      "report_code": "totals",
      "name": "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
      "description": "–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º",
      "user_ttl": 14,
      "supports_parameters": false
    },
    {
      "report_code": "totals_by_payment_type",
      "name": "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π",
      "description": "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π",
      "user_ttl": 14,
      "supports_parameters": false
    },
    {
      "report_code": "list_totals",
      "name": "–ò—Ç–æ–≥–∏ –ø–æ —Å–ø–∏—Å–∫–∞–º",
      "description": "–°–≤–æ–¥–∫–∞ –ø–æ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã–º —Å–ø–∏—Å–∫–∞–º",
      "user_ttl": 14,
      "supports_parameters": false
    },
    {
      "report_code": "list_totals_by_payment_type",
      "name": "–ò—Ç–æ–≥–∏ –ø–æ —Å–ø–∏—Å–∫–∞–º –∏ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π",
      "description": "–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —Å–ø–∏—Å–∫–∞–º –∏ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π",
      "user_ttl": 14,
      "supports_parameters": false
    },
    {
      "report_code": "figurants",
      "name": "–û—Ç—á—ë—Ç –ø–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞–º",
      "description": "–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞–º —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤",
      "user_ttl": 7,
      "supports_parameters": true,
      "parameters_schema": {
        "list_codes": {
          "type": "array",
          "items": "string",
          "description": "–ö–æ–¥—ã —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏",
          "optional": true
        }
      }
    }
  ]
}
```

**–ó–∞—á–µ–º:** –ß—Ç–æ–±—ã UI –º–æ–≥ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏–ø—ã –æ—Ç—á–µ—Ç–æ–≤ –±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥–∞.

***

## **‚ú® –§–£–ù–ö–¶–ò–Ø 6: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–æ–≥–æ –æ—Ç—á–µ—Ç–∞ (–£–õ–£–ß–®–ï–ù–ò–ï)**

### **REST API:**

```
GET /api/reports/user/{report_id}/data?limit=100&offset=0
```


### **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:**

- **–ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ –æ—Ç—á–µ—Ç–∞:**
    - `totals` ‚Üí `ksk_report_totals_data`
    - `figurants` ‚Üí `ksk_report_figurants_data`
    - –∏ —Ç.–¥.


### **–ü—Ä–∏–º–µ—Ä JSON –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "report_id": 123,
  "report_code": "figurants",
  "report_name": "–û—Ç—á—ë—Ç –ø–æ —Ñ–∏–≥—É—Ä–∞–Ω—Ç–∞–º",
  "start_date": "2025-10-01",
  "end_date": "2025-10-25",
  "data": [
    {
      "list_code": "4200",
      "name_figurant": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
      "president_group": "Group A",
      "auto_login": "false",
      "exclusion_phrase": "–Ω–µ —è–≤–ª—è–µ—Ç—Å—è",
      "total": 5,
      "total_allow": 3,
      "total_review": 1,
      "total_deny": 1,
      "total_bypass": 0
    }
  ],
  "pagination": {
    "total_records": 150,
    "limit": 100,
    "offset": 0,
    "has_more": true
  }
}
```

**–ó–∞—á–µ–º:** –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–∞ –≤ UI –±–µ–∑ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞.

***

## **‚ú® –§–£–ù–ö–¶–ò–Ø 7: –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–∞ (–£–õ–£–ß–®–ï–ù–ò–ï)**

### **REST API:**

```
GET /api/reports/user/{report_id}/export/{format}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

- `format`: `xlsx`, `csv`, `pdf` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)


### **–ü—Ä–∏–º–µ—Ä—ã:**

```
GET /api/reports/user/123/export/xlsx
GET /api/reports/user/123/export/csv
```


### **–û—Ç–≤–µ—Ç:**

- **Content-Type:** –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ñ–æ—Ä–º–∞—Ç–∞
- **Content-Disposition:** `attachment; filename="report_figurants_2025-10-01_2025-10-25.xlsx"`

**–ó–∞—á–µ–º:** –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –≤ –Ω—É–∂–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.

***

## **–ü–†–ï–î–õ–û–ñ–ï–ù–ò–Ø –ü–û –£–õ–£–ß–®–ï–ù–ò–Ø–ú:**

### **1. ‚úÖ Polling (–æ–ø—Ä–æ—Å) —Å—Ç–∞—Ç—É—Å–∞:**

**–ü—Ä–æ–±–ª–µ–º–∞:** UI —Ä–µ–≥—É–ª—è—Ä–Ω–æ –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç –±—ç–∫–µ–Ω–¥
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ—Ä–æ—Ç–∫–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã (2-3 —Å–µ–∫—É–Ω–¥—ã) —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞ –æ—Ç—á–µ—Ç –≤ —Å—Ç–∞—Ç—É—Å–µ `created` –∏–ª–∏ `in_progress`. –ü–æ—Å–ª–µ `done`/`error` ‚Äî –ø—Ä–µ–∫—Ä–∞—â–∞–π –æ–ø—Ä–æ—Å.

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∏–∫–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ:**

```javascript
function pollReportStatus(reportId) {
  const intervalId = setInterval(async () => {
    const response = await fetch(`/api/reports/user/${reportId}/status`);
    const data = await response.json();
    
    if (data.status === 'done' || data.status === 'error') {
      clearInterval(intervalId);
      updateUI(data);
    }
  }, 3000); // –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
}
```


***

### **2. ‚úÖ WebSocket (–≤–º–µ—Å—Ç–æ polling):**

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞.

```javascript
const ws = new WebSocket('wss://api.example.com/reports/ws');

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  if (data.report_id === 123) {
    updateReportStatus(data);
  }
};
```

**–ü–ª—é—Å—ã:** –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

***

### **3. ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º –≤ —Å–ø–∏—Å–∫–µ –æ—Ç—á–µ—Ç–æ–≤:**

```
GET /api/reports/user?status=all&created_from=2025-10-01&created_to=2025-10-26
```


***

### **4. ‚úÖ –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤:**

```
DELETE /api/reports/user/batch
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**

```json
{
  "report_ids": [123, 124, 125]
}
```


***

### **5. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏:**

**–ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ:**

- `start_date <= end_date`
- `end_date <= CURRENT_DATE` (–Ω–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç –Ω–∞ –±—É–¥—É—â–µ–µ)
- `end_date - start_date <= 365 days` (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞)

***

### **6. ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**

**–û–ø—Ü–∏—è:** –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å email/Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–æ–≥–¥–∞ –æ—Ç—á–µ—Ç –≥–æ—Ç–æ–≤.

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ –≤ –∑–∞–ø—Ä–æ—Å–µ:**

```json
{
  "report_code": "figurants",
  "start_date": "2025-10-01",
  "end_date": "2025-10-25",
  "notify_on_complete": true
}
```


***

## **–ò–¢–û–ì–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê API:**

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–∞–≥–∏–Ω–∞—Ü–∏—è |
| :-- | :-- | :-- | :-- |
| GET | `/api/reports/user` | –°–ø–∏—Å–æ–∫ –æ—Ç—á–µ—Ç–æ–≤ | ‚úÖ –î–∞ |
| POST | `/api/reports/user` | –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç | ‚ùå –ù–µ—Ç |
| DELETE | `/api/reports/user/{id}` | –£–¥–∞–ª–∏—Ç—å –æ—Ç—á–µ—Ç | ‚ùå –ù–µ—Ç |
| GET | `/api/reports/user/{id}/status` | –°—Ç–∞—Ç—É—Å –æ—Ç—á–µ—Ç–∞ | ‚ùå –ù–µ—Ç |
| GET | `/api/reports/user/types` | –¢–∏–ø—ã –æ—Ç—á–µ—Ç–æ–≤ | ‚ùå –ù–µ—Ç |
| GET | `/api/reports/user/{id}/data` | –î–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç–∞ | ‚úÖ –î–∞ |
| GET | `/api/reports/user/{id}/export/{format}` | –≠–∫—Å–ø–æ—Ä—Ç | ‚ùå –ù–µ—Ç |


***

**–ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!** üöÄ
<span style="display:none">[^1]</span>

<div align="center">‚ÅÇ</div>

[^1]: ksk_reports_system.sql

